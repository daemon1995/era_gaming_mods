ZVSE2
****************************************************************************************************
*Author: Daemon_n and Perry R
*honorable mention: Berserker
*A difficulty mod for ERA 3
*Dialogue Numbers used: 13,44,45,47

This mod offers the player various options to increase game difficulty for Neutral Stacks on the map
and for computer player heroes



****************************************************************************************************


            Difficulty Options for AI and Neutrals at map start



****************************************************************************************************

!#SN:W^Difficulty_Mod_Active^/1;        [Set Mod Active]

****************************************************************************************************
This Section handels the First Dialogue 13 were you can choose to configure options or start game


!?DL&v998=13/v999>=1/v999<=2/v1000=13;  [Get Player choice what to configure when release L-click on images]

!!FU(Configure_Neutrals)&v999=1:P;      [call (Configure_Neutrals) func]
!!FU(Configure_AI)&v999=2:P;            [call (Configure_AI) func]


!?DL&v998=13/v1000=14;                  [Set text hints for boxes and pictures]

!!SN:T^Diff_Mod.LeftHint^/?z41;         [set creatures RMB hint]
!!SN:T^Diff_Mod.RightHint^/?z42;        [set AI RMB hint]
!!IF&v999=1:M0/4/z41;                   [place creatures RMB hint]
!!IF&v999=2:M0/4/z42;                   [place AI RMB hint]


!?DL&v998=13/v999=30722/v1000=13;       [Start game and close dialogue when release L-click on  "OK"]
!!VRz1:S^Button.wav^;
!!SN:Pz1;
!!DL:C1;


****************************************************************************************************


This Section handels the Dialogue 44 were you can Configure_Neutrals (Left Side)



****************************************************************************************************

!?FU(Configure_Neutrals);               [open the Neutrals difficulty settings]
  !!DL44:N^diff_Neu.txt^;               [Name of Dialogue text file Parse Dialogue]

  !!SN:T^Diff_Mod.Level_Easy^/?z20 T^Diff_Mod.Level_Medium^/?z21 T^Diff_Mod.Level_Hard^/?z22 T^Diff_Mod.Level_Choose_1^/?z23; [Load Text]
  !!DL44:A43/3/z20/1 A44/3/z21/1 A45/3/z22/1 A38/3/z23/1; [Set text to text fields]
  !!DL44:H43/20 H44/21 H45/22 H38/23; [Hint Text for options]

  !!SN:T^Diff_Mod.Option_1^/?z65 T^Diff_Mod.Option_2^/?z66 T^Diff_Mod.Option_3^/?z67 T^Diff_Mod.Option_4^/?z68; [Load correct text for options 1-16]
  !!DL44:A26/3/z65/1 A27/3/z66/1 A28/3/z67/1 A29/3/z68/1; [Set text to text fields]
  !!DL44:H26/65 H27/66 H28/67 H29/68; [Hint Text for options]

  !!SN:T^Diff_Mod.Option_5^/?z60 T^Diff_Mod.Option_6^/?z61 T^Diff_Mod.Option_7^/?z62 T^Diff_Mod.Option_8^/?z63;
  !!DL44:A30/3/z60/1 A31/3/z61/1 A32/3/z62/1 A33/3/z63/1;
  !!DL44:H30/60 H31/61 H32/62 H33/63; [Hint Text for options]

  !!SN:T^Diff_Mod.Option_9^/?z5 T^Diff_Mod.Option_10^/?z6 T^Diff_Mod.Option_11^/?z7 T^Diff_Mod.Option_12^/?z8;
  !!DL44:A34/3/z5/1 A35/3/z6/1 A36/3/z7/1 A37/3/z8/1;
  !!DL44:H34/5 H35/6 H36/7 H37/8; [Hint Text for options]

  !!SN:T^Diff_Mod.Option_13^/?z9 T^Diff_Mod.Option_14^/?z10 T^Diff_Mod.Option_15^/?z11 T^Diff_Mod.Option_16^/?z12;
  !!DL44:A38/3/z9/1 A39/3/z10/1 A40/3/z11/1 A41/3/z12/1;
  !!DL44:H38/9 H39/10 H40/11 H41/12; [Hint Text for options]

  !!SN:T^Diff_Mod.Option_17^/?z13 T^Diff_Mod.Option_18^/?z14; [;]
  !!DL44:A72/3/z13/1 A73/3/z14/1; 
  !!DL44:H72/13 H73/14; [Hint Text for options]

  !!SN:T^Diff_Mod.Option_19^/?z40 T^Diff_Mod.Option_35^/?z41 T^Diff_Mod.Option_36^/?z42; [;]
  !!DL44:A74/3/z40/1 A75/3/z41/1 A76/3/z42/1;
  !!DL44:H74/40 H75/41 H76/42; [Hint Text for options]  

  !!SN:T^Diff_Mod.Option_70^/?z15;      [Mixed Neutrals Text field]
  !!DL44:A70/3/z15/1;
  !!DL44:H70/15;

  !!SN:W^Additionals_troops^/?y1; !!SN:T^Diff_Mod.Level_%Y1^/?z22;
  !!SN:W^Neutral_stats^/?y1; !!SN:T^Diff_Mod.Level_%Y1^/?z23;
  !!SN:W^Neutral_exp^/?y1; !!SN:T^Diff_Mod.Level_%Y1^/?z24;
  !!SN:W^Creature_banks^/?y1; !!SN:T^Diff_Mod.Level_%Y1^/?z25;
  !!DL44:A22/3/z22/1 A24/3/z23/1 A23/3/z24/1 A25/3/z25/1;
  !!FU(Neutrals_checkboxes):P;

  !!SN:T^Diff_Mod.cancel_button_hint^/?z43; [left text]
  !!DL44:H30721/43;                     [set cancel button hint text]
  !!SN:T^Diff_Mod.confirm_button_hint_0^/?z44; [left text]
  !!DL44:H30722/44;                     [set confirm button hint text]

  !!SN:T^Diff_Mod.Level_Easy^/?z50; !!DL44:H1/50; [Hint Text for Easy button]
  !!SN:T^Diff_Mod.Level_Medium^/?z51; !!DL44:H2/51; [Hint Text for Medium button]
  !!SN:T^Diff_Mod.Level_Hard^/?z52; !!DL44:H3/52; [Hint Text for Hard button]

  !!SN:W^Battle_Reward_Active^/?y1;
  !!VRz1&y1=0:S^^;

  !!if&y1=1;
    !!FU(Calc_Battle_Reward):P;         [Give Message about Chance when all options were selected]
    !!DL44:H5/z1;                       [Show Battle Reward chance when hovering over Monster Icon]
  !!en;

  ; Hide invalid items - Archer
  *!DL44:A83/(DLG_CMD_SET_DEF)/^emptchec.def^;
  *!DL44:A84/(DLG_CMD_SET_DEF)/^emptchec.def^;

  !!DL44:S1;                            [Show complete Dialogue number 44]

!?DL&v998=44/v999>0/v999<6/v1000=12;    [LMB on the creatures/presets icons]
  !!VRz16:S^Button.wav^;

!!if&v999=1;                            [set text for 1st]
  !!SN:Pz16;                            [do not play sound again]
  !!FU(Neutrals_reset):P;               [reset all]
  !!DL44:A1/4/1/1 A6/4/1/1 A5/4/5/1;
  !!FU(Set_Options_Presets):P1;         [Pass Easy and return value]
  !!SN:T^Diff_Mod.Level_1^/?z1 T^Diff_Mod.Level_1^/?z2 T^Diff_Mod.Level_1^/?z3 T^Diff_Mod.Level_1^/?z4;
  !!DL44:A22/3/z1/1 A23/3/z2/1 A24/3/z3/1 A25/3/z4/1;

  !!VRy10:S0T15;
  !!SN&y10=0:W^Random_Neutral_Hero^/1;
  !!SN&y10=1:W^Battle_Commander^/1;
  !!SN&y10=2:W^Tougher_Karmic_Battles_on^/1;
  !!SN&y10=3:W^Anzahl_Buffs^/1;

  !!VRy10:S0T15;
  !!SN&y10=0:W^Random_Neutral_Hero^/1;
  !!SN&y10=1:W^Battle_Commander^/1;
  !!SN&y10=2:W^Tougher_Karmic_Battles_on^/1;
  !!SN&y10=3:W^Anzahl_Buffs^/1;

  !!SN:W^Battle_Reward_Active^/1;
  !!FU(Neutrals_checkboxes):P;          [call func for switch on the user's choice]
!!en;

!!if&v999=2;
  !!SN:Pz16;                            [do not play sound again]
  !!FU(Neutrals_reset):P;               [reset all]
  !!DL44:A7/4/1/1 A2/4/3/1 A5/4/6/1;
  !!FU(Set_Options_Presets):P2;         [Pass Normal and return value]
  !!SN:T^Diff_Mod.Level_2^/?z1 T^Diff_Mod.Level_2^/?z2 T^Diff_Mod.Level_2^/?z3 T^Diff_Mod.Level_2^/?z4;
  !!DL44:A22/3/z1/1 A23/3/z2/1 A24/3/z3/1 A25/3/z4/1;

  !!VRy10:S0T12;
  !!SN&y10=0:W^Random_Neutral_Hero^/1;
  !!SN&y10=1:W^Battle_Commander^/1;
  !!SN&y10=2:W^Tougher_Karmic_Battles_on^/1;
  !!SN&y10=3:W^Anzahl_Buffs^/1;
  !!SN&y10=4:W^Anzahl_Abilities^/1;
  !!SN&y10=5:W^Neutral_Stack_Weekly_Upgrade^/1;
  !!SN&y10=6:W^Neutral_Growth_10000^/1;
  !!SN&y10=7:W^Low_Level_Growth^/1;
  !!SN&y10=8:W^Double_Growth_Rate^/1;
  !!SN&y10=9:W^Dif_Mod_Neutral_Commander^/1;
  !!SN&y10=10:W^Dif_Mod_Neutral_boost^/1;  

  !!VRy10:S0T12;
  !!SN&y10=0:W^Random_Neutral_Hero^/1;
  !!SN&y10=1:W^Battle_Commander^/1;
  !!SN&y10=2:W^Tougher_Karmic_Battles_on^/1;
  !!SN&y10=3:W^Anzahl_Buffs^/1;
  !!SN&y10=4:W^Anzahl_Abilities^/1;
  !!SN&y10=5:W^Neutral_Stack_Weekly_Upgrade^/1;
  !!SN&y10=6:W^Neutral_Growth_10000^/1;
  !!SN&y10=7:W^Low_Level_Growth^/1;
  !!SN&y10=8:W^Double_Growth_Rate^/1;
  !!SN&y10=9:W^Dif_Mod_Neutral_Commander^/1;
  !!SN&y10=10:W^Dif_Mod_Neutral_boost^/1;  

  !!VRy10:S0T1;
  !!SN&y10=0:W^Random_Neutral_Hero^/1;
  !!SN&y10=1:W^Battle_Commander^/1;

  !!SN:W^Battle_Reward_Active^/1;
  !!FU(Neutrals_checkboxes):P;          [call func for switch on the user's choice]
!!en;

!!if&v999=3;
  !!SN:Pz16;                            [do not play sound again]
  !!FU(Neutrals_reset):P;               [reset all]
  !!DL44:A3/4/5/1 A8/4/1/1 A5/4/7/1;    [3rd]
  !!FU(Set_Options_Presets):P3;         [Pass Hard and return value]
  !!SN:T^Diff_Mod.Level_3^/?z1 T^Diff_Mod.Level_3^/?z2 T^Diff_Mod.Level_3^/?z3 T^Diff_Mod.Level_3^/?z4;
  !!DL44:A22/3/z1/1 A23/3/z2/1 A24/3/z3/1 A25/3/z4/1;

  !!VRy10:S2T10;
  !!SN&y10=2:W^Tougher_Karmic_Battles_on^/1;
  !!SN&y10=3:W^Anzahl_Buffs^/1;
  !!SN&y10=4:W^Anzahl_Abilities^/1;
  !!SN&y10=5:W^Neutral_Stack_Weekly_Upgrade^/1;
  !!SN&y10=6:W^Neutral_Growth_10000^/1;
  !!SN&y10=7:W^Low_Level_Growth^/1;
  !!SN&y10=8:W^Double_Growth_Rate^/1;
  !!SN&y10=9:W^Neutral_Stack_Uptier1^/1;
  !!SN&y10=10:W^Double_Neutral_Stacks^/1;
  !!SN&y10=11:W^Dif_Mod_Neutral_Commander^/1;
  !!SN&y10=12:W^Dif_Mod_Neutral_boost^/1;

  !!VRy10:S2T10;
  !!SN&y10=2:W^Tougher_Karmic_Battles_on^/1;
  !!SN&y10=3:W^Anzahl_Buffs^/1;
  !!SN&y10=4:W^Anzahl_Abilities^/1;
  !!SN&y10=5:W^Neutral_Stack_Weekly_Upgrade^/1;
  !!SN&y10=6:W^Neutral_Growth_10000^/1;
  !!SN&y10=7:W^Low_Level_Growth^/1;
  !!SN&y10=8:W^Double_Growth_Rate^/1;
  !!SN&y10=9:W^Anzahl_Buffs^/2;
  !!SN&y10=10:W^Anzahl_Abilities^/2;
  !!SN&y10=11:W^Dif_Mod_Neutral_Commander^/1;
  !!SN&y10=12:W^Dif_Mod_Neutral_boost^/1;

  !!VRy10:S2T10;
  !!SN&y10=2:W^Tougher_Karmic_Battles_on^/1;
  !!SN&y10=3:W^Anzahl_Buffs^/1;
  !!SN&y10=4:W^Anzahl_Abilities^/1;
  !!SN&y10=5:W^Neutral_Stack_Weekly_Upgrade^/1;
  !!SN&y10=6:W^Neutral_Growth_10000^/1;
  !!SN&y10=7:W^Low_Level_Growth^/1;
  !!SN&y10=8:W^Double_Growth_Rate^/1;
  !!SN&y10=9:W^Neutral_Stack_Uptier1^/1;
  !!SN&y10=10:W^Double_Neutral_Stacks^/1;
  !!SN&y10=11:W^Dif_Mod_Neutral_Commander^/1;
  !!SN&y10=12:W^Dif_Mod_Neutral_boost^/1;

  !!SN:W^Random_Neutral_Hero^/1;
  !!SN:W^Battle_Commander^/1;

  !!SN:W^Battle_Reward_Active^/1;
  !!FU(Neutrals_checkboxes):P;          [call func for switch on the user's choice]
!!en;
!!FU(Options_value):P;


!?DL&v998=44/v999>46/v999<59/v1000=13;  [switch by little arrows for options 1-4]

!!if&v999=47;                           [If clicked on the left arrow   Additional Troops option]
   !!SN:W^Additionals_troops^/?y1;      [Get value in y1]
   !!SN&y1>0:W^Additionals_troops^/d-1; [Reduce value by -1 if bigger zero]
   !!SN:W^Additionals_troops^/?y1;      [Get new value in y1]
   !!FU(Set_Stack_Size_Mod):Py1;
!!en;
!!if&v999=48;                           [Additional Troops option]
  !!SN:W^Additionals_troops^/?y1;
  !!SN&y1<5:W^Additionals_troops^/d1;
  !!SN:W^Additionals_troops^/?y1;
  !!FU(Set_Stack_Size_Mod):Py1;
!!en;

!!if&v999=51;                           [Healt_Grow_Rate]
  !!SN:W^Neutral_stats^/?y1;
  !!SN&y1>0:W^Neutral_stats^/d-1;
  !!SN:W^Neutral_stats^/?y1;
  !!VRy2&y1=0:S0;                       [Deavtivate]
  !!VRy2&y1=1:S42;                      [Easy 6 weeks]
  !!VRy2&y1=2:S28;                      [Normal 4 weeks]
  !!VRy2&y1=3:S21;                      [Hard 3 weeks]
  !!VRy2&y1=4:S14;                      [Very Hard 2 weeks]
  !!VRy2&y1=5:S7;                       [Extreme 1 weeks]
  !!VRy2&y1=6:S3;                       [Insane 3 days]
  !!VRy2&y1=7:S1;                       [Insane II 1 days]
  !!SN:W^Health_Grow_Enable^/y2;        [Healt_Grow_Rate]
!!en;
!!if&v999=52;                           [Healt_Grow_Rate]
  !!SN:W^Neutral_stats^/?y1;
  !!SN&y1<7:W^Neutral_stats^/d1;
  !!SN:W^Neutral_stats^/?y1;
  !!VRy2&y1=0:S0;                       [Deavtivate]
  !!VRy2&y1=1:S42;                      [Easy 6 weeks]
  !!VRy2&y1=2:S28;                      [Normal 4 weeks]
  !!VRy2&y1=3:S21;                      [Hard 3 weeks]
  !!VRy2&y1=4:S14;                      [Very Hard 2 weeks]
  !!VRy2&y1=5:S7;                       [Extreme 1 weeks]
  !!VRy2&y1=6:S3;                       [Insane 3 days]
  !!VRy2&y1=7:S1;                       [Insane II 1 days]
  !!SN:W^Health_Grow_Enable^/y2;        [Healt_Grow_Rate]
!!en;

!!if&v999=49;                           [Stack_Exp_Rate]
  !!SN:W^Neutral_exp^/?y1;
  !!SN&y1>0:W^Neutral_exp^/d-1;
  !!SN:W^Neutral_exp^/?y1;
  !!VRy2&y1=0:S0;                       [Deavtivate]
  !!VRy2&y1=1:S7;                       [Easy]
  !!VRy2&y1=2:S5;                       [Normal]
  !!VRy2&y1=3:S4;                       [Hard]
  !!VRy2&y1=4:S3;                       [Extreme]
  !!VRy2&y1=5:S1;                       [Insane]
  !!SN:W^Stack_Exp_Rate^/y2;            [Stack_Exp_Rate]
!!en;
!!if&v999=50;                           [Stack_Exp_Rate]
  !!SN:W^Neutral_exp^/?y1;
  !!SN&y1<5:W^Neutral_exp^/d1;
  !!SN:W^Neutral_exp^/?y1;
  !!VRy2&y1=0:S0;                       [Deavtivate]
  !!VRy2&y1=1:S7;                       [Easy]
  !!VRy2&y1=2:S5;                       [Normal]
  !!VRy2&y1=3:S4;                       [Hard]
  !!VRy2&y1=4:S3;                       [Extreme]
  !!VRy2&y1=5:S1;                       [Insane]
  !!SN:W^Stack_Exp_Rate^/y2;            [Stack_Exp_Rate]
!!en;

!!if&v999=53;                           [Guarded_Object_Faktor and commander inside CB]
  !!SN:W^Creature_banks^/?y1;
  !!SN&y1>0:W^Creature_banks^/d-1;
  !!SN:W^Creature_banks^/?y1;
  !!FU(Set_Guarded_Object_Mod):Py1;
!!en;
!!if&v999=54;                           [Guarded_Object_Faktor and commander inside CB]
  !!SN:W^Creature_banks^/?y1;
  !!SN&y1<5:W^Creature_banks^/d1;
  !!SN:W^Creature_banks^/?y1;
  !!FU(Set_Guarded_Object_Mod):Py1;
!!en;

!!if&v999=55;
  !!SN:W^Anzahl_Buffs^/?y1;
  !!SN&y1>0:W^Anzahl_Buffs^/d-1;
  !!FU(Neutrals_checkboxes):P;
!!en;
!!if&v999=56;
  !!SN:W^Anzahl_Buffs^/?y1;
  !!SN&y1<4:W^Anzahl_Buffs^/d1;
  !!FU(Neutrals_checkboxes):P;
!!en;

!!if&v999=57;
  !!SN:W^Anzahl_Abilities^/?y1;
  !!SN&y1>0:W^Anzahl_Abilities^/d-1;
  !!FU(Neutrals_checkboxes):P;
!!en;
!!if&v999=58;
  !!SN:W^Anzahl_Abilities^/?y1;
  !!SN&y1<4:W^Anzahl_Abilities^/d1;
  !!FU(Neutrals_checkboxes):P;
!!en;

!!FU(Options_value)|v999=47/v999=48:Pv998/22/y1; [For left or right arrow, Call fkt and pass DL_Nummber, Element_ID, and value]
!!FU(Options_value)|v999=49/v999=50:Pv998/23/y1;
!!FU(Options_value)|v999=51/v999=52:Pv998/24/y1;
!!FU(Options_value)|v999=53/v999=54:Pv998/25/y1;


!?DL&v998=44/v999>9/v999<22/v1000=12;   [checkboxes switch between check and cancel]
!!VRz1:S^Button.wav^;
!!SN:Pz1;

!!SN:W^Random_Neutral_Hero^/?y1;        [Check if options have already been activated]
!!SN:W^Tougher_Karmic_Battles_on^/?y2;
!!SN:W^Low_Level_Growth^/?y3;
!!SN:W^Double_Growth_Rate^/?y4;
!!SN:W^Double_Neutral_Stacks^/?y5;
!!SN:W^Neutral_Stack_Uptier1^/?y6;
!!SN:W^Neutral_Stack_Weekly_Upgrade^/?y7;
!!SN:W^Neutral_Growth_10000^/?y8;
!!SN:W^Battle_Commander^/?y9;
!!SN:W^Battle_Reward_Active^/?y10;
!!SN:W^Anzahl_Buffs^/?y11;
!!SN:W^Anzahl_Abilities^/?y12;
!!SN:W^Stack_Exp_Rebalance_On^/?y13;
!!SN:W^Aggression_Neutrals^/?y14;

  !!SN&v999=10/y1=0:W^Random_Neutral_Hero^/1; [swith for 1st]
  !!SN&v999=10/y1=1:W^Random_Neutral_Hero^/0;

  !!SN&v999=11/y2=0:W^Tougher_Karmic_Battles_on^/1;
  !!SN&v999=11/y2=1:W^Tougher_Karmic_Battles_on^/0;

  !!SN&v999=12/y3=0:W^Low_Level_Growth^/1;
  !!SN&v999=12/y3=1:W^Low_Level_Growth^/0;

  !!SN&v999=13/y4=0:W^Double_Growth_Rate^/1;
  !!SN&v999=13/y4=1:W^Double_Growth_Rate^/0;

  !!SN&v999=14/y5=0:W^Double_Neutral_Stacks^/1;
  !!SN&v999=14/y5=1:W^Double_Neutral_Stacks^/0;

  !!SN&v999=15/y6=0:W^Neutral_Stack_Uptier1^/1;
  !!SN&v999=15/y6=1:W^Neutral_Stack_Uptier1^/0;

  !!SN&v999=16/y7=0:W^Neutral_Stack_Weekly_Upgrade^/1;
  !!SN&v999=16/y7=1:W^Neutral_Stack_Weekly_Upgrade^/0;

  !!SN&v999=17/y8=0:W^Neutral_Growth_10000^/1;
  !!SN&v999=17/y8=1:W^Neutral_Growth_10000^/0;

  !!SN&v999=18/y9=0:W^Battle_Commander^/1;
  !!SN&v999=18/y9=1:W^Battle_Commander^/0;

  !!SN&v999=19/y10=0:W^Battle_Reward_Active^/1;
  !!SN&v999=19/y10=1:W^Battle_Reward_Active^/0;

  !!SN&v999=20/y11=0:W^Anzahl_Buffs^/1;
  !!SN&v999=20/y11>0:W^Anzahl_Buffs^/0;

  !!SN&v999=21/y12=0:W^Anzahl_Abilities^/1;
  !!SN&v999=21/y12>0:W^Anzahl_Abilities^/0;

!!FU(Neutrals_checkboxes):P;            [call func for switch on the user's choice]


!?DL&v998=44/v999>79/v999<85/v1000=13;  [checkboxes switch between check and cancel]
!!VRz1:S^Button.wav^;
!!SN:Pz1;

!!SN:W^Stack_Exp_Rebalance_On^/?y13;
!!SN:W^Aggression_Neutrals^/?y14;
!!SN:W^Dif_Mod_Neutral_Commander^/?y15;
!!SN:W^Dif_Mod_Neutral_boost^/?y16;

  !!SN&v999=80/y13=0:W^Stack_Exp_Rebalance_On^/1;
  !!SN&v999=80/y13>0:W^Stack_Exp_Rebalance_On^/0;
  !!FU(Configure_Stack_Exp_Rebalance)&v999=80/y13=0:P; [open the Stack Exp Rebalance settings]

  !!SN&v999=81/y14=0:W^Aggression_Neutrals^/1;
  !!SN&v999=81/y14>0:W^Aggression_Neutrals^/0;

  !!SN&v999=83/y15=0:W^Dif_Mod_Neutral_Commander^/1;
  !!SN&v999=83/y15>0:W^Dif_Mod_Neutral_Commander^/0; 

  !!SN&v999=84/y16=0:W^Dif_Mod_Neutral_boost^/1;
  !!SN&v999=84/y16>0:W^Dif_Mod_Neutral_boost^/0;    

!!FU(Neutrals_checkboxes):P;            [call func for switch on the user's choice]


!?DL&i^dlg_id^=44/i^mouse_action^=(MOUSE_LMB_PRESSED); [checkboxes switch between check and cancel for Mixed Neutrals - Archer]
!!if|i^mouse_item^=71/i^mouse_item^=70;
  !!SN:P^button.wav^;

  !!if&i^mix_on^<>(TRUE);
    !!IF:M0/(MSG_TYPE_POPUP)/^%T(Diff_Mod.Mixed_Neutrals_Missing)^;
  !!el;
    !!if&i^mouse_item^=71;
      !!if&i^mix_enabled^;
        !!VRi^mix_enabled^:S(FALSE);
      !!el;
        !!VRi^mix_enabled^:S(TRUE);
      !!en;
    !!en;

    !!DL44&i^mouse_item^=71:A71/(DLG_CMD_SET_DEF_FRAME)/i^mix_enabled^;

    !!FU(Configure_Mixed_Neutrals)&i^mix_enabled^:P;
  !!en;
!!en;

!?DL&v998=44/v1000=14;                  [Show right click information for faces and all options]

*faces

!!SN&v999=1:T^Diff_Mod.Neutral_Preset_1^/?s^Text^; [set text for 1st]
!!IF&v999=1:M0/4/^%S(Text)^;            [show it 1 - 5]

!!SN&v999=2:T^Diff_Mod.Neutral_Preset_2^/?s^Text^; [2nd]
!!IF&v999=2:M0/4/^%S(Text)^;

!!SN&v999=3:T^Diff_Mod.Neutral_Preset_3^/?s^Text^; [...]
!!IF&v999=3:M0/4/^%S(Text)^;

*!SN&v999=4:T^Diff_Mod.Bonus4^/?s^Text^;                ...
*!IF&v999=4:M0/4/z1;

!!SN&v999=30722:T^Diff_Mod.Confirm_Neutral_Settings^/?s^Text^; [...]
!!IF&v999=30722:M0/4/^%S(Text)^;

!!SN&v999=30721:T^Diff_Mod.Cancel_Neutral_Settings^/?s^Text^; [...]
!!IF&v999=30721:M0/4/^%S(Text)^;


*switchable options
!!if|v999=26/v999=22;
!!SN:W^Additionals_troops^/?y1;         [Get new value in y1]
!!SN&y1=0:T^Diff_Mod.Additionals_troops0^/?s^Text^; [set text for 1st]
!!SN&y1=1:T^Diff_Mod.Additionals_troops1^/?s^Text^; [set text for 1st]
!!SN&y1=2:T^Diff_Mod.Additionals_troops2^/?s^Text^; [set text for 1st]
!!SN&y1=3:T^Diff_Mod.Additionals_troops3^/?s^Text^; [set text for 1st]
!!SN&y1=4:T^Diff_Mod.Additionals_troops4^/?s^Text^; [set text for 1st]
!!SN&y1=5:T^Diff_Mod.Additionals_troops5^/?s^Text^; [set text for 1st]
!!IF:M0/4/^%S(Text)^;                   [show it 1 - 5]
!!en;


!!if|v999=27/v999=23;
!!SN:T^Diff_Mod.Neutral_exp^/?s^Text^;  [2nd]
!!IF:M0/4/^%S(Text)^;
!!en;

!!if|v999=28/v999=24;
!!SN:W^Neutral_stats^/?y1;              [Get new value in y1]
!!SN&y1=0:T^Diff_Mod.Neutral_stats0^/?s^Text^; [set text for 1st]
!!SN&y1=1:T^Diff_Mod.Neutral_stats1^/?s^Text^; [set text for 1st]
!!SN&y1=2:T^Diff_Mod.Neutral_stats2^/?s^Text^; [set text for 1st]
!!SN&y1=3:T^Diff_Mod.Neutral_stats3^/?s^Text^; [set text for 1st]
!!SN&y1=4:T^Diff_Mod.Neutral_stats4^/?s^Text^; [set text for 1st]
!!SN&y1=5:T^Diff_Mod.Neutral_stats5^/?s^Text^; [set text for 1st]
!!SN&y1=6:T^Diff_Mod.Neutral_stats6^/?s^Text^; [set text for 1st]
!!SN&y1=7:T^Diff_Mod.Neutral_stats7^/?s^Text^; [set text for 1st]
!!IF:M0/4/^%S(Text)^;
!!en;

!!if|v999=29/v999=25;
!!SN:W^Creature_banks^/?y1;
!!SN&y1=0:T^Diff_Mod.Creature_banks0^/?s^Text^; [set text for 1st]
!!SN&y1=1:T^Diff_Mod.Creature_banks1^/?s^Text^; [set text for 1st]
!!SN&y1=2:T^Diff_Mod.Creature_banks2^/?s^Text^; [set text for 1st]
!!SN&y1=3:T^Diff_Mod.Creature_banks3^/?s^Text^; [set text for 1st]
!!SN&y1=4:T^Diff_Mod.Creature_banks4^/?s^Text^; [set text for 1st]
!!SN&y1=5:T^Diff_Mod.Creature_banks5^/?s^Text^; [set text for 1st]
!!IF:M0/4/^%S(Text)^;
!!en;

*fixed options
!!SN&v999=30:T^Diff_Mod.Random_Neutral_Hero^/?s^Text^; [...]
!!IF&v999=30:M0/4/^%S(Text)^;

!!SN&v999=31:T^Diff_Mod.Tougher_Karmic_Battles_on^/?s^Text^; [...]
!!IF&v999=31:M0/4/^%S(Text)^;

!!SN&v999=32:T^Diff_Mod.Low_Level_Growth^/?s^Text^; [...]
!!IF&v999=32:M0/4/^%S(Text)^;

!!SN&v999=33:T^Diff_Mod.Double_Growth_Rate^/?s^Text^; [...]
!!IF&v999=33:M0/4/^%S(Text)^;

!!SN&v999=34:T^Diff_Mod.Double_Neutral_Stacks^/?s^Text^; [...]
!!IF&v999=34:M0/4/^%S(Text)^;

!!SN&v999=35:T^Diff_Mod.Neutral_Stack_Uptier1^/?s^Text^; [...]
!!IF&v999=35:M0/4/^%S(Text)^;

!!SN&v999=36:T^Diff_Mod.Neutral_Stack_Weekly^/?s^Text^; [...]
!!IF&v999=36:M0/4/^%S(Text)^;

!!SN:W^Growth_Limit_Lvl_1^/?y40; !!VRy40:F4000/1000000; [Get growth limit for level 1 creatures]
!!SN:W^Growth_Limit_Lvl_2^/?y41; !!VRy41:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_3^/?y42; !!VRy42:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_4^/?y43; !!VRy43:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_5^/?y44; !!VRy44:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_6^/?y45; !!VRy45:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_7^/?y46; !!VRy46:F4000/1000000; [Get growth limit for level 7 creatures]
!!SN&v999=37:T^Diff_Mod.Neutral_Growth_10000^/?s^Text^/^level1^/y40/^level2^/y41/^level3^/y42/^level4^/y43/^level5^/y44/^level6^/y45/^level7^/y46; [...]
!!IF&v999=37:M0/4/^%S(Text)^;

!!SN&v999=38:T^Diff_Mod.Battle_Commander_Active^/?s^Text^; [...]
!!IF&v999=38:M0/4/^%S(Text)^;

!!SN&v999=39:T^Diff_Mod.Battle_Reward_Active^/?s^Text^; [...]
!!IF&v999=39:M0/4/^%S(Text)^;

!!SN&v999=40:T^Diff_Mod.Anzahl_Buffs^/?s^Text^; [...]
!!IF&v999=40:M0/4/^%S(Text)^;

!!SN&v999=41:T^Diff_Mod.Anzahl_Abilities^/?s^Text^; [...]
!!IF&v999=41:M0/4/^%S(Text)^;

!!SN&v999=70:T^Diff_Mod.Mixed_Neutrals_Text^/?s^Text^; [...]
!!IF&v999=70:M0/4/^%S(Text)^;

!!SN&v999=72:T^Diff_Mod.Stack_Exp_Rebalance^/?s^Text^; [...]
!!IF&v999=72:M0/4/^%S(Text)^;

!!SN&v999=73:T^Diff_Mod.Aggression_Modifier^/?s^Text^; [...]
!!IF&v999=73:M0/4/^%S(Text)^;

!!SN&v999=74:T^Diff_Mod.Enhanced_Henchmen_Config^/?s^Text^; [...]
!!IF&v999=74:M0/4/^%S(Text)^;

!!SN&v999=75:T^Diff_Mod.Neutral_Commander^/?s^Text^; [...]
!!IF&v999=75:M0/4/^%S(Text)^;

!!SN&v999=76:T^Diff_Mod.Dif_Neutral_Boost^/?s^Text^; [...]
!!IF&v999=76:M0/4/^%S(Text)^;

!?DL&v998=44/v1000=13;                  [If any left click in DL44]

!!SN:W^Battle_Reward_Active^/?y2;
!!FU(Calc_Battle_Reward)&y2=1:P;        [Give Message about Chance when all options were selected]


!?DL&v998=44/v999=30721/v1000=13;       [When clicking on the close Button in Neutral Dif Exit and reset all options]
!!DL:C1;
!!SN:W^Neutrals_Difficulty_Enabled^/0;
!!FU(difm_SetDefaultOptions):P;         [Run Exit Settings]


!?DL&v998=44/v999=30722/v1000=13;       [Close Dialogue with Confirm Button Save all Settings]
!!SN:W^Neutrals_Difficulty_Enabled^/1;
!!DL:C1;


!?DL&v998=44/v999=70/v1000=13;
!!SN:W^mix_enabled^/?y1;

!!if&y1=1;
!!DL:C1;
!!FU(Configure_Mixed_Neutrals):P;       [open the Neutrals difficulty settings]
!!en;


!?FU(Neutrals_reset);
!!DL44:A1/4/0/1 A2/4/2/1 A3/4/4/1 A4/4/6/1 A5/4/0/1 A6/4/0/1 A7/4/0/1 A8/4/0/1 A9/4/0/1; [reset all]

  !!SN:W^Random_Neutral_Hero^/0;
  !!SN:W^Tougher_Karmic_Battles_on^/0;
  !!SN:W^Low_Level_Growth^/0;
  !!SN:W^Double_Growth_Rate^/0;
  !!SN:W^Double_Neutral_Stacks^/0;
  !!SN:W^Neutral_Stack_Uptier1^/0;
  !!SN:W^Neutral_Stack_Weekly_Upgrade^/0;
  !!SN:W^Neutral_Growth_10000^/0;
  !!SN:W^Battle_Commander^/0;
  !!SN:W^Battle_Reward_Active^/0;
  !!SN:W^Anzahl_Buffs^/0;
  !!SN:W^Anzahl_Abilities^/0;
  !!SN:W^Stack_Exp_Rebalance_On^/0;
  !!SN:W^Aggression_Neutrals^/0;  
  !!SN:W^Dif_Mod_Neutral_Commander^/0;
  !!SN:W^Dif_Mod_Neutral_boost^/0;  


!?FU(Neutrals_checkboxes);              [Set checkboxes function]
!!SN:W^Random_Neutral_Hero^/?y1 W^Tougher_Karmic_Battles_on^/?y2 W^Low_Level_Growth^/?y3 W^Double_Growth_Rate^/?y4;
!!SN:W^Double_Neutral_Stacks^/?y5 W^Neutral_Stack_Uptier1^/?y6 W^Neutral_Stack_Weekly_Upgrade^/?y7 W^Neutral_Growth_10000^/?y8;
!!SN:W^Battle_Commander^/?y9 W^Battle_Reward_Active^/?y10 W^Anzahl_Buffs^/?y11 W^Anzahl_Abilities^/?y12;
!!SN:W^Dif_Mod_Neutral_Commander^/?y20 W^Dif_Mod_Neutral_boost^/?y21;


!!VRy13:S(FALSE);
!!VRy13&i^mix_on^/i^mix_enabled^:S(TRUE);[Check for Mixed Neutral Mod]
!!DL44:A71/4/y13/1;                     [Set Checkbox]
!!VRz1:S^%Y11^;
!!VRz2:S^%Y12^;

!!DL44:A10/4/y1/1 A11/4/y2/1 A12/4/y3/1 A13/4/y4/1 A14/4/y5/1 A15/4/y6/1;
!!DL44:A16/4/y7/1 A17/4/y8/1 A18/4/y9/1 A19/4/y10/1 A59/3/z1/1 A60/3/z2/1;
!!DL44:A83/4/y20/1 A84/4/y21/1;

!!SN:W^Stack_Exp_Rebalance_On^/?y14; !!SN:W^Aggression_Neutrals^/?y15;
!!DL44:A80/4/y14/1 A81/4/y15/1;

!!VRy16:S(FALSE);                       [Check for Enhanced Henchmen Mod]
!!UN:P49/?y30;
!!VRy16&i^enhanced_henchmen_on^/y30:S(TRUE);
!!DL44:A82/4/y16/1;

!!if&y11>0;
  !!DL44:A20/4/1/1;
!!el;
  !!DL44:A20/4/0/1;
!!en;

!!if&y12>0;
  !!DL44:A21/4/1/1;
!!el;
  !!DL44:A21/4/0/1;
!!en;


!?FU(Set_Options_Presets);

  !!VRy1&x1=1:S1;                       [Easy]
  !!VRy1&x1=2:S2;                       [Normal]
  !!VRy1&x1=3:S3;                       [Hard]
  !!SN:W^Additionals_troops^/y1 W^Neutral_stats^/y1 W^Creature_banks^/y1 W^Neutral_exp^/y1;
  !!FU(Set_Stack_Size_Mod):Py1;

  !!VRy2&y1=0:S0;                       [Deavtivate]
  !!VRy2&y1=1:S42;                      [Easy]
  !!VRy2&y1=2:S28;                      [Normal]
  !!VRy2&y1=3:S21;                      [Hard]
  !!VRy2&y1=4:S14;                      [Very Hard]
  !!VRy2&y1=5:S10;                      [Extreme]
  !!VRy2&y1=6:S3;                       [Insane]
  !!VRy2&y1=7:S1;                       [Insane II]
  !!SN:W^Health_Grow_Enable^/y2;        [Healt_Grow_Rate]

  !!VRy2&y1=0:S0;                       [Deavtivate]
  !!VRy2&y1=1:S7;                       [Easy]
  !!VRy2&y1=2:S5;                       [Normal]
  !!VRy2&y1=3:S4;                       [Hard]
  !!VRy2&y1=4:S3;                       [Extreme]
  !!VRy2&y1=5:S1;                       [Insane]
  !!SN:W^Stack_Exp_Rate^/y2;            [Stack_Exp_Rate]

  !!FU(Set_Guarded_Object_Mod):Py1;


!?FU(Options_value);
*x1=DL_Number, x2=Item_ID, x3=switch_value
    !!SN:T^Diff_Mod.Level_%X3^/?z1;     [Read out level in text z1]
    !!DLx1:Ax2/3/z1/1;                  [Switch Text]


****************************************************************************************************

This Section handels the Dialogue 45 were you can Configure_AI (Right Side)


****************************************************************************************************

!?FU(Configure_AI);                     [open an AI difficulty settings]

!!SN:W^Legacy_of_the_Silence_Active^/?y1;[Check if LotS is active]
!!if&y1=1;  
  !!DL364:N^diff_Her2.txt^;             [parse DL]
  !!FU(Set_LotS_DL_Text):P;             [Set text fields for DL 364]
  !!DL364:S1;                           [Show complete Dialogue number 364]
!!en;
!!FU(Configure_AI_Custom)&y1=0:P;       [Jump to normal AI Dif mod settings]


!?FU(Set_LotS_DL_Text);

  !!SN:T^Diff_Mod.cancel_button_hint^/?z45; [left text]
  !!DL364:H30721/45;                    [set cancel button hint text]
  !!SN:T^Diff_Mod.confirm_button_hint_0^/?z46; [left text]
  !!DL364:H30722/46;                    [set confirm button hint text]

  !!SN:T^Diff_Mod.LotS_Dif_DL_Header^/?z70; !!DL364:A38/3/z70/1; [Text for Header]

  !!SN:T^Diff_Mod.LotS_Dif_DL_Text^/?z71; !!DL364:A17/3/z71/1; [Text for Header]
  
  !!SN:T^Diff_Mod.LotS_Option_1^/?z73; !!DL364:A41/3/z73/1; [Text for Option 1]
  !!SN:T^Diff_Mod.LotS_Option_2^/?z74; !!DL364:A44/3/z74/1; [Text for Option 2]
  !!SN:T^Diff_Mod.LotS_Option_3^/?z75; !!DL364:A45/3/z75/1; [Text for Option 3]
  !!SN:T^Diff_Mod.LotS_Option_4^/?z76; !!DL364:A46/3/z76/1; [Text for Option 4]
  !!SN:T^Diff_Mod.LotS_Option_5^/?z77; !!DL364:A47/3/z77/1; [Text for Option 5]
  !!SN:T^Diff_Mod.LotS_Option_6^/?z78; !!DL364:A24/3/z78/1; [Text for Option 6]
  !!SN:T^Diff_Mod.LotS_Option_7^/?z79; !!DL364:A22/3/z79/1; [Text for Option 7]
  !!SN:T^Diff_Mod.LotS_Option_8^/?z80; !!DL364:A23/3/z80/1; [Text for Option 8]
  !!SN:T^Diff_Mod.LotS_Option_9^/?z81; !!DL364:A15/3/z81/1; [Text for Option 9]
  !!SN:T^Diff_Mod.LotS_Option_10^/?z82; !!DL364:A25/3/z82/1; [Text for Option 10]
  !!SN:T^Diff_Mod.LotS_Option_11^/?z83; !!DL364:A26/3/z83/1; [Text for Option 11]
  !!SN:T^Diff_Mod.LotS_Option_12^/?z84; !!DL364:A14/3/z84/1; [Text for Option 12]

  !!SN:T^Diff_Mod.AI_Level_1^/?z50; !!DL364:H1/50; [Hint Text for Easy button]
  !!SN:T^Diff_Mod.AI_Level_2^/?z51; !!DL364:H2/51; [Hint Text for Medium button]
  !!SN:T^Diff_Mod.AI_Level_3^/?z52; !!DL364:H3/52; [Hint Text for Hard button]
  !!SN:T^Diff_Mod.AI_Level_4^/?z53; !!DL364:H4/53; [Hint Text for Extreme button]
  !!SN:T^Diff_Mod.AI_Level_5^/?z54; !!DL364:H5/54; [Hint Text for Insane button]
  !!SN:T^Diff_Mod.AI_Level_6^/?z56; !!DL364:H6/56; [Hint Text for Easy button]
  !!SN:T^Diff_Mod.AI_Level_7^/?z57; !!DL364:H7/57; [Hint Text for Medium button]
  !!SN:T^Diff_Mod.AI_Level_8^/?z58; !!DL364:H8/58; [Hint Text for Hard button]
  !!SN:T^Diff_Mod.AI_Level_9^/?z59; !!DL364:H9/59; [Hint Text for Extreme button]
  !!SN:T^Diff_Mod.AI_Level_10^/?z60; !!DL364:H10/60; [Hint Text for Insane button]
  !!SN:T^Diff_Mod.AI_Level_11^/?z61; !!DL364:H11/61; [Hint Text for Extreme button]
  !!SN:T^Diff_Mod.AI_Level_12^/?z62; !!DL364:H12/62; [Hint Text for Insane button]


!?DL&v998=364/v999>0/v999<13/v1000=13;  [LMB on the faces]
!!VRz16:S^Button.wav^;
!!SN:Pz16;                              [Play Sound]

!!CM:F?y33;

!!if&v999=1:;                           [set text for 1st]
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/1;
  !!SN:W^AIPayday^/30;
  !!SN:W^Progressive_Difficulty^/0;
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Recover_Losses^/0;
  !!SN:W^AI_Compensation^/0;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/0;
  !!SN:W^AI_has_no_DD1^/0;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A1/4/12/1;
  !!DL364:A101/4/1/1;
!!en:;

!!if&v999=2:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/1;
  !!SN:W^AIPayday^/25;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/45;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/0;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/0;
  !!SN:W^AI_has_no_DD1^/0;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A2/4/13/1;
  !!DL364:A102/4/1/1;
!!en:;

!!if&v999=3:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/2;
  !!SN:W^AIPayday^/25;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/45;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/0;
  !!SN:W^AI_has_no_DD1^/0;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A3/4/14/1;
  !!DL364:A103/4/1/1;
!!en:;

!!if&v999=4:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/2;
  !!SN:W^AIPayday^/20;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/35;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/1;
  !!SN:W^Difficulty_day2^/50;           [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/0;
  !!SN:W^AI_has_no_DD1^/0;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A4/4/15/1;
  !!DL364:A104/4/1/1;
!!en:;

!!if&v999=5:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/3;
  !!SN:W^AIPayday^/28;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/40;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/1;
  !!SN:W^Difficulty_day2^/60;           [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/0;
  !!SN:W^AI_has_no_DD1^/0;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A5/4/16/1;
  !!DL364:A105/4/1/1;
!!en:;

!!if&v999=6:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/4;
  !!SN:W^AIPayday^/28;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/60;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/0;
  !!SN:W^AI_has_no_DD1^/0;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A6/4/17/1;
  !!DL364:A106/4/1/1;
!!en:;

!!if&v999=7:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/3;
  !!SN:W^AIPayday^/20;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/28;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/1;
  !!SN:W^Difficulty_day2^/45;           [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/1;
  !!SN:W^AI_has_no_DD1^/1;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A7/4/18/1;
  !!DL364:A107/4/1/1;
!!en:;

!!if&v999=8:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/3;
  !!SN:W^AIPayday^/14;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/20;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/1;
  !!SN:W^Difficulty_day2^/40;           [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/1;
  !!SN:W^AI_has_no_DD1^/1;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A8/4/19/1;
  !!DL364:A108/4/1/1;
!!en:;

!!if&v999=9:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/4;
  !!SN:W^AIPayday^/14;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/28;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/1;
  !!SN:W^AI_has_no_DD1^/2;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A9/4/20/1;
  !!DL364:A109/4/1/1;
!!en:;

!!if&v999=10:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/4;
  !!SN:W^AIPayday^/1;
  !!SN:W^Progressive_Difficulty^/1;
  !!SN:W^Difficulty_day^/14;            [If option was not selected Set Difficulty_day to default 100]
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/1;
  !!SN:W^AI_has_no_DD1^/2;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A10/4/21/1;
  !!DL364:A110/4/1/1;
!!en:;

!!if&v999=11/y33<>4:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/5;
  !!SN:W^AIPayday^/1;
  !!SN:W^Progressive_Difficulty^/0;
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/1;
  !!SN:W^AI_has_no_DD1^/4;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!DL364:A11/4/22/1;
  !!DL364:A111/4/1/1;
  !!SN:T^Diff_Mod.AI_Level_11^/?z61; 
  !!DL364:H11/61;                       [Hint Text for Extreme button]
  !!SN:T^Diff_Mod.Level_crazy^/?z62;
  !!DL364:A26/3/z62;
!!en:;

!!if&v999=11/y33=4:;
  !!FU(AI_reset2):P;                    [reset all]
  !!SN:W^H3_Game_Difficulty^/5;
  !!SN:W^AIPayday^/1;
  !!SN:W^Progressive_Difficulty^/0;
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/1;
  !!SN:W^AI_has_no_DD1^/4;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/1;
  !!DL364:A11/4/24/1;
  !!DL364:A111/4/1/1;
  !!SN:T^Diff_Mod.AI_Level_13^/?z61; 
  !!DL364:H11/61;                       [Hint Text for Extreme button]
  !!SN:T^Diff_Mod.Level_crazy_max^/?z62;
  !!DL364:A26/3/z62;
!!en:;


!?DL&v998=364/v1000=14;                 [RMB on the faces to set text for information]

!!SN:T^Diff_Mod.Bonus11^/?z1;           [set text for 1st]
!!SN:T^Diff_Mod.Bonus12^/?z2;           [2nd]
!!SN:T^Diff_Mod.Bonus13^/?z3;           [...]
!!SN:T^Diff_Mod.Bonus14^/?z4;           [...]
!!SN:T^Diff_Mod.Bonus15^/?z5;           [...]
!!SN:T^Diff_Mod.Bonus16^/?z6;           [2nd]
!!SN:T^Diff_Mod.Bonus17^/?z7;           [...]
!!SN:T^Diff_Mod.Bonus18^/?z8;           [...]
!!SN:T^Diff_Mod.Bonus19^/?z9;           [...]
!!SN:T^Diff_Mod.Bonus20^/?z10;          [...]
!!SN:W^AI_Hell_Mod^/?y55;
!!SN&y55=0:T^Diff_Mod.Bonus21^/?z11;    [...]
!!SN&y55=1:T^Diff_Mod.Bonus23^/?z11;    [...]
!!SN:T^Diff_Mod.Bonus22^/?z12;          [...]

!!IF&v999=1:M0/4/z1;                    [show it 1 - 5]
!!IF&v999=2:M0/4/z2;
!!IF&v999=3:M0/4/z3;
!!IF&v999=4:M0/4/z4;
!!IF&v999=5:M0/4/z5;
!!IF&v999=6:M0/4/z6;                    [show it 1 - 5]
!!IF&v999=7:M0/4/z7;
!!IF&v999=8:M0/4/z8;
!!IF&v999=9:M0/4/z9;
!!IF&v999=10:M0/4/z10;
!!IF&v999=11:M0/4/z11;
!!IF&v999=12:M0/4/z12;


!?DL&v998=364/v999=30721/v1000=13;      [Reset Close]
!!SN:W^H3_Game_Difficulty^/0;           [When clicking exit reset all choices or set to default]
!!SN:W^AI_Recover_Losses^/1;
!!SN:W^AI_Compensation^/1;
!!SN:W^AI_Useful_Spells^/0;
!!SN:W^AI_has_no_DD^/0;
!!SN:W^Progressive_Difficulty^/0;
!!SN:W^Progressive_Difficulty2^/0;
!!SN:W^AI_Artifacts_Eq^/1;
!!SN:W^AI_Hell_Mod^/0;
!!SN:W^Dif_Mod_AI_Scaling^/0;
!!DL:C1;


!?DL&v998=364/v999=30722/v1000=13;      [Save Confirm and close LotS settings for AI]
!!DL:C1;


!?DL&v998=364/v999=12/v1000=13;         [LMB on the faces]
  !!FU(AI_reset2):P;                    [reset all]
  !!DL364:A12/4/23/1;
  !!DL364:A112/4/1/1;
  !!SN:W^H3_Game_Difficulty^/0;         
  !!SN:W^AI_Recover_Losses^/1;
  !!SN:W^AI_Compensation^/1;
  !!SN:W^AI_Useful_Spells^/0;
  !!SN:W^AI_has_no_DD^/0;
  !!SN:W^Progressive_Difficulty^/0;
  !!SN:W^Progressive_Difficulty2^/0;
  !!SN:W^AI_Artifacts_Eq^/1;
  !!SN:W^AI_Hell_Mod^/0;
  !!SN:W^Dif_Mod_AI_Scaling^/0;
  !!FU(Configure_AI_Custom):P;

!?FU(Configure_AI_Custom);              

  !!DL45:N^diff_Her.txt^;               [Name of Dialogue text file]
  !!SN:T^Diff_Mod.Level_Easy^/?z1 T^Diff_Mod.Level_Medium^/?z2 T^Diff_Mod.Level_Hard^/?z3 T^Diff_Mod.Level_Extreme^/?z4 T^Diff_Mod.Level_Insane^/?z5 T^Diff_Mod.Level_Choose_0^/?z6 T^Diff_Mod.quantity_0^/?z7; [Load Text]
  !!DL45:A41/3/z1/1 A44/3/z2/1 A45/3/z3/1 A46/3/z4/1 A47/3/z5/1 A38/3/z6/1 A11/3/z7/1; [Set text to text fields]

  !!SN:T^Diff_Mod.cancel_button_hint^/?z45; [left text]
  !!DL45:H30721/45;                     [set cancel button hint text]
  !!SN:T^Diff_Mod.confirm_button_hint_0^/?z46; [left text]
  !!DL45:H30722/46;                     [set confirm button hint text]

  !!SN:T^Diff_Mod.AI_Recover_Losses_0^/?z60; !!DL45:H60/60;[text and hint]
  !!SN:T^Diff_Mod.AI_Compensation_0^/?z61; !!DL45:H61/61;[text and hint]
  !!SN:T^Diff_Mod.AI_Useful_Spells_0^/?z62; !!DL45:H62/62;[text and hint]
  !!SN:T^Diff_Mod.AI_has_no_DD_0^/?z63; !!DL45:H63/63;[text and hint]
  !!SN:T^Diff_Mod.Progressive_Text_3_0^/?z64; !!DL45:H64/64;[text and hint]
  !!SN:T^Diff_Mod.AI_Artifacts_Eq_0^/?z65; !!DL45:H65/65;[text and hint]
  !!SN:T^Diff_Mod.AI_Unit_Scaling_0^/?z66; !!DL45:H66/66;[text and hint]
  !!DL45:A60/3/z60/1 A61/3/z61/1 A62/3/z62/1 A63/3/z63/1 A64/3/z64/1 A65/3/z65/1 A66/3/z66/1;

  !!SN:W^AI_Recover_Losses^/?y1;        [Check option]
  !!SN:W^AI_Compensation^/?y2;
  !!SN:W^AI_Useful_Spells^/?y3;
  !!SN:W^AI_has_no_DD^/?y4;
  !!SN:W^Progressive_Difficulty^/?y5;
  !!SN:W^AI_Artifacts_Eq^/?y6;
  !!SN:W^Dif_Mod_AI_Scaling^/?y7;
  !!DL45:A50/4/y1/1;                    [Set option cadre]
  !!DL45:A51/4/y2/1;
  !!DL45:A52/4/y3/1;
  !!DL45:A53/4/y4/1;
  !!DL45:A54/4/y5/1;
  !!DL45:A55/4/y6/1;
  !!DL45:A56/4/y7/1;

  !!SN:T^Diff_Mod.AI_Level_Easy^/?z50; !!DL45:H1/50; [Hint Text for Easy button]
  !!SN:T^Diff_Mod.AI_Level_Normal^/?z51; !!DL45:H2/51; [Hint Text for Medium button]
  !!SN:T^Diff_Mod.AI_Level_Hard^/?z52; !!DL45:H3/52; [Hint Text for Hard button]
  !!SN:T^Diff_Mod.AI_Level_Extreme^/?z53; !!DL45:H4/53; [Hint Text for Extreme button]
  !!SN:T^Diff_Mod.AI_Level_Insane^/?z54; !!DL45:H5/54; [Hint Text for Insane button]

  !!SN:T^Diff_Mod.Exp_Bonus^/?z55; !!DL45:H11/55; [Hint Text for Easy button]
  !!SN:T^Diff_Mod.Movement_Bonus^/?z56; !!DL45:H12/56; [Hint Text for Medium button]
  !!SN:T^Diff_Mod.Prim_Bonus^/?z57; !!DL45:H13/57; [Hint Text for Hard button]
  !!SN:T^Diff_Mod.Points_Bonus^/?z58; !!DL45:H14/58; [Hint Text for Extreme button]
  !!SN:T^Diff_Mod.Gold_Bonus^/?z59; !!DL45:H15/59; [Hint Text for Insane button]
  !!SN:T^Diff_Mod.Res_Bonus^/?z70; !!DL45:H16/70; [Hint Text for Hard button]
  !!SN:T^Diff_Mod.Crea_Bonus^/?z71; !!DL45:H17/71 H18/71 H19/71 H20/71 H21/71 H22/71 H23/71; [Hint Text for Creature button]

  !!SN:W^H3_Game_Difficulty^/?y1;
  !!VRv999&y1=0:S0; !!VRv999&y1=1:S1; !!VRv999&y1=2:S2; !!VRv999&y1=3:S3; !!VRv999&y1=4:S4; !!VRv999&y1=5:S5; [Preset difficulty to load cadres when difficulty was saved]
  !!FU(Configure_AI_Preset):P1;
  !!DL45:S1;                            [Show complete Dialogue number 45]


!?DL&v998=45/v999>0/v999<6/v1000=12;    [LMB on the faces]
  !!FU(Configure_AI_Preset):P;

!?FU(Configure_AI_Preset);
  !!VRz16:S^Button.wav^;
  !!SN:W^H3_Game_Difficulty^/?y1;

  !!if&x1=1;                            [Called from configuration window to preset cadres]
  !!VRv999&y1=0:S0; !!VRv999&y1=1:S1; !!VRv999&y1=2:S2; !!VRv999&y1=3:S3; !!VRv999&y1=4:S4; !!VRv999&y1=5:S5;
  !!VRy1:S0;
  !!en;

!!if&v999=1/y1<>1;                      [set text for 1st]
  !!FU(AI_reset):P;                     [reset all]
  !!SN:Pz16;                            [do not play sound again]
  !!VRz1:S^500^; !!VRz2:S^200^; !!SN:T^Diff_Mod.Zero_or_One^/?z3; !!VRz4:S^5^; !!VRz5:S^2000^; !!VRz6:S^1^;
  !!VRz8:S^2^; !!VRz9:S^2^; !!VRz10:S^1^; !!VRz11:S^1^; !!VRz12:S^0^; !!VRz13:S^0^; !!VRz14:S^0^;
  !!DL45:A1/4/1/1 A6/4/1/1 A40/4/1/1 A25/3/z1/1 A26/3/z2/1 A27/3/z3/1 A28/3/z4/1 A29/3/z5/1 A30/3/z6/1; [change faces + show borders + bonuses 1st]
  !!DL45:A31/3/z8/1 A32/3/z9/1 A33/3/z10/1 A34/3/z11/1 A35/3/z12/1 A36/3/z13/1 A37/3/z14/1; [creatures 1st]
  !!SN:W^H3_Game_Difficulty^/1;
!!en;

!!if&v999=2/y1<>2;
  !!FU(AI_reset):P;                     [reset all]
  !!SN:Pz16;                            [do not play sound again]
  !!VRz1:S^1000^; !!VRz2:S^300^; !!VRz3:S^1^; !!VRz4:S^10^; !!VRz5:S^3000^; !!VRz6:S^2^;
  !!VRz8:S^3^; !!VRz9:S^3^; !!VRz10:S^2^; !!VRz11:S^1^; !!VRz12:S^0^; !!VRz13:S^0^; !!VRz14:S^0^;
  !!DL45:A7/4/1/1 A2/4/3/1 A40/4/2/1 A25/3/z1/1 A26/3/z2/1 A27/3/z3/1 A28/3/z4/1 A29/3/z5/1 A30/3/z6/1; [2nd]
  !!DL45:A31/3/z8/1 A32/3/z9/1 A33/3/z10/1 A34/3/z11/1 A35/3/z12/1 A36/3/z13/1 A37/3/z14/1;
  !!SN:W^H3_Game_Difficulty^/2;
!!en;

!!if&v999=3/y1<>3;
  !!FU(AI_reset):P;                     [reset all]
  !!SN:Pz16;                            [do not play sound again]
  !!VRz1:S^2500^; !!VRz2:S^400^; !!SN:T^Diff_Mod.One_or_Two^/?z3; !!VRz4:S^15^; !!VRz5:S^4000^; !!VRz6:S^3^;
  !!VRz8:S^5^; !!VRz9:S^4^; !!VRz10:S^3^; !!VRz11:S^3^; !!VRz12:S^2^; !!VRz13:S^1^; !!VRz14:S^0^;
  !!DL45:A3/4/5/1 A8/4/1/1 A40/4/3/1 A25/3/z1/1 A26/3/z2/1 A27/3/z3/1 A28/3/z4/1 A29/3/z5/1 A30/3/z6/1; [3rd]
  !!DL45:A31/3/z8/1 A32/3/z9/1 A33/3/z10/1 A34/3/z11/1 A35/3/z12/1 A36/3/z13/1 A37/3/z14/1;
  !!SN:W^H3_Game_Difficulty^/3;
!!en;

!!if&v999=4/y1<>4;
  !!FU(AI_reset):P;                     [reset all]
  !!SN:Pz16;                            [do not play sound again]
  !!VRz1:S^5000^; !!VRz2:S^500^; !!VRz3:S^2^; !!VRz4:S^20^; !!VRz5:S^5000^; !!VRz6:S^5^;
  !!VRz8:S^7^; !!VRz9:S^6^; !!VRz10:S^5^; !!VRz11:S^4^; !!VRz12:S^3^; !!VRz13:S^1^; !!VRz14:S^1^;
  !!DL45:A9/4/1/1 A4/4/7/1 A40/4/4/1 A25/3/z1/1 A26/3/z2/1 A27/3/z3/1 A28/3/z4/1 A29/3/z5/1 A30/3/z6/1; [4th]
  !!DL45:A31/3/z8/1 A32/3/z9/1 A33/3/z10/1 A34/3/z11/1 A35/3/z12/1 A36/3/z13/1 A37/3/z14/1;
  !!SN:W^H3_Game_Difficulty^/4;
!!en;

!!if&v999=5/y1<>5;
  !!FU(AI_reset):P;                     [reset all]
  !!SN:Pz16;
  !!VRz1:S^10000^; !!VRz2:S^700^; !!SN:T^Diff_Mod.Two_or_Three^/?z3; !!VRz4:S^25^; !!VRz5:S^7000^; !!VRz6:S^6^;
  !!VRz8:S^7^; !!VRz9:S^6^; !!VRz10:S^5^; !!VRz11:S^4^; !!VRz12:S^3^; !!VRz13:S^1^; !!VRz14:S^1^;
  !!DL45:A31/3/z8/1 A32/3/z9/1 A33/3/z10/1 A34/3/z11/1 A35/3/z12/1 A36/3/z13/1 A37/3/z14/1; [5th only bonuses creatures]
  !!DL45:A25/3/z1/1 A26/3/z2/1 A27/3/z3/1 A28/3/z4/1 A29/3/z5/1 A30/3/z6/1 A10/4/1/1 A40/4/4/1; [5th only bonuses ]
  !!SN:W^H3_Game_Difficulty^/5;
  !!SN:W^Progressive_Difficulty^/0;
  !!DL45:A54/4/0/1;                     [Progressive Difficulty disabled because already selected Insane]
!!en;


!?DL&v998=45/v1000=14;                  [RMB on the faces to set text for information]

!!SN:T^Diff_Mod.Bonus1^/?z1;            [set text for 1st]
!!SN:T^Diff_Mod.Bonus2^/?z2;            [2nd]
!!SN:T^Diff_Mod.Bonus3^/?z3;            [...]
!!SN:T^Diff_Mod.Bonus4^/?z4;            [...]
!!SN:T^Diff_Mod.Bonus5^/?z5;            [...]

!!IF&v999=1:M0/4/z1;                    [show it 1 - 5]
!!IF&v999=2:M0/4/z2;
!!IF&v999=3:M0/4/z3;
!!IF&v999=4:M0/4/z4;
!!IF&v999=5:M0/4/z5;


!?DL&v998=45/v999>=50/v999<=56/v1000=12;[LMB on the options to switch it]
!!VRz1:S^Button.wav^;
!!SN:Pz1;                               [Play Sound]

!!SN:W^AI_Recover_Losses^/?y1;          [Check if options have already been activated]
!!SN:W^AI_Compensation^/?y2;
!!SN:W^AI_Useful_Spells^/?y3;
!!SN:W^AI_has_no_DD^/?y4;
!!SN:W^Progressive_Difficulty^/?y5;
!!SN:W^AI_Artifacts_Eq^/?y6;
!!SN:W^Dif_Mod_AI_Scaling^/?y7;

!!SN&v999=50/y1=0:W^AI_Recover_Losses^/1;[activate first]
!!SN&v999=50/y1=1:W^AI_Recover_Losses^/0;[deactivate first]
!!SN&v999=51/y2=0:W^AI_Compensation^/1;
!!SN&v999=51/y2=1:W^AI_Compensation^/0;
!!SN&v999=52/y3=0:W^AI_Useful_Spells^/1;
!!SN&v999=52/y3=1:W^AI_Useful_Spells^/0;
!!SN&v999=53/y4=0:W^AI_has_no_DD^/1;
!!SN&v999=53/y4=1:W^AI_has_no_DD^/0;
!!SN&v999=54/y5=0:W^Progressive_Difficulty^/1;
!!SN&v999=54/y5=1:W^Progressive_Difficulty^/0;
!!SN&v999=55/y6=0:W^AI_Artifacts_Eq^/1;
!!SN&v999=55/y6=1:W^AI_Artifacts_Eq^/0;
!!SN&v999=56/y7=0:W^Dif_Mod_AI_Scaling^/1;
!!SN&v999=56/y7=1:W^Dif_Mod_AI_Scaling^/0;

!!SN:W^AI_Recover_Losses^/?y1;          [Check if options have already been activated]
!!SN:W^AI_Compensation^/?y2;
!!SN:W^AI_Useful_Spells^/?y3;
!!SN:W^AI_has_no_DD^/?y4;
!!SN:W^Progressive_Difficulty^/?y5;
!!SN:W^AI_Artifacts_Eq^/?y6;
!!SN:W^Dif_Mod_AI_Scaling^/?y7;

[switch def cardre to 0 or 1]
!!DL45:A50/4/y1/1;                      [AI Recover Losses]
!!DL45:A51/4/y2/1;                      [AI Compensation]
!!DL45:A52/4/y3/1;                      [AI Useful Spells]
!!DL45:A53/4/y4/1;                      [AI has no DD]
!!DL45:A54/4/y5/1;                      [Progressive Difficulty]
!!DL45:A55/4/y6/1;                      [AI Artifacts Eq]
!!DL45:A56/4/y7/1;                      [AI Scaling]


!?DL&v998=45/v999>=60/v999<=66/v1000=14;[right click on the three pictures to show text for upgrade and description]

!!SN|v999=60:T^Diff_Mod.AI_Recover_Losses^/?s^Text^; [set text for 1st]
!!SN|v999=61:T^Diff_Mod.AI_Compensation^/?s^Text^;
!!SN|v999=62:T^Diff_Mod.AI_Useful_Spells^/?s^Text^;
!!SN|v999=63:T^Diff_Mod.AI_has_no_DD^/?s^Text^;
!!SN|v999=64:T^Diff_Mod.Progressive_Text_3^/?s^Text^;
!!SN|v999=65:T^Diff_Mod.AI_Artifacts_Eq^/?s^Text^;
!!SN|v999=66:T^Diff_Mod.AI_Unit_Scaling^/?s^Text^;
!!IF:M0/4/^%S(Text)^;


!?DL&v998=45/v999=30721/v1000=13;       [Reset Close]
!!SN:W^H3_Game_Difficulty^/0;           [When clicking exit reset all choices or set to default]
!!SN:W^AI_Recover_Losses^/1;
!!SN:W^AI_Compensation^/0;
!!SN:W^AI_Useful_Spells^/0;
!!SN:W^AI_has_no_DD^/0;
!!SN:W^Progressive_Difficulty^/0;
!!SN:W^AI_Artifacts_Eq^/1;
!!SN:W^Dif_Mod_AI_Scaling^/0;
!!DL:C1;


!?DL&v998=45/v999=30722/v1000=13;       [Save Confirm]
!!SN:W^H3_Game_Difficulty^/?y1;         [When clicking confirm save all choices]
!!DL:C1;
!!FU&y1=0:E;

!!SN:T^Diff_Mod.additionals options1^/?z1;
!!SN:W^AIPayday^/15;                    [If option was not selected Set Payday to default 15]

!!SN:T^Diff_Mod.Payday_Text_1^/?z-7;
!!SN:T^Diff_Mod.Payday_Text_2^/?z-8;
!!VRz1:S^^;                             [Initialize z1 to null: z1]
!!IF:D15/-7/-8/1/1/1/1/1/1/1/1/1/1/1/1/1;
!!IF:E1/15;                             [Display Input Box]
!!VRz1:H1;                              [Flag 1 is set to False if no text and True if text]
!!VRy6:Vz1;                             [Convert z1 to a value and store in y6]
!!IF:V2/1;                              [Initialize Flag 2 to True]
!!IF&y6<1:V2/0;                         [Set Flag 2 to False if y6 less than 1]
!!IF&y6>999:V2/0;                       [Set Flag 2 to False if y6 greater than 999]
!!SN:T^Diff_Mod.Out_Range_1^/?z-9;
!!IF|-2/-1:M^%Z-9^;                     [Out of Range Message]
!!VRy6|-2/-1:S15;
!!SN&2:W^AIPayday^/y6;

!!SN:W^Progressive_Difficulty^/?y1;
!!if&y1=1;
  !!SN:W^Difficulty_day^/100;           [If option was not selected Set Difficulty_day to default 100]
  !!SN:T^Diff_Mod.Progressive_Text_1^/?z-7;
  !!SN:T^Diff_Mod.Progressive_Text_2^/?z-8;
  !!VRz1:S^^;                           [Initialize z1 to null: z1]
  !!IF:D15/-7/-8/1/1/1/1/1/1/1/1/1/1/1/1/1;
  !!IF:E1/15;                           [Display Input Box]
  !!VRz1:H1;                            [Flag 1 is set to False if no text and True if text]
  !!VRy6:Vz1;                           [Convert z1 to a value and store in y6]
  !!IF:V2/1;                            [Initialize Flag 2 to True]
  !!IF&y6<0:V2/0;                       [Set Flag 2 to False if y6 less than 0]
  !!IF&y6>999:V2/0;                     [Set Flag 2 to False if y6 greater than 999]
  !!SN:T^Diff_Mod.Out_Range_2^/?z-9;
  !!IF|-2/-1:M^%Z-9^;                   [Out of Range Message]
  !!VRy6|-2/-1:S100;
  !!SN&2:W^Difficulty_day^/y6;
!!en;
!!FU(Set_LotS_DL_Text):P;


!?FU(AI_reset);
!!DL45:A1/4/0/1 A2/4/2/1 A3/4/4/1 A4/4/6/1 A40/4/0/1 A6/4/0/1 A7/4/0/1 A8/4/0/1 A9/4/0/1 A10/4/0/1; [reset all faces and remove visual selection]


!?FU(AI_reset2);
!!SN:W^Legacy_of_the_Silence_Active^/?y1; !!FU&y1=0:E; [Check if LotS is active]
!!FU(Set_LotS_DL_Text):P;

!!DL364:A1/4/0/1 A2/4/1/1 A3/4/2/1 A4/4/3/1 A5/4/4/1 A6/4/5/1 A7/4/6/1 A8/4/7/1 A9/4/8/1 A10/4/9/1 A11/4/10/1 A12/4/11/1 A101/4/0/1 A102/4/0/1 A103/4/0/1 A104/4/0/1 A105/4/0/1 A106/4/0/1 A107/4/0/1 A108/4/0/1 A109/4/0/1 A110/4/0/1 A111/4/0/1 A112/4/0/1; [reset all faces and remove visual selection]
!!SN:T^Diff_Mod.Level_crazy^/?z62;
!!DL364:A26/3/z62;
!!SN:T^Diff_Mod.AI_Level_11^/?z61; 
!!DL364:H11/61;                         [Hint Text for Extreme button]


********************************************************************************
!?FU(difm_SetDefaultOptions);
!!SN:W^Stack_Size_Enable^/0;            [Stack_Size_Modification]
!!SN:W^Health_Grow_Enable^/0;           [Healt_Grow_Rate deactivate]
!!SN:W^Guarded_Object_growth_Rate^/110; [10% Original Values]
!!SN:W^Guarded_Object_Faktor^/3;        [*1,5 Faktor  Original Values  more is better]
!!SN:W^Guarded_Object_Commander_Bonus_Att^/2; [Original Values  more is better]
!!SN:W^Guarded_Object_Commander_Bonus_Dmg^/2; [Original Values]
!!SN:W^Guarded_Object_Commander_Bonus_HP^/50; [Original Values]

!!SN:W^Stack_Exp_Rate^/0;

!!UN:P231/?y1;                          [Check Stack Exp option]
!!if&y1=1;
  !!VRy3:S7;                            [Just in case set to normal]
  !!UN:J2/?y2;                          [Player chosen difficulty level: y-2]
  !!VRy3&y2=0:S14;                      [Easy interval (14): y-3]
  !!VRy3&y2=1:S7;                       [Normal interval (7): y-3]
  !!VRy3&y2=2:S5;                       [Hard interval (5): y-3]
  !!VRy3&y2=3:S4;                       [Expert interval (4): y-3]
  !!VRy3&y2=4:S3;                       [Impossible interval (3): y-3]
  !!SN:W^Stack_Exp_Rate^/y3;
!!en;

!!SN:W^Double_Growth_Rate^/0;
!!SN:W^Low_Level_Growth^/0;
!!SN:W^Neutral_Growth_10000^/0;
!!SN:W^Double_Neutral_Stacks^/0;

!!SN:W^Tougher_Karmic_Battles_on^/0;
!!SN:W^Extra_Enchantments_on^/0;
!!SN:W^Random_Neutral_Hero^/0;
!!SN:W^More_Random_Stack_Size^/0;

!!SN:W^Neutral_Stack_Weekly_Upgrade^/0;
!!SN:W^Battle_Commander^/0;
!!SN:W^Neutral_Stack_Uptier1^/0;
!!SN:W^Neutral_Stack_Uptier2^/0;

!!SN:W^Random_Abilities^/0;
!!SN:W^Anzahl_Buffs^/0;
!!SN:W^Anzahl_Abilities^/0;
!!SN:W^Battle_Reward^/0;
!!SN:W^Battle_Reward_Active^/0;

!!SN:W^Stack_Size_Mod_L1^/0;            [Lvl 1]
!!SN:W^Stack_Size_Mod_L2^/0;            [Lvl 2]
!!SN:W^Stack_Size_Mod_L3^/0;            [Lvl 3]
!!SN:W^Stack_Size_Mod_L4^/0;            [Lvl 4]
!!SN:W^Stack_Size_Mod_L5^/0;            [Lvl 5]
!!SN:W^Stack_Size_Mod_L6^/0;            [Lvl 6]
!!SN:W^Stack_Size_Mod_L7^/0;            [Lvl 7]
!!SN:W^Stack_Size_Mod_L8^/0;            [Lvl 8]

; Reset the four options with arrows
!!VRi^Additionals_troops^:S(FALSE);
!!VRi^Neutral_stats^:S(FALSE);
!!VRi^Neutral_exp^:S(FALSE);
!!VRi^Creature_banks^:S(FALSE);

; Disable Mixed Neutrals
!!VRi^mix_enabled^:S(FALSE);

!?FU(difm_LoadInitialOptions);
!!FU(difm_SetDefaultOptions):P;

********************************************************************************
!?FU(Calc_Battle_Reward);

!!SN:W^Battle_Reward^/0;                [Reset Battle Reward]
!!SN&x2=1:W^Battle_Reward^/d20;         [+20% for Easy Settings Battle Reward]
!!SN&x2=2:W^Battle_Reward^/d30;         [+30% for Normal Settings Battle Reward]
!!SN&x2=3:W^Battle_Reward^/d50;         [+50% for Hard Settings Battle Reward]

!!SN:W^Double_Growth_Rate^/?y1;
!!SN&y1=1:W^Battle_Reward^/d5;

!!SN:W^Low_Level_Growth^/?y1;
!!SN&y1=1:W^Battle_Reward^/d5;

!!SN:W^Neutral_Growth_10000^/?y1;
!!SN&y1=1:W^Battle_Reward^/d3;

!!SN:W^Tougher_Karmic_Battles_on^/?y1;
!!SN&y1=1:W^Battle_Reward^/d3;

!!SN:W^Random_Neutral_Hero^/?y1;
!!SN&y1=1:W^Battle_Reward^/d4;

!!SN:W^More_Random_Stack_Size^/?y1;
!!SN&y1=1:W^Battle_Reward^/d2;

!!SN:W^Neutral_Stack_Weekly_Upgrade^/?y1;
!!SN&y1=1:W^Battle_Reward^/d4;

!!SN:W^Battle_Commander^/?y1;
!!SN&y1=1:W^Battle_Reward^/d3;

!!SN:W^Neutral_Stack_Uptier1^/?y1;
!!SN&y1=1:W^Battle_Reward^/d10;

!!SN:W^Double_Neutral_Stacks^/?y1;
!!SN&y1=1:W^Battle_Reward^/d10;

!!SN:W^Anzahl_Buffs^/?y1;               [Number_of_Buffs]
!!SN&y1=1:W^Battle_Reward^/d3;
!!SN&y1=2:W^Battle_Reward^/d7;
!!SN&y1=3:W^Battle_Reward^/d15;
!!SN&y1=4:W^Battle_Reward^/d20;

!!SN:W^Anzahl_Abilities^/?y1;           [Number_of_Abilities]
!!SN&y1=1:W^Battle_Reward^/d3;
!!SN&y1=2:W^Battle_Reward^/d10;
!!SN&y1=3:W^Battle_Reward^/d15;
!!SN&y1=4:W^Battle_Reward^/d25;

!!SN:W^Stack_Size_Enable^/?y1;
!!if&y1=1;
!!SN:W^Stack_Size_Mod_L1^/?y1;          [Lvl 1       [Stack_Size_Rate]
!!SN&y1=20:W^Battle_Reward^/d3;
!!SN&y1=30:W^Battle_Reward^/d6;
!!SN&y1=40:W^Battle_Reward^/d15;
!!SN&y1=70:W^Battle_Reward^/d25;
!!SN&y1=120:W^Battle_Reward^/d30;
!!en;

!!SN:W^Health_Grow_Enable^/?y1;         [Health_Rate]
!!if&y1>0;
!!SN&y1=42:W^Battle_Reward^/d3;
!!SN&y1=28:W^Battle_Reward^/d7;
!!SN&y1=21:W^Battle_Reward^/d10;
!!SN&y1=14:W^Battle_Reward^/d12;
!!SN&y1=7:W^Battle_Reward^/d18;
!!SN&y1=3:W^Battle_Reward^/d35;
!!SN&y1=1:W^Battle_Reward^/d45;
!!en;

!!SN:W^Stack_Exp_Rate^/?y1;             [Stack_Exp_Rate]
!!if&y1>0;
*!SN&y1=7:W^Battle_Reward^/d3;
*!SN&y1=5:W^Battle_Reward^/d5;
*!SN&y1=4:W^Battle_Reward^/d8;
*!SN&y1=3:W^Battle_Reward^/d12;
*!SN&y1=1:W^Battle_Reward^/d15;
!!en;

!!SN:W^Guarded_Object_Commander_Bonus_HP^/?y1; [Decide difficutly by checking Commander HP in chambers]
!!SN&y1=150:W^Battle_Reward^/d3;
!!SN&y1=200:W^Battle_Reward^/d5;
!!SN&y1=250:W^Battle_Reward^/d7;
!!SN&y1=400:W^Battle_Reward^/d13;
!!SN&y1=500:W^Battle_Reward^/d23;

!!SN:W^Dif_Mod_Neutral_Commander^/?y1;
!!SN&y1=1:W^Battle_Reward^/d3;

!!SN:W^Dif_Mod_Neutral_boost^/?y1;
!!SN&y1=1:W^Battle_Reward^/d3;

!!SN:W^Battle_Reward^/?y1;
!!SN:W^Battle_Reward_Active^/?y2;

!!VRx3:Sy1;                             [Pass Var back in y20]
!!VRy1&y2=0:S0;
!!SN:T^Diff_Mod.Reward_Chance^/?z1 Iz1/?z1;
!!DL44:A80/3/z1/1;                      [Update Text field for Battle Reward chance]


****************************************************************************************************



This Section handels the Dialogue 47 were you can Configure Mixed Neutrals



****************************************************************************************************
!?FU(Configure_Mixed_Neutrals);         [open the Neutrals difficulty settings and set all names of options]

  !!DL47:N^Mix_Neu.txt^;                [Name of Dialogue text file Parse Dialogue]

  !!SN:T^Diff_Mod.Level_Easy^/?z20 T^Diff_Mod.Level_Medium^/?z21 T^Diff_Mod.Level_Hard^/?z22 T^Diff_Mod.Level_Choose_1^/?z23; [Load Text]
  !!DL47:A43/3/z20/1 A47/3/z21/1 A45/3/z22/1 A38/3/z23/1; [Set text to text fields]

  !!SN:T^Diff_Mod.Option_20^/?z24 T^Diff_Mod.Option_21^/?z25 T^Diff_Mod.Option_22^/?z26 T^Diff_Mod.Option_23^/?z27; [Load correct text for options 1-16]
  !!DL47:A26/3/z24/1 A27/3/z25/1 A28/3/z26/1 A29/3/z27/1; [Set text to text fields]

  !!SN:T^Diff_Mod.Option_24^/?z1 T^Diff_Mod.Option_25^/?z2 T^Diff_Mod.Option_26^/?z3 T^Diff_Mod.Option_27^/?z4;
  !!DL47:A30/3/z1/1 A31/3/z2/1 A32/3/z3/1 A33/3/z4/1;

  !!SN:T^Diff_Mod.Option_28^/?z5 T^Diff_Mod.Option_29^/?z6 T^Diff_Mod.Option_30^/?z7 T^Diff_Mod.Option_31^/?z8;
  !!DL47:A34/3/z5/1 A35/3/z6/1 A36/3/z7/1 A37/3/z8/1;

  !!SN:T^Diff_Mod.Option_32^/?z9 T^Diff_Mod.Option_33^/?z10 T^Diff_Mod.Option_34^/?z11;
  !!DL47:A41/3/z9/1 A70/3/z10/1 A71/3/z11/1;

  !!SN:W^mix_minNumNeutralStacks^/?y13; !!VRz13:S^%Y13^; [Get value in z13]
  !!SN:W^mix_maxNumNeutralStacks^/?y14; !!VRz14:S^%Y14^;
  !!SN:W^mix_neutralStackScale^/?y15; !!VRz15:S^%Y15%^;
  !!SN:W^mix_neutralStackScaleForHuman^/?y16; !!VRz16:S^%Y16%^;
  !!SN:W^mix_minRelativeMonLevel^/?y17; !!VRz17:S^%Y17^;
  !!SN:W^mix_maxRelativeMonLevel^/?y18; !!VRz18:S^+%Y18^;

  !!DL47:A22/3/z13/1 A23/3/z14/1 A24/3/z15/1 A25/3/z16/1 A72/3/z17/1 A73/3/z18/1; [Preset options]
  !!FU(Mixed_Neutrals_checkboxes):P1;

  !!SN:T^Diff_Mod.cancel_button_hint^/?z43; [left text]
  !!DL47:H30721/43;                     [set cancel button hint text]
  !!SN:T^Diff_Mod.confirm_button_hint_0^/?z44; [left text]
  !!DL47:H30722/44;                     [set confirm button hint text]

  !!SN:T^Diff_Mod.Slot_Hint^/?z50; !!DL47:H80/50 H81/50 H82/50 H83/50 H84/50 H85/50 H86/50; [Hint Text for Slot 1-7]

  !!SN:W^mix_neutralStackScale_int^/1;
  !!SN:W^mix_neutralStackScaleForHuman_int^/1;
  !!if&y15>=10/y16>=10;                 [Convert input from scaling from 1 to 100, 2 to 120....]
    !!VRy20:Sy15:10;
    !!SN:W^mix_neutralStackScale_int^/y20;
    !!VRy21:Sy16:10;
    !!SN:W^mix_neutralStackScaleForHuman_int^/y21;
    !!SN&y20<=0:W^mix_neutralStackScale_int^/1;
    !!SN&y21<=0:W^mix_neutralStackScaleForHuman_int^/1;
  !!en;

  !!DL47:S1;                            [Show complete Dialogue number 47]


!?DL&v998=47/v999>46/v999<59/v1000=13;  [switch by little arrows for options 1-4]

!!if&v999=47;                           [If clicked on the left arrow]
   !!SN:W^mix_minNumNeutralStacks^/?y1; !!VRy2:Sy1; [Store value in y2]
   !!SN&y1>1:W^mix_minNumNeutralStacks^/d-1; [Reduce value by -1 if bigger zero]
   !!SN:W^mix_minNumNeutralStacks^/?y1; !!VRy3:Sy1; [Store value in y3]
   !!FU(Mixed_Neutrals_checkboxes)&y2<>y3:P1; [Change pictures only if value has changed]
   !!VRz47:S^%Y1^; !!DL47:A22/3/z47/1;  [Update text fields with new value]
!!en;
!!if&v999=48;
  !!SN:W^mix_minNumNeutralStacks^/?y1; !!VRy2:Sy1; [If clicked on the right arrow]
  !!SN:W^mix_maxNumNeutralStacks^/?y4;
  !!SN&y1<7:W^mix_minNumNeutralStacks^/d1;
  !!if&y4=y1;                           [if min and max have same value]
    !!SN&y1<7:W^mix_maxNumNeutralStacks^/d1;
    !!SN:W^mix_maxNumNeutralStacks^/?y1;
    !!VRz49:S^%Y1^; !!DL47:A23/3/z49/1; [Update max mixing textfield so one click increases both values simultaniously]
  !!en;
  !!SN:W^mix_minNumNeutralStacks^/?y1; !!VRy3:Sy1;
  !!FU(Mixed_Neutrals_checkboxes)&y2<>y3:P1;
  !!VRz47:S^%Y1^; !!DL47:A22/3/z47/1;
!!en;

!!if&v999=51;                           [neutralStackScale]
  !!SN:W^mix_neutralStackScale_int^/?y1;
  !!SN&y1>1:W^mix_neutralStackScale_int^/d-1;
  !!SN:W^mix_neutralStackScale_int^/?y1;
  !!FU(Mix_Neu_Neutrals_Scale):Py1/1;
!!en;
!!if&v999=52;                           [neutralStackScale]
  !!SN:W^mix_neutralStackScale_int^/?y1;
  !!SN&y1<46:W^mix_neutralStackScale_int^/d1;
  !!SN:W^mix_neutralStackScale_int^/?y1;
  !!FU(Mix_Neu_Neutrals_Scale):Py1/1;
!!en;

!!if&v999=49;                           [maxNumNeutralStacks]
  !!SN:W^mix_maxNumNeutralStacks^/?y1; !!VRy2:Sy1;
  !!SN:W^mix_minNumNeutralStacks^/?y4;
  !!SN&y1>1:W^mix_maxNumNeutralStacks^/d-1;
  !!if&y4=y1;
    !!SN&y1>1:W^mix_minNumNeutralStacks^/d-1;
    !!SN:W^mix_minNumNeutralStacks^/?y1;
    !!VRz47:S^%Y1^; !!DL47:A22/3/z47/1;
  !!en;
  !!SN:W^mix_maxNumNeutralStacks^/?y1; !!VRy3:Sy1;
  !!FU(Mixed_Neutrals_checkboxes)&y2<>y3:P1;
  !!VRz49:S^%Y1^; !!DL47:A23/3/z49/1;
!!en;
!!if&v999=50;                           [maxNumNeutralStacks]
  !!SN:W^mix_maxNumNeutralStacks^/?y1; !!VRy2:Sy1;
  !!SN&y1<7:W^mix_maxNumNeutralStacks^/d1;
  !!SN:W^mix_maxNumNeutralStacks^/?y1; !!VRy3:Sy1;
  !!FU(Mixed_Neutrals_checkboxes)&y2<>y3:P1;
  !!VRz49:S^%Y1^; !!DL47:A23/3/z49/1;
!!en;

!!if&v999=53;                           [neutralStackScaleForHuman]
  !!SN:W^mix_neutralStackScaleForHuman_int^/?y1;
  !!SN&y1>1:W^mix_neutralStackScaleForHuman_int^/d-1;
  !!SN:W^mix_neutralStackScaleForHuman_int^/?y1;
  !!FU(Mix_Neu_Neutrals_Scale):Py1/2;
!!en;
!!if&v999=54;                           [neutralStackScaleForHuman]
  !!SN:W^mix_neutralStackScaleForHuman_int^/?y1;
  !!SN&y1<46:W^mix_neutralStackScaleForHuman_int^/d1;
  !!SN:W^mix_neutralStackScaleForHuman_int^/?y1;
  !!FU(Mix_Neu_Neutrals_Scale):Py1/2;
!!en;

!!if&v999=55;                           [AggressionModifier]
  !!SN:W^mix_neutralsAggressionModifier^/?y1;
  !!SN&y1>-10:W^mix_neutralsAggressionModifier^/d-1;
  !!FU(Mixed_Neutrals_checkboxes):P;
!!en;
!!if&v999=56;                           [AggressionModifier]
  !!SN:W^mix_neutralsAggressionModifier^/?y1;
  !!SN&y1<10:W^mix_neutralsAggressionModifier^/d1;
  !!FU(Mixed_Neutrals_checkboxes):P;
!!en;

!!if&v999=57;                           [StackSpread]
  !!SN:W^mix_neutralStackSpread^/?y1;
  !!SN&y1>0:W^mix_neutralStackSpread^/d-1;
  !!FU(Mixed_Neutrals_checkboxes):P;
!!en;
!!if&v999=58;                           [StackSpread]
  !!SN:W^mix_neutralStackSpread^/?y1;
  !!SN&y1<5:W^mix_neutralStackSpread^/d1;
  !!FU(Mixed_Neutrals_checkboxes):P;
!!en;


!?DL&v998=47/v999>73/v999<78/v1000=13;  [switch by little arrows for options 1-4]

!!if&v999=74;                           [If clicked on the left arrow ]
   !!SN:W^mix_minRelativeMonLevel^/?y1; [Get value in y1]
   !!SN&y1>-6:W^mix_minRelativeMonLevel^/d-1; [Reduce value by -1 if bigger zero]
   !!SN:W^mix_minRelativeMonLevel^/?y1; [Get new value in y1]
   !!VRz72:S^%Y1^; !!DL47:A72/3/z72/1;
!!en;
!!if&v999=75;
  !!SN:W^mix_minRelativeMonLevel^/?y1;
  !!SN&y1<0:W^mix_minRelativeMonLevel^/d1;
  !!SN:W^mix_minRelativeMonLevel^/?y1;
  !!VRz72:S^%Y1^; !!DL47:A72/3/z72/1;
!!en;

!!if&v999=76;
  !!SN:W^mix_maxRelativeMonLevel^/?y1;
  !!SN&y1>0:W^mix_maxRelativeMonLevel^/d-1;
  !!SN:W^mix_maxRelativeMonLevel^/?y1;
  !!VRz73:S^+%Y1^; !!DL47:A73/3/z73/1;
!!en;
!!if&v999=77;
  !!SN:W^mix_maxRelativeMonLevel^/?y1;
  !!SN&y1<6:W^mix_maxRelativeMonLevel^/d1;
  !!SN:W^mix_maxRelativeMonLevel^/?y1;
  !!VRz73:S^+%Y1^; !!DL47:A73/3/z73/1;
!!en;


!?FU(Mix_Neu_Neutrals_Scale);
!!if&x2=1;
  !!SN:W^mix_neutralStackScale^/?y1;
  !!VRy1:S0;
  !!VRy1:+x1*10;
  !!SN:W^mix_neutralStackScale^/y1;
  !!VRz70:S^%Y1%^;
  !!DL47:A24/3/z70/1;
!!en;

!!if&x2=2;
  !!SN:W^mix_neutralStackScaleForHuman^/?y1;
  !!VRy1:S0;
  !!VRy1:+x1*10;
  !!SN:W^mix_neutralStackScaleForHuman^/y1;
  !!VRz71:S^%Y1%^;
  !!DL47:A25/3/z71/1;
!!en;


!?DL&v998=47/v999>9/v999<37/v1000=12;   [checkboxes switch between check and cancel]

!!FU|v999=13/v999=17/v999=22/v999=23/v999=24/v999=25/v999=26/v999=27/v999=28/v999=29:E; [Prevent action by wrong click]
!!VRz1:S^Button.wav^;
!!SN:Pz1;

[Check if options have already been activated]
!!SN:W^mix_generateMonstersByFactions^/?y1;
!!SN:W^mix_allowAlliedFactions^/?y2;
!!SN:W^mix_moveNeutralsToFactions^/?y3;
!!SN:W^mix_neutralsNeverEscape^/?y4;
!!SN:W^TUM_registerRegularMonsters^/?y5;
!!SN:W^mixconf_displayExactStackQuantities^/?y6;
!!SN:W^mixconf_showRegularViewDialog^/?y7;
!!SN:W^mix_neutralsAggressionModifier^/?y11;
!!SN:W^mix_neutralStackSpread^/?y12;
!!SN:W^Typhon_Third_Upgrade_Mod_Active^/?y13; [Check for Third Upgrade Mod]

  !!if|v999=10/v999=30;
  !!SN&y1=0:W^mix_generateMonstersByFactions^/1; [swith for 1st]
  !!SN&y1=1:W^mix_generateMonstersByFactions^/0;
  !!en;

  !!if|v999=11/v999=31;
  !!SN&y2=0:W^mix_allowAlliedFactions^/1;
  !!SN&y2=1:W^mix_allowAlliedFactions^/0;
  !!en;

  !!if|v999=12/v999=32;
  !!SN&y3=0:W^mix_moveNeutralsToFactions^/1;
  !!SN&y3=1:W^mix_moveNeutralsToFactions^/0;
  !!en;

  !!if|v999=14/v999=33;
  !!SN&y4=0:W^mix_neutralsNeverEscape^/1;
  !!SN&y4=1:W^mix_neutralsNeverEscape^/0;
  !!en;

  !!if|v999=15/v999=34;
  !!SN&y5=0/y13=1:W^TUM_registerRegularMonsters^/1; [Cannot be switched on if TUM is not enabled]
  !!SN&y5=1/y13=1:W^TUM_registerRegularMonsters^/0;
  !!en;

  !!if|v999=16/v999=35;
  !!SN&y7=0:W^mixconf_showRegularViewDialog^/1;
  !!SN&y7=1:W^mixconf_showRegularViewDialog^/0;
  !!en;

  !!if|v999=18/v999=36;
  !!SN&y6=0:W^mixconf_displayExactStackQuantities^/1;
  !!SN&y6=1:W^mixconf_displayExactStackQuantities^/0;
  !!en;

  !!SN&v999=19/y11=0:W^mix_neutralsAggressionModifier^/1;
  !!SN&v999=19/y11>0:W^mix_neutralsAggressionModifier^/0;

  !!SN&v999=21/y12=0:W^mix_neutralStackSpread^/1;
  !!SN&v999=21/y12>0:W^mix_neutralStackSpread^/0;

!!VRy99|v999=10:S1;                     [Only switch faces when clicking on the first two options]
!!FU(Mixed_Neutrals_checkboxes):Py99;   [call func for switch on the user's choice]


!?DL&v998=47/v1000=14;                  [Show right click information all options]

!!SN|v999=80/v999=81/v999=82/v999=83/v999=84/v999=85/v999=86:T^Diff_Mod.Slot_Example^/?s^Text^; [set text for 1st]
!!IF|v999=80/v999=81/v999=82/v999=83/v999=84/v999=85/v999=86:M0/4/^%S(Text)^; [show it 80 - 86]

!!SN&v999=30721:T^Diff_Mod.Cancel_Mixed_Settings^/?s^Text^; [...]
!!IF&v999=30721:M0/4/^%S(Text)^;

!!SN&v999=30722:T^Diff_Mod.Confirm_Mixed_Settings^/?s^Text^; [...]
!!IF&v999=30722:M0/4/^%S(Text)^;

!!if|v999=26/v999=22;
!!SN:T^Diff_Mod.Option_20_Info^/?s^Text^;[2nd]
!!IF:M0/4/^%S(Text)^;
!!en;

!!if|v999=27/v999=23;
!!SN:T^Diff_Mod.Option_21_Info^/?s^Text^;[2nd]
!!IF:M0/4/^%S(Text)^;
!!en;

!!if|v999=28/v999=24;
!!SN:T^Diff_Mod.Option_22_Info^/?s^Text^;[set text for 1st]
!!IF:M0/4/^%S(Text)^;
!!en;

!!if|v999=29/v999=25;
!!SN:T^Diff_Mod.Option_23_Info^/?s^Text^;[set text for 1st]
!!IF:M0/4/^%S(Text)^;
!!en;

*fixed options
!!SN&v999=30:T^Diff_Mod.Option_24_Info^/?s^Text^; [...]
!!IF&v999=30:M0/4/^%S(Text)^;

!!SN&v999=31:T^Diff_Mod.Option_25_Info^/?s^Text^; [...]
!!IF&v999=31:M0/4/^%S(Text)^;

!!SN&v999=32:T^Diff_Mod.Option_26_Info^/?s^Text^; [...]
!!IF&v999=32:M0/4/^%S(Text)^;

!!SN&v999=33:T^Diff_Mod.Option_27_Info^/?s^Text^; [...]
!!IF&v999=33:M0/4/^%S(Text)^;

!!SN&v999=34:T^Diff_Mod.Option_28_Info^/?s^Text^; [...]
!!IF&v999=34:M0/4/^%S(Text)^;

!!SN&v999=35:T^Diff_Mod.Option_29_Info^/?s^Text^; [...]
!!IF&v999=35:M0/4/^%S(Text)^;

!!SN&v999=36:T^Diff_Mod.Option_30_Info^/?s^Text^; [...]
!!IF&v999=36:M0/4/^%S(Text)^;

!!SN&v999=37:T^Diff_Mod.Option_31_Info^/?s^Text^; [...]
!!IF&v999=37:M0/4/^%S(Text)^;

!!SN&v999=41:T^Diff_Mod.Option_32_Info^/?s^Text^; [...]
!!IF&v999=41:M0/4/^%S(Text)^;

!!if|v999=70/v999=72;
!!SN:T^Diff_Mod.Option_33_Info^/?s^Text^;[...]
!!IF:M0/4/^%S(Text)^;
!!en;

!!if|v999=71/v999=73;
!!SN:T^Diff_Mod.Option_34_Info^/?s^Text^;[...]
!!IF:M0/4/^%S(Text)^;
!!en;


!?DL&v998=47/v999=30721/v1000=13;       [When clicking on the close Button in Neutral Dif Exit and reset all options]
!!DL:C1;
!!FU(mix_LoadGlobalConfig):P;           [Load Default settings from json again]


!?DL&v998=47/v999=30722/v1000=13;       [Close Dialogue with Confirm Button Save all Settings]
!!DL:C1;


!?FU(Mixed_Neutrals_checkboxes);        [Set checkboxes function]
!!SN:W^mix_generateMonstersByFactions^/?y1 W^mix_allowAlliedFactions^/?y2 W^mix_moveNeutralsToFactions^/?y3;
!!SN:W^mix_neutralsNeverEscape^/?y4 W^TUM_registerRegularMonsters^/?y5 W^mixconf_displayExactStackQuantities^/?y6;
!!SN:W^mixconf_showRegularViewDialog^/?y7 W^mix_neutralsAggressionModifier^/?y11 W^mix_neutralStackSpread^/?y12;
!!VRy7:-1*-1;                           [Invert Custom Monster Hud field]
!!VRz1:S^%Y11^;
!!VRz2:S^%Y12^;

!!DL47:A10/4/y1/1 A11/4/y2/1 A12/4/y3/1;
!!DL47:A14/4/y4/1 A15/4/y5/1 A18/4/y6/1;
!!DL47:A16/4/y7/1 A59/3/z1/1 A60/3/z2/1;

!!DL47:A19/4/1/1;
!!DL47&y11=0:A19/4/0/1;

!!if&y12>0;
  !!DL47:A21/4/1/1;
!!el;
  !!DL47:A21/4/0/1;
!!en;

!!FU&x1=0:E;                            [Exit if creature pictures should not change]

!!SN:W^mix_minNumNeutralStacks^/?y20;
!!SN:W^mix_maxNumNeutralStacks^/?y21;
!!SN:W^mix_generateMonstersByFactions^/?y22;
!!SN:W^Typhon_Third_Upgrade_Mod_Active^/?y30; [Check for Third Upgrade Mod]

!!VRy23:S0T7;
!!VRy24:Sy23*14+1;
!!VRy25:S0T2;

!!if&y20=1/y21=1;                       [If no mixing]
  !!VRy1:S2T121;                        [Generate random creature picture]
  !!VRy1&y30=1/y25=2:S199T130;          [Generate random creature picture with TUM enabled]
  !!FU(Mixed_Neutrals_Picture_Slots):Py1/y1/y1/y1/y1/y1/y1;
!!en;

!!if&y21=2;                             [If max 2 different creatures]
  !!VRy1&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy2&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy1&y22=0/y30=1/y25=2:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy2&y22=0/y30=1/y25=2:S199T130;    [Generate random creature picture with TUM enabled]

  !!VRy1&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy2&y22=1:S1T13+y24;               [Generate random creature picture]
  !!FU(Mixed_Neutrals_Picture_Slots):Py1/y2/y1/y2/y1/y2/y1;
!!en;

!!if&y21=3;                             [If max 3 different creatures]
  !!VRy1&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy2&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy3&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy1&y22=0/y30=1/y25=0:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy2&y22=0/y30=1/y25=1:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy3&y22=0/y30=1/y25=4:S199T130;    [Generate random creature picture with TUM enabled]

  !!VRy1&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy2&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy3&y22=1:S1T13+y24;               [Generate random creature picture]
  !!FU(Mixed_Neutrals_Picture_Slots):Py1/y1/y3/y3/y3/y2/y2;
!!en;

!!if&y21=4;                             [If max 4 different creatures]
  !!VRy1&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy2&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy3&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy4&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy1&y22=0/y30=1/y25=0:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy2&y22=0/y30=1/y25=1:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy3&y22=0/y30=1/y25=4:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy4&y22=0/y30=1/y25=2:S199T130;    [Generate random creature picture with TUM enabled]

  !!VRy1&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy2&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy3&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy4&y22=1:S1T13+y24;               [Generate random creature picture]
  !!FU(Mixed_Neutrals_Picture_Slots):Py1/y2/y3/y4/y1/y2/y3;
!!en;

!!if&y21=5;                             [If max 5 different creatures]
  !!VRy1&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy2&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy3&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy4&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy5&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy1&y22=0/y30=1/y25=4:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy2&y22=0/y30=1/y25=0:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy3&y22=0/y30=1/y25=1:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy4&y22=0/y30=1/y25=4:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy5&y22=0/y30=1/y25=2:S199T130;    [Generate random creature picture with TUM enabled]

  !!VRy1&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy2&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy3&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy4&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy5&y22=1:S1T13+y24;               [Generate random creature picture]
  !!FU(Mixed_Neutrals_Picture_Slots):Py1/y2/y3/y4/y5/y2/y1;
!!en;

!!if&y21=6;                             [If max 6 different creatures]
  !!VRy1&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy2&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy3&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy4&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy5&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy6&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy1&y22=0/y30=1/y25=0:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy2&y22=0/y30=1/y25=4:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy3&y22=0/y30=1/y25=1:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy4&y22=0/y30=1/y25=1:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy5&y22=0/y30=1/y25=2:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy6&y22=0/y30=1/y25=4:S199T130;    [Generate random creature picture with TUM enabled]

  !!VRy1&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy2&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy3&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy4&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy5&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy6&y22=1:S1T13+y24;               [Generate random creature picture]
  !!FU(Mixed_Neutrals_Picture_Slots):Py1/y2/y3/y4/y5/y6/y1;
!!en;

!!if&y21=7;                             [If max 7 different creatures]
  !!VRy1&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy2&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy3&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy4&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy5&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy6&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy7&y22=0:S2T121;                  [Generate random creature picture]
  !!VRy1&y22=0/y30=1/y25=4:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy2&y22=0/y30=1/y25=0:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy3&y22=0/y30=1/y25=1:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy4&y22=0/y30=1/y25=0:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy5&y22=0/y30=1/y25=1:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy6&y22=0/y30=1/y25=2:S199T130;    [Generate random creature picture with TUM enabled]
  !!VRy7&y22=0/y30=1/y25=4:S199T130;    [Generate random creature picture with TUM enabled]

  !!VRy1&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy2&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy3&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy4&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy5&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy6&y22=1:S1T13+y24;               [Generate random creature picture]
  !!VRy7&y22=1:S1T13+y24;               [Generate random creature picture]
  !!FU(Mixed_Neutrals_Picture_Slots):Py1/y2/y3/y4/y5/y6/y7;
!!en;

!?FU(Mixed_Neutrals_Picture_Slots);

  !!DL47:A80/4/x1/1;                    [First Slot Picture]
  !!DL47:A81/4/x2/1;
  !!DL47:A82/4/x3/1;
  !!DL47:A83/4/x4/1;
  !!DL47:A84/4/x5/1;
  !!DL47:A85/4/x6/1;
  !!DL47:A86/4/x7/1;

****************************************************************************************************


****************************************************************************************************
!?FU(Game_Difficulty_Options);
!!FU(difm_LoadInitialOptions):P;        [Load Initial Settings]
!!FU(difm_LoadOptionsFromIni):P;        [Try to load options from ini]
!!SN:W^Option_Timer^/1;

******************************

!!UN:R7/1/0;
!!UN:R5/1/0;                            [change mouse pointer]

!!DL13:N^diff_set.txt^;                 [this command is necessary to load a dialog template]

!!SN:W^Advanced_Classes_Mod_Active^/?y1;
!!SN&y1=0:T^Diff_Mod.Welcome_Message_0^/?z1; [When play without ACM]
!!SN&y1=1:T^Diff_Mod.Welcome_Message_1^/?z1; [When played together with Advanced_Classes_Mod_Active]
!!SN:T^Diff_Mod.Configure_Neutrals^/?z2;[left text]
!!SN:T^Diff_Mod.Configure_AI^/?z3;      [right text]
!!DL13:A3/3/z1/1;                       [Update Text field for Battle Reward chance]
!!DL13:A4/3/z2/1;                       [Update Text field for Battle Reward chance]
!!DL13:A5/3/z3/1;                       [Update Text field for Battle Reward chance]

!!SN:T^Diff_Mod.neutral_left_hint^/?z47;[left text]
!!DL13:H1/47;                           [set left hint text]
!!SN:T^Diff_Mod.AI_right_hint^/?z48;    [left text]
!!DL13:H2/48;                           [set right hint text]
!!SN:T^Diff_Mod.confirm_button_hint^/?z49; [left text]
!!DL13:H30722/49;                       [Set hint text for conformation button]
!!DL13:S1;                              [show dialog]

!!VRy10:Sc;                             [Deactivate the options for this Day]
!!SN&y10>0:W^Option_Timer^/y10;

!!SN:W^Neutrals_Difficulty_Enabled^/?y1;
!!SN:W^H3_Game_Difficulty^/?y2;
!!SN&y1=0/y2=0:T^Diff_Mod.Difficulty_Disabled^/?z4;
!!IF&y1=0/y2=0:L^%Z4^;

!!SN:W^AIPayday^/?y10;

!!SN:W^H3_Game_Difficulty^/?y1;
!!SN:W^Neutrals_Difficulty_Enabled^/?y2;

!!SN&y1=1:T^Diff_Mod.AI_Level_Easy^/?z5;
!!SN&y1=2:T^Diff_Mod.AI_Level_Normal^/?z5;
!!SN&y1=3:T^Diff_Mod.AI_Level_Hard^/?z5;
!!SN&y1=4:T^Diff_Mod.AI_Level_Extreme^/?z5;
!!SN&y1=5:T^Diff_Mod.AI_Level_Insane^/?z5;

!!SN&y1>0:T^Diff_Mod.Difficulty_Enabled^/?s^Text^/^day^/y10/^level^/^%Z5^; [AI active]
!!IF&y1>0:L^%S(Text)^;
!!SN&y2=1:T^Diff_Mod.Difficulty_Enabled_1^/?s^Text^; [Neutrals active]
!!IF&y2=1:L^%S(Text)^;

!!SN:W^Stack_Size_Enable^/?y1;
!!UN&y1>0:P232/1;                       [Activate Neutral Units script]

!!SN:W^Health_Grow_Enable^/?y2;
!!SN:W^Extra_Enchantments_on^/?y4;
!!SN:W^Anzahl_Abilities^/?y7;
!!UN|y2>0/y4>0/y7>0:P57/1;              [Activate Neutral Units script]

!!SN:W^Guarded_Object_Commander_Bonus_HP^/?y3;
!!UN&y3>50:P235/1;                      [Activate Creature Banks script]

!!SN:W^Tougher_Karmic_Battles_on^/?y5;
!!UN&y5>0:P38/1;                        [Activate Karmic Battle script]
!!UN:P38/?v491;                         [** v491=1 if Karmic Battles is enabled]

!!SN:W^Random_Neutral_Hero^/?y6;
!!UN&y6>0:P72/1;                        [Activate Neutral Hero script]

; Enable Neutral Stack Exp option if either Neutral Exp option or Abilities option from Difficulty Mod is enabled
!!UN|i^Stack_Exp_Rate^>0/i^Anzahl_Abilities^>0:P231/1;                       [Enable Neutral Stack Experience Option if player made a Stack Exp selection]

!!FU(difm_SaveOptionsToIni):P;

********************************************************************************
When clicking on System Icon at Adventure Map run options again

!?CM&1000;
!!CM:F?v3 I?v4 S?v5;                    [where we click and click subtype]
!!if&v3=512/v4=10;                      [if right click on System Icon  are clicked]

!!VRy11:Sc;                             [Set y11 to current day]
!!SN:W^Option_Timer^/?y10;
!!SN&y10>=y11:T^Diff_Mod.Try_Tomorrow^/?s^Text^;
!!IF&y10>=y11:M^%S(Text)^;
!!FU&y10>=y11:E;                        [Deactivate the options for 1 Week]

!!SN:T^Diff_Mod.Redo_Options^/?z1;      [Show Dialogue if Player activated the 10 skills option]
!!IF:Q1^%Z1^;
!!FU&-1:E;                              [Exit if denied]

!!VRy10:Sc;
!!SN:W^Option_Timer^/y10;

!!FU(Game_Difficulty_Options):P;

!!SN:W^Stack_Size_Enable^/?y1;          [Run function again to place additional Monsters on Map]
!!if&y1=1;
!!UN:U54/-1/?y2;                        [Number of monsters on the map: y2]
!!VRv2:S-1;                             [Initialize v1 to -1 to work with new faster UN:U syntax]
!!DO5402/1/y2/1&y2>0:P;                 [Cycle through all monsters]
!!SN:W^Stack_Size_Enable^/0;            [Deactivate the Option]
!!en;

!!SN:W^Neutral_Stack_Uptier1^/?y1;
!!if&y1=1;
!!UN:U54/-1/?y2;                        [Number of monsters on the map: y2]
!!VRv1:S-1;
!!DO(Diff_Funtion_87)/1/y2/1:P1/2;      [Cycle through all monsters]
!!FU(H3Quests_RefreshData):P(FALSE);
!!SN:W^Neutral_Stack_Uptier1^/0;        [Deactivate the Option]
!!en;


!!SN:W^Double_Neutral_Stacks^/?y1; 
!!if&y1=1;
!!UN:U54/-1/?y2;                        [Number of monsters on the map: y2]
!!VRv2:S-1;
!!DO(Diff_Funtion_86)/1/y2/1:P;         [Cycle through all monsters]
!!SN:W^Double_Neutral_Stacks^/0;        [Deactivate the Option]
!!en;

!!FU(difm_SaveOptionsToIni):P;

********************************************************************************


               Stack Growth and Manipulation Section



********************************************************************************
!?FU(OnEveryDay)&i^timerOnce^=1/i^timerDay^=1; [At first day of Map]
!!SN:W^Neutral_Stack_Uptier1^/?y1;
!!FU&y1=0:E;                            [Exit if no option selected]

!!UN:U54/-1/?y2;
!!VRv2:S-1;

!!VRy5&y1=1:S1;
!!VRy6&y1=1:S2;

!!DO(Diff_Funtion_87)/1/y2/1:Py5/y6;
!!FU(H3Quests_RefreshData):P(FALSE);

!!SN:W^Neutral_Stack_Uptier1^/0;


********************************************************************************

!?FU(OnEveryDay)&i^timerOnce^=1/i^timerDay^>=1/i^timerWeekDay^=1; [Every Monday and Once]
!!SN:W^Double_Growth_Rate^/?y50;
!!SN:W^Low_Level_Growth^/?y51;
!!SN:W^Neutral_Growth_10000^/?y52;
!!SN:W^Neutral_Stack_Weekly_Upgrade^/?y54;
!!SN:W^Double_Neutral_Stacks^/?y55;

!!FU&y50=0/y51=0/y52=0/y54=0/y55=0:E;   [Exit if no option selected]

!!UN:U54/-1/?y2;
!!VRv2:S-1;
!!SN:W^Map_Monster_Count^/y2;

!!DO(Diff_Funtion_86)/1/y2/1:P;
!!SN:W^Map_Monster_Upgrade_Count^/0;    [Reset Count to zero]
!!SN:W^Double_Neutral_Stacks^/0;        [Disable so it does not run every monday]
!!SN:W^Double_Neutral_Stacks_Map_Start^/1; [Activate the flag for later use]

********************************************************************************
!?FU(Diff_Funtion_86);

!!VRv2&x16=1:S-1;
!!UN:U54/-1/-1/2;
!!MOv2/v3/v4:O?y1 R?y40/1;
!!FU|y1=1/y40=0:E;                      [Exit if forbidden to Grow or if Set to always join]

!!SN:W^Typhon_Third_Upgrade_Mod_Active^/?y99; [Check for TUM]
!!VRy80:Sc;                             [Set to current day]
!!SN:W^Neutral_Stack_Weekly_Upgrade^/?y60;
!!if&y60=1/y80>1;
!!SN:W^Map_Monster_Count^/?y10;
!!SN:W^Map_Monster_Upgrade_Count^/?y12;
!!VRy11:Sy10:20 +1;                     [5%]
!!OBv2/v3/v4:U?y2;                      [Monster Type]
!!VRy20:S0R5;
  !!if&y2>=0/y2<=118/y12<y11/y20=1;
  !!MOv2/v3/v4:G?y3;                    [Check Monster Numbers]
  !!MA:Uy2/?y4;                         [Check if upgradable -2 means no]
  !!MA:Ly2/?y5;                         [Check Level 0-6]
    !!if&y4=-1/y99=0;                   [For default upgrade (-1) without TUM]
      !!VRy2:+1;
      !!MA:Ly2/?y6;
        !!if&y5=y6;
          !!UN:Ov2/v3/v4/1/0;
          !!UN:Iv2/v3/v4/54/y2/54/y2/-1/0;
          !!VRy3&y3>4000:S4000;
          !!MOv2/v3/v4:Gy3;
          !!SN:W^Map_Monster_Upgrade_Count^/d+1; [No More Upgrades than 6% per week of monsters on map]
       !!en;
  !!en;
    !!if&y99=1;
    !!if|y4=-1/y4>0;                    [For default upgrade (-1) TUM]
      !!VRy2&y4=-1:+1;
      !!VRy2&y4>0:Sy4;
      !!MA:Ly2/?y6;
        !!if&y5=y6;
          !!UN:Ov2/v3/v4/1/0;
          !!UN:Iv2/v3/v4/54/y2/54/y2/-1/0;
          !!VRy3&y3>4000:S4000;
          !!MOv2/v3/v4:Gy3;
          !!SN:W^Map_Monster_Upgrade_Count^/d+1; [No More Upgrades than 6% per week of monsters on map]
       !!en;
  !!en;
  !!en;
!!en;
!!en;

!!SN:W^Neutral_Growth_10000^/?y50;
!!if&y50=1;                             [if option is active]
  !!MOv2/v3/v4:G?y3;                    [Check Monster Numbers]
  !!VRy5:Sc;                            [Get current day]
  !!SN&y3=4000:W^Growth_X%V2_Y%V3_Z%V4^/?y4; [Check if the flag has been set before]
  !!SN&y3=4000/y4=0:W^Growth_X%V2_Y%V3_Z%V4^/y5; [Set flag on coordinates and save the current day to calculate growth]
!!en;

!!SN:W^Double_Growth_Rate^/?y52;
!!if&y52=1/y80>1;                       [If y52 bigger current day]
  !!MOv2/v3/v4:G?y3;                    [Check Monster Numbers]
  !!VRy6:Sy3 *5 :100 +y3;               [+5% extra Growth]
  !!VRy6&y6>4000:S4000;
  !!MOv2/v3/v4:Gy6;
!!en;

!!SN:W^Low_Level_Growth^/?y53;
!!if&y53=1/y80>1;
  !!OBv2/v3/v4:U?y1;
  !!MA:Ly1/?y2;                         [Check Level of Monsters]
  !!MOv2/v3/v4:G?y3;                    [Check Monster Numbers again]

  !!VRy5&y2=0:S10;                      [Extra 10% Growth for Level 1]
  !!VRy5&y2=1:S5;                       [Extra 5% Growth for Level 2]
  !!VRy5&y2=2:S4;                       [Extra 4% Growth for Level 3]
  !!VRy5&y2=3:S3;                       [Extra 3% Growth for Level 4]
  !!VRy5&y2=4:S2;                       [Extra 2% Growth for Level 5]
  !!VRy5&y2=5:S1;                       [Extra 1% Growth for Level 6]
  !!VRy5&y2=6:S1;                       [Extra 1% Growth for Level 7]

  !!VRy6:Sy3 *y5 :100 +y3;
  !!VRy6&y6>4000:S4000;
  !!MOv2/v3/v4:Gy6;
!!en;

!!SN:W^Double_Neutral_Stacks^/?y54;
!!if&y54=1;
  !!MOv2/v3/v4:G?y3;                    [Check Monster Numbers again]
  !!VRy6:Sy3*2;                         [Well fuck it, just double it again]
  !!VRy6&y6>4000:S4000;
  !!MOv2/v3/v4:Gy6;
!!en;

********************************************************************************
Growth Beyond 4000 option
Calculate and set increased stack size for neutral units when the combat starts
*Custom_growth limit can be set here*
!#SN:W^Growth_Limit_Lvl_1^/20000;       [Set growth limit for level 1 creatures, in this example 20000]
!#SN:W^Growth_Limit_Lvl_2^/18000;       [...]
!#SN:W^Growth_Limit_Lvl_3^/16000;       [...]
!#SN:W^Growth_Limit_Lvl_4^/14000;       [...]
!#SN:W^Growth_Limit_Lvl_5^/12000;       [...]
!#SN:W^Growth_Limit_Lvl_6^/10000;       [...]
!#SN:W^Growth_Limit_Lvl_7^/8000;        [Set growth limit for level 7 creatures]


!?FU(OnBeforeBattleUniversal)&1000;     [Before battle only run for humans]

!!SN:W^Neutral_Growth_10000^/?y50;
!!FU&y50=0:E;

!!BA:P?y1/?y2/?y3;                      [get monsters or battle coordinates]
!!SN:W^Growth_X%Y1_Y%Y2_Z%Y3^/?y4;      [check if this stack should have grown beyond 4000]
!!FU&y4=0:E;                            [Exit if stack has not grown to 4000]

!!MOy1/y2/y3:G?y50;                     [Get stack size]
!!FU&y50<3900:E;                        [Exit if stack has not regrown to 4000]

!!BA:H0/?y50;                           [Attacking Hero Number]
!!SN:W^Growth_Happened^/y50;

!!VRy5:Sc;                              [Get current day]
!!VRy6:Sy5 -y4 :7 -1;                   [Weeks passed]
!!FU&y5<=7:E;                           [Exit in first Week]
!!FU&y6=-1:E;                           [Exit if its the same week as it hit 4000. Growth first starts next week]

!!FU(Dif_Mod_Calc_Stack_Size):Py1/y2/y3/?y10; [Pass coordinates of stack, and return stack size in y10]

!!VRy30:S0;                             [Check the number of stacks and determine how many stacks have troops]
!!BA:M1/0/?y1/?y21; !!VRy30&y1>=0:+1;
!!BA:M1/1/?y2/?y22; !!VRy30&y2>=0:+1;
!!BA:M1/2/?y3/?y23; !!VRy30&y3>=0:+1;
!!BA:M1/3/?y4/?y24; !!VRy30&y4>=0:+1;
!!BA:M1/4/?y5/?y25; !!VRy30&y5>=0:+1;
!!BA:M1/5/?y6/?y26; !!VRy30&y6>=0:+1;
!!BA:M1/6/?y7/?y27; !!VRy30&y7>=0:+1;

!!SN:W^Growth_Limit_Lvl_1^/?y40; !!VRy40:F4000/1000000; [Get growth limit for level 1 creatures, must be bigger than 4000 and smaller than 1000000]
!!SN:W^Growth_Limit_Lvl_2^/?y41; !!VRy41:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_3^/?y42; !!VRy42:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_4^/?y43; !!VRy43:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_5^/?y44; !!VRy44:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_6^/?y45; !!VRy45:F4000/1000000; [...]
!!SN:W^Growth_Limit_Lvl_7^/?y46; !!VRy46:F4000/1000000; [Get growth limit for level 7 creatures]

!!MA:Ly1/?y28;                          [Get Level of First Monster to decide the growth Limit, if stack has grown more it will be reduced to max value]
!!VRy10&y28=0/y10>y40:Sy40;             [Level 1 Monster can grow up to 20000]
!!VRy10&y28=1/y10>y41:Sy41;
!!VRy10&y28=2/y10>y42:Sy42;
!!VRy10&y28=3/y10>y43:Sy43;
!!VRy10&y28=4/y10>y44:Sy44;
!!VRy10&y28=5/y10>y45:Sy45;
!!VRy10&y28=6/y10>y46:Sy46;             [Level 7 Monster can grow up to 8000]

!!VRy10:-4000;                          [Number of Additional Troops]

!!VRy10::y30;                           [Divide addiotional troops through number of stacks]

!!if&y30=1;
!!VRy21:+y10; !!BA:M1/0/y1/y21;         [Deploy additional troops to defending stacks]
!!en;

!!if&y30=2;
!!VRy21:+y10; !!BA:M1/0/y1/y21;
!!VRy22:+y10; !!BA:M1/1/y2/y22;
!!en;

!!if&y30=3;
!!VRy21:+y10; !!BA:M1/0/y1/y21;
!!VRy22:+y10; !!BA:M1/1/y2/y22;
!!VRy23:+y10; !!BA:M1/2/y3/y23;
!!en;

!!if&y30=4;
!!VRy21:+y10; !!BA:M1/0/y1/y21;
!!VRy22:+y10; !!BA:M1/1/y2/y22;
!!VRy23:+y10; !!BA:M1/2/y3/y23;
!!VRy24:+y10; !!BA:M1/3/y4/y24;
!!en;

!!if&y30=5;
!!VRy21:+y10; !!BA:M1/0/y1/y21;
!!VRy22:+y10; !!BA:M1/1/y2/y22;
!!VRy23:+y10; !!BA:M1/2/y3/y23;
!!VRy24:+y10; !!BA:M1/3/y4/y24;
!!VRy25:+y10; !!BA:M1/4/y5/y25;
!!en;

!!if&y30=6;
!!VRy21:+y10; !!BA:M1/0/y1/y21;
!!VRy22:+y10; !!BA:M1/1/y2/y22;
!!VRy23:+y10; !!BA:M1/2/y3/y23;
!!VRy24:+y10; !!BA:M1/3/y4/y24;
!!VRy25:+y10; !!BA:M1/4/y5/y25;
!!VRy26:+y10; !!BA:M1/5/y6/y26;
!!en;

!!if&y30=7;
!!VRy21:+y10; !!BA:M1/0/y1/y21;
!!VRy22:+y10; !!BA:M1/1/y2/y22;
!!VRy23:+y10; !!BA:M1/2/y3/y23;
!!VRy24:+y10; !!BA:M1/3/y4/y24;
!!VRy25:+y10; !!BA:M1/4/y5/y25;
!!VRy26:+y10; !!BA:M1/5/y6/y26;
!!VRy27:+y10; !!BA:M1/6/y7/y27;
!!en;

!#SN:W^Growth_Happened^/-1;


!?FU(Dif_Mod_Calc_Stack_Size);
can be called from anywhere and returns stack size 
x1=x-cord, x2=y-cord, x3=z-cord, x4 returns current stack size

!#VA(cd[3]:x) (result:x);
!!VR(result):S(NULL);                   [initialize to zero]
!!VR(thisMonWeeksPassed:y):Si^timerDay^ -i^Growth_X%X1_Y%X2_Z%X3^ :7; [calculate the weeks that have passed for this stack since it had grown to 4000]
!!if&(thisMonWeeksPassed);              [if positive value]
  !!VR(baseValue:e):S4000;              [at this point we assume stack must be at least 4000]
  !!VR(multiply:e):S11 :10;             [muliply by 10%]
  !!re i/0/(thisMonWeeksPassed)/1/-1;   [y6 holds the amount of weeks after the stack has reached 4000. So it must be looped that many times to get the current stack size]
    !!VR(baseValue): *(multiply);       [muliply by 10%]
  !!en;
  !!VR(baseValue)&(baseValue)>1000000:S1000000; [This is the MonDaemon Max limit]

  !!SN:W^Growth_Limit_Lvl_1^/?y40; !!VRy40:F4000/1000000; [Get growth limit for level 1 creatures, must be bigger than 4000 and smaller than 1000000]
  !!SN:W^Growth_Limit_Lvl_2^/?y41; !!VRy41:F4000/1000000; [...]
  !!SN:W^Growth_Limit_Lvl_3^/?y42; !!VRy42:F4000/1000000; [...]
  !!SN:W^Growth_Limit_Lvl_4^/?y43; !!VRy43:F4000/1000000; [...]
  !!SN:W^Growth_Limit_Lvl_5^/?y44; !!VRy44:F4000/1000000; [...]
  !!SN:W^Growth_Limit_Lvl_6^/?y45; !!VRy45:F4000/1000000; [...]
  !!SN:W^Growth_Limit_Lvl_7^/?y46; !!VRy46:F4000/1000000; [Get growth limit for level 7 creatures]

  !!OBx1/x2/x3:T?y20 U?y21;             [Get Type and Subtype]
  !!MA:Ly21/?y28;                       [Get Level of First Monster to decide the growth Limit, if stack has grown more it will be reduced to max value]
  !!VR(baseValue)&y28=0/(baseValue)>y40:Sy40; [Level 1 Monster can grow up to 20000]
  !!VR(baseValue)&y28=1/(baseValue)>y41:Sy41;
  !!VR(baseValue)&y28=2/(baseValue)>y42:Sy42;
  !!VR(baseValue)&y28=3/(baseValue)>y43:Sy43;
  !!VR(baseValue)&y28=4/(baseValue)>y44:Sy44;
  !!VR(baseValue)&y28=5/(baseValue)>y45:Sy45;
  !!VR(baseValue)&y28=6/(baseValue)>y46:Sy46; [Level 7 Monster can grow up to 8000]

  !!VR(result):S(baseValue);            [return stack size in x4]
!!en;


!?FU(OnStartOrLoad);                    [Create hook at rightclick monsters at game start]
!!SN:L^EraPlugins\erm_hooker.era^/?y1;
!!if&y1<>0;
  !!SN:Ay1/^SetHook^/?y2 Ey2/1/4500264/(gem_OnGetArmyLegionName); 
!!en;


!?FU(gem_OnGetArmyLegionName)&i^timerWeek^>1/i^Neutral_Growth_10000^; [When right click or hover over monsters this triggers]
!!UN:Cx1/(STRUCT_HOOK_CONTEXT_ECX)/4/?(number:y) Cx1/(STRUCT_HOOK_CONTEXT_EDX)/4/?(msgType:y);

!!if&(msgType:y)=1/(number)=4000;       [if stack has a size of 4000]
  !!UN:C(ADV_MANAGER)/(UNC_INT)/?(advMgr:y);
  !!UN:C(advMgr)/232/2/?(x:y) C(advMgr)/234/2/?(y:y) C(advMgr)/235/1/?(z:y);
  !!FU(Dif_Mod_Calc_Stack_Size):P(x)/(y)/(z)/?y10; [call fkt to get real stack size in y10 to set correct text]

  !!VRy10&y10=4000:S1000;               [1000+ up to 4000]
  !!VRy10&y10>4000/y10<=10000:S4000;    [4000+ up to 10000]
  !!VRy10&y10>10000/y10<=20000:S10000;  [10000+ up to 20000]
  !!VRy10&y10>20000/y10<=40000:S20000;
  !!VRy10&y10>40000/y10<=100000:S40000;
  !!VRy10&y10>100000/y10<=200000:S100000;
  !!VRy10&y10>200000/y10<=500000:S200000;
  !!VRy10&y10>500000/y10<=1000000:S500000;
  !!VRy10&y10=1000000:S1000000;

  !!SN:T^Diff_Mod.Legion_1^/?z10/^size^/y10; [Get text file]
  !!SN&y10=1000000:T^Diff_Mod.Legion_2^/?z10/^size^/y10; [MonDemon Easter Egg]
  !!if&y10>=4000;    
    !!SN:B9598440/d/^%Z10^;             [replace text]
    !!UN:Cx1/(STRUCT_HOOK_CONTEXT_EAX)/4/9598440;
  !!en;
!!en;


!$OB54&1000;                            [After Monster Visit]
*This part is to prevent that a stack which had grown above 4000 and the hero retreated will not fall back to low numbers. So when retreating the stack is set back to 4000 after the visit
!!SN:W^Growth_Happened^/?y10;
!!SN:W^Growth_Happened^/-1;
!!FU&y10=-1:E;

!!HEy10:O?y20;
!!FU&y20>=0:E;                          [Exit if Hero still has an owner]

!!SN:W^Neutral_Growth_10000^/?y50;
!!FU&y50=0:E;

!!SN:W^Growth_X%V998_Y%V999_Z%V1000^/?y4;
!!FU&y4=0:E;                            [Exit if stack had not grown to 4000 before]
!!MOv998/v999/v1000:G4000;


********************************************************************************
!?FU(Diff_Funtion_87);                  [For Uptier +1]

!!VRv2&x16=1:S-1;
!!UN:U54/-1/-1/2;

!!FU(Diff_CheckIfMonIsEligibleToBeRepalced):P2/?(result:y);
!!FU&(result)<>(TRUE):E;

!!OBv2/v3/v4:U?y2;

!!if&y2>=0/y2<120;
  !!MOv2/v3/v4:G?y3;                      [Check Monster Numbers]
  !!MA:Uy2/?y4;                           [Check if upgradable]
  !!MA:Ly2/?y5;                           [Check Level 0-6]

  !!if&i^Typhon_Third_Upgrade_Mod_Active^; [Archer30: Why?]
    !!FU|y2=118/y2=119/y2=112:E;
  !!en;

  !!if&x1=1;
    !!VRy2&y2=100:S103;                     [Fix for Lizardman]
    !!VRy2&y2=101:S103;                     [Fix for Lizardman]
    !!VRy2&y2=118:S110;                     [Fix for Pixi/Sprite]
    !!VRy2&y2=119:S125;                     [Fix for Pixi/Sprite]
    !!VRy2&y2=112:S113;                     [Fix for Air Element]
    !!VRy2&y2=115:S112;                     [Fix for Water Element]
  !!en;

  !!if&x1=3;
    !!VRy2&y2=101:S102; !!VRy2&y2=100:S101; [Fix for Lizardman]
    !!VRy2&y2=98:S100;  !!VRy2&y2=99:S101;  [Fix for Gnolls]
    !!VRy2&y2=118:S108; !!VRy2&y2=119:S123; [Fix for Fix for Pixi/Sprite]
    !!VRy2&y2=112:S111;                     [Fix for Air Element]
  !!en;

  !!VRy2&y4=-2:+x1;                       [If not upgradable +1 Next Tier]
  !!VRy2&y4=-1:+x2;                       [If upgradable +2 for Next Tier]

  !!MA:Ly2/?y6;

  !!if&y5<y6/y5<5;
    !!UN:Ov2/v3/v4/1/0;
    !!UN:Iv2/v3/v4/54/y2/54/y2/-1/0;
    !!MOv2/v3/v4:Gy3;
  !!en;

  !!if&y5=y6;
    !!VRy2:+1;                              [If not upgradable +1 Next Tier]
    !!MA:Ly2/?y6;

    !!if&y5<y6/y5<5;
      !!UN:Ov2/v3/v4/1/0;
      !!UN:Iv2/v3/v4/54/y2/54/y2/-1/0;
      !!MOv2/v3/v4:Gy3;
    !!en;
  !!en;
!!en;

// Check if the neutral stack is eligible to be replaced (not a special one)
!?FU(Diff_CheckIfMonIsEligibleToBeRepalced);
; Check if the neutral stack is eligible to be replaced.
; Alternative function arguments:
;  (vIndex)/?(result)
;  (x)/(y)/(z)/?(result)
;  The number of arguments can be 2 or 4.
!#VA(arg1:x);
!#VA(arg2:x);
!#VA(arg3:x);
!#VA(arg4:x);

; Get coordinates depending on the amount of arguments
!!FU:A?(numArgs:y);

!!if&(numArgs)<3;
  !!VR(arg2):S(FALSE);

  !!VR(x:y):Sv(arg1);
  !!VR(yIndex:y):S(arg1) +1;
  !!VR(y:y):Sv(yIndex);
  !!VR(zIndex:y):S(yIndex) +1;
  !!VR(z:y):Sv(zIndex);
!!el;
  !!VR(arg4):S(FALSE);

  !!VR(x):S(arg1);
  !!VR(y):S(arg2);
  !!VR(z):S(arg3);
!!en;

!!UN:P904/1; [Disable Error Messages]
!!UN:P905/0; [Initialize error-result flag to 0]

!!MO(x)/(y)/(z):A?(art:y); [Check if monster has an artifact: y3]

!!UN:P905/?(hasError:y) P905/0; [Check if an error occurred: y4=1 if there was an error]
!!UN:P904/0; [Reenable Error Messages]
!!FU&(hasError)=0:E; [Skip this monster if NO error occurred (because it has custom setup of text, artifact or resources)]

!!MO(x)/(y)/(z):G?(num:y) O?(noGrow:y); [Check number (y5) and grow/no-grow (y6)]
!!FU&(num)=1/(noGrow)=1:E; [Skip if only 1 monster and set to not grow]

!!MO(x)/(y)/(z):R?(aggression:y)/1; [Check aggressions: y7]
!!FU|(aggression)=0/(aggression)=10:E; [Skip if monster set to always join or always fight]

!!if&(numArgs)<3;
  !!VR(arg2):S(TRUE);
!!el;
  !!VR(arg4):S(TRUE);
!!en;
********************************************************************************


                Random Creature Abilities and Buff Section


********************************************************************************
!?FU(OnCombatRound)&v997=0/i^battle_human_0^;

!!SN:W^Anzahl_Buffs^/?y1;
!!FU&y1=0:E;

!!BA:O?y3/?y4;
!!FU&y4<>-1:E;

[:loop300]; loop is label name inside current trigger
!!VRy2:S0R17;
!!VRy3&y2=0:S27; !!VRy3&y2=1:S28; !!VRy3&y2=2:S29; !!VRy3&y2=3:S30; !!VRy3&y2=4:S31; !!VRy3&y2=5:S32; !!VRy3&y2=6:S33; !!VRy3&y2=7:S36; !!VRy3&y2=8:S41;
!!VRy3&y2=9:S43; !!VRy3&y2=10:S44; !!VRy3&y2=11:S46; !!VRy3&y2=12:S48; !!VRy3&y2=13:S49; !!VRy3&y2=14:S51; !!VRy3&y2=15:S53; !!VRy3&y2=16:S55; !!VRy3&y2=17:S58;
!!DO(Diff_Funtion_89)/21/41/1:Py3/50/1;
!!VRy1:-1;                              [increase counter]
!!SN&y1>0:G[loop300];                   [jump to loop label if not echoed y1 times]

!?FU(Diff_Funtion_89);
x1=Spell Number, x2=Duration, x3=Level

!!BMx16:N?y1;
!!FU&y1=0:E;                            [Exit if no Monster]

!!BMx16:F?i F?j;                        [Read Monster Flag]
!!VRi:&4;                               [Check for Shooter]
!!VRj:&262144;                          [Check for Undead]

!!VRx1&x1=43/i>0:S44;                   [If Shooter and Spell is Bloodlust, change to Precision]
!!VRx1&x1=44/i=0:S43;                   [If Melee and Spell is Precision, change to Bloodlust]
!!VRx1&x1=41/j>0:S46;                   [If Undead and Spell is Bless, change to Stoneskin]
!!VRx1&x1=42/j>0:S28;                   [If Undead and Spell is Curse, change to Air Shield]
!!VRx1&x1=48/j>0:S51;                   [If Undead and Spell is Prayer, change to Fortune]
!!VRx1&x1=49/j>0:S27;                   [If Undead and Spell is Mirth, change to Shield]

!!BMx16:Mx1/x2/x3;                      [Apply Bonus Spell]


********************************************************************************

// New implementation by Archer30
!?FU(OnAfterErmInstructions);
!!FU(NewIntArray):P90/?i^Anzahl_Abilities_List^/(M_STORED);

!!SN:Vi^Anzahl_Abilities_List^/0/102/68/1/76/29/30/76/29/30/106/16/50;
!!SN:Vi^Anzahl_Abilities_List^/12/99/78/100/102/70/1/102/99/1/102/82/1;
!!SN:Vi^Anzahl_Abilities_List^/24/101/61/100/108/114/25/102/98/1/75/15/75;
!!SN:Vi^Anzahl_Abilities_List^/36/102/115/1/102/66/1/102/65/1/102/69/1;
!!SN:Vi^Anzahl_Abilities_List^/48/102/114/1/106/15/50/107/15/50/107/21/25;
!!SN:Vi^Anzahl_Abilities_List^/60/75/50/50/106/52/50/106/45/50/119/109/1;
!!SN:Vi^Anzahl_Abilities_List^/72/97/74/20/75/17/25/119/69/1/115/30/0;
!!SN:Vi^Anzahl_Abilities_List^/84/103/37/50/87/43/30;

; Only available on BF in this script (new game difficulty.erm)! It looks like there are other EA blocking the functionality of this
!?FU(OnSetupBattlefield)&i^Anzahl_Abilities^; [Must be later than other scripts setting EA bonuses]
!!UN:P(WOG_OPT_STACK_EXPERIENCE)/?(stackExpOn:y);
!!FU&(stackExpOn)<>(TRUE):E;

!!re i/(BATTLE_DEFENDER_STACK_FIRST)/(BATTLE_DEFENDER_STACK_LAST);
  !!BMi:N?(num:y);

  !!if&(num)>0;
    !!BMi:I?(side:y);

    !!FU(diff_SetUpStackExpAbilities):Pi/(side);
  !!en;
!!en;

!?FU(diff_SetUpStackExpAbilities)&i^Anzahl_Abilities^;
*?FU(WOG_BattleStack_InitParams)&i^Anzahl_Abilities^;
!#VA(stackId:x) (side:x);

!!UN:P(WOG_OPT_STACK_EXPERIENCE)/?(stackExpOn:y);
!!FU&(stackExpOn)<>(TRUE):E;

; Exit if not from the right side, or not neutral fight
!!FU&(side)<>(BATTLE_RIGHT):E;
!!FU&i^battle_owner_1^>(NO_PLAYER)/i^wog_72_randHeroActive^<>(TRUE):E;

; Exit if no Monster
!!BM(stackId):T?(type:y);
!!FU&(type)<=(NO_MON):E;

; Exit for special monsters
!!FU|(type)=(MON_NOT_USED_1)/(type)=(MON_NOT_USED_2)/(type)=(MON_NOT_USED_3)/(type)=(MON_NOT_USED_4):E; [Exclue not used]
!!FU&(type)>=(MON_CATAPULT)/(type)<=(MON_ARROW_TOWERS):E; [Execlude Warmachines]
!!FU&(type)>=(MON_EMISSARY_OF_WAR)/(type)<=(MON_EMISSARY_OF_LORE):E; [Exlude emmissaries]
!!FU&(type)>=(MON_COMMANDER_FIRST_A)/(type)<=(MON_COMMANDER_LAST_D):E; [Exclude commanders]

; Exit if there is no available slot
!!VR(eaStack:y):S(stackId) +1 *-1;
!!EA(eaStack):F0/?(availSlot:y);
!!FU&(availSlot)=-1:E;

!!BM(stackId):E?(spells:y);
!!BM(stackId):U3/?(shots:y);

!!FU(NewIntArray):P?(availAbilitiesList:y);

!!re i/0/29;
  !!VR(typeIndex:y):Si *3;
  !!VR(subtypeIndex:y):S(typeIndex) +1;

  !!SN:Mi^Anzahl_Abilities_List^/(typeIndex)/?(type:y) Mi^Anzahl_Abilities_List^/(subtypeIndex)/?(subtype:y);

  ; skip Rebirth if it is too effective
  !!co&(type)=102/(subtype)=114/(spells)>3;

  ; Skip Melee without Penalty/Shoot Close if the stack can't shoot
  !!if&(type)=102/(shots)<=0;
    !!co|(subtype)=69/(subtype)=115;
  !!en;

  ; Get the slot of the ability, or returned the first empty slot
  !!EA(eaStack):F(type)/(subtype)/?(slot:y);

  ; If it returend the first empty slot, which means the ability is not avaialble for the given monster, add the ability
  !!if&(availSlot)=(slot);
    !!FU(Array_Push):P(availAbilitiesList)/i;
  !!en;
!!en;

!!FU(Array_Shuffle):P(availAbilitiesList);

!!re i/1/i^Anzahl_Abilities^;
  !!SN:M(availAbilitiesList)/?(size:y);
  !!FU&(size)=0:E;

  !!EA(eaStack):F0/?(availSlot);
  !!FU&(availSlot)=-1:E;

  !!FU(Array_Pop):P(availAbilitiesList)/?(abilityIndex:y);
  !!VR(typeIndex):S(abilityIndex) *3;
  !!VR(subtypeIndex):S(typeIndex) +1;
  !!VR(valueIndex:y):S(subtypeIndex) +1;
  !!SN:Mi^Anzahl_Abilities_List^/(typeIndex)/?(type);
  !!SN:Mi^Anzahl_Abilities_List^/(subtypeIndex)/?(subtype);
  !!SN:Mi^Anzahl_Abilities_List^/(valueIndex)/?(value:y);

  !!EA(eaStack):B(availSlot)/1/(type)/(subtype)/(value)/(value)/(value)/(value)/(value)/(value)/(value)/(value)/(value)/(value)/(value);

  ; If Rebirth is given, make sure there is at least one spell
  !!BM(stackId)&(type)=102/(subtype)=114/(spells)<=0:E1;
!!en;

// Old implementation
!?FU(OnCombatRound)&v997=0/1000;        [Switched to BA from BF because of EA bug overriding HP]
!!FU:E;                                 [Disabled because it bugs]

!!SN:W^Anzahl_Abilities^/?y1;
!!FU&y1=0:E;                            [Exit if Option was not Selected]

!!VRy1:S4;

!!BA:O?y3/?y4;
!!FU&y4<>-1:E;

!!re i/1/y1;                            [Run loop as many times as Anzahl_Abilities was set]
!!VRy10:S1R29;
!!DO(Diff_Funtion_90)/21/41/1:Py10;     [Run Loop through all creatures on Battlefield]
!!en;


**Extra Abilities Table
!?FU(Diff_Funtion_90);                  [Function for giving extra abilities]

!!BMx16:N?y1;                           [Exit if no Monster]
!!FU&y1=0:E;

!!BMx16:T?y1 E?y50;

!!FU|y1=145/y1=146/y1=147/y1=148/y1=149:E; [Execlude Warmachines]
!!FU|y1=174/y1=175/y1=176/y1=177/y1=178/y1=179/y1=180/y1=181/y1=182:E; [Execlude Attacking Commanders]
!!FU|y1=183/y1=184/y1=185/y1=186/y1=187/y1=188/y1=189/y1=190/y1=191:E; [Execlude Defending Commanders]
!!FU&x1=17/y50>3:E;                     [Exit if Rebirth and many casts to avoid endless loop]

!!VRy2:Sx16;                            [use stack ID (read below*), I set y2 to current stack number]
!!VRy2:+1*-1;                           [now I add +1 then change to negative  value, we have now number of stack for EA thx Sal]

!!EAy2:F0/?y3;                          [Check for next available bonus line: y3]

!!if&x1=1;                              [Double Strike]
!!EAy2&y3>=0:By3/1/102/68/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=2;                              [Shield Block]
!!EAy2&y3>=0:By3/1/76/29/30/30/30/30/30/30/30/30/30/30/30; [Battle Monster]
!!en;

!!if&x1=3;                              [Air Shield Block]
!!EAy2&y3>=0:By3/1/76/29/30/30/30/30/30/30/30/30/30/30/30; [Battle Monster]
!!en;

!!if&x1=4;                              [Magic Mirror Cast]
!!EAy2&y3>=0:By3/1/106/16/50/50/50/50/50/50/50/50/50/50/50; [Battle Monster]
!!en;

!!if&x1=5;                              [Counterspell cast Dispel]
!!EAy2&y3>=0:By3/1/99/78/100/100/100/100/100/100/100/100/100/100/100; [Battle Monster]
!!en;

!!if&x1=6;                              [Fly]
!!EAy2&y3>=0:By3/1/102/70/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=7;                              [Champion Distance Bonus]
!!EAy2&y3>=0:By3/1/102/99/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=8;                              [No Retaliation]
!!EAy2&y3>=0:By3/1/102/82/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=9;                              [Death Blow]
!!EAy2&y3>=0:By3/1/101/61/100/100/100/100/100/100/100/100/100/100/100; [Battle Monster]
!!en;

!!if&x1=10;                             [Fire Shield]
!!EAy2&y3>=0:By3/1/108/114/25/25/25/25/25/25/25/25/25/25/25; [Battle Monster]
!!en;

!!if&x1=11;                             [Strike and Return]
!!EAy2&y3>=0:By3/1/102/98/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=12;                             [Protection Elements]
!!EAy2&y3>=0:By3/1/75/15/75/75/75/75/75/75/75/75/75/75/75; [Battle Monster]
!!en;

!!if&x1=13;                             [Shoot when Adjacent]
!!EAy2&y3>=0:By3/1/102/115/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=14;                             [Breath Attack]
!!EAy2&y3>=0:By3/1/102/66/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=15;                             [Attack All Around]
!!EAy2&y3>=0:By3/1/102/65/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=16;                             [No Melee Penalty]
!!EAy2&y3>=0:By3/1/102/69/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=17;                             [Rebirth]
!!EAy2&y3>=0:By3/1/102/114/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=18;                             [Cast Spell Before Attack Magic Arrow]
!!EAy2&y3>=0:By3/1/106/15/50/50/50/50/50/50/50/50/50/50/50; [Battle Monster]
!!en;

!!if&x1=19;                             [Cast Spell After Attack Magic Arrow]
!!EAy2&y3>=0:By3/1/107/15/50/50/50/50/50/50/50/50/50/50/50; [Battle Monster]
!!en;

!!if&x1=20;                             [Cast Spell After Attack Fireball]
!!EAy2&y3>=0:By3/1/107/21/25/25/25/25/25/25/25/25/25/25/25; [Battle Monster]
!!en;

!!if&x1=21;                             [may cast Sorrow with attacks]
!!EAy2&y3>=0:By3/1/75/50/50/50/50/50/50/50/50/50/50/50/50; [Battle Monster]
!!en;

!!if&x1=22;                             [has chance to cast before attack 52 Misfortune]
!!EAy2&y3>=0:By3/1/106/52/50/50/50/50/50/50/50/50/50/50/50; [Battle Monster]
!!en;

!!if&x1=23;                             [has chance to cast before attack 45 Weakness]
!!EAy2&y3>=0:By3/1/106/45/50/50/50/50/50/50/50/50/50/50/50; [Battle Monster]
!!en;

!!if&x1=24;                             [are immune to hostile mind spells]
!!EAy2&y3>=0:By3/1/119/109/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=25;                             [has a chance to paralyze]
!!EAy2&y3>=0:By3/1/97/74/20/20/20/20/20/20/20/20/20/20/20; [Battle Monster]
!!en;

!!if&x1=26;                             [has chance to cast Ligthning after attack]
!!EAy2&y3>=0:By3/1/75/17/25/25/25/25/25/25/25/25/25/25/25; [Battle Monster]
!!en;

!!if&x1=27;                             [are immune to all Earth Spells]
!!EAy2&y3>=0:By3/1/119/69/1/1/1/1/1/1/1/1/1/1/1; [Battle Monster]
!!en;

!!if&x1=28;                             [cast Mass Protection from Air]
!!EAy2&y3>=0:By3/1/115/30/0/1/1/1/1/1/2/2/2/3/5; [Battle Monster]
!!en;

!!if&x1=29;                             [+50% Magic Damage Reduction Golem Style]
!!EAy2&y3>=0:By3/1/103/37/50/50/50/50/50/50/50/50/50/50/50; [Battle Monster]
!!en;

!!if&x1=30;                             [have +30% extra Magic Resistance Dwarve type]
!!EAy2&y3>=0:By3/1/87/43/30/30/30/30/30/30/30/30/30/30/30; [Battle Monster]
!!en;



****************************** END *********************************************





********************************************************************************


               Battle Commander and Battle Rewards Section


********************************************************************************
!?BF&i^battle_human_0^;                 [Create Battle Commander]

!!SN:W^Battle_Commander^/?y1;           [Only Run if Option was selected]
!!FU&y1=0:E; 

!!SN:W^Battle_Commander_Type^/?y1;
!!FU&y1=0:E; 

!!HE-10:E?y4/?y5/1 F?y22/?y21/?y74/?y75;[Get Level of attacking Hero Attack and Defense]

!!BU:E98/?y30;
!!BU&y30=(NO_STACK):Sy1/1/98/1/-1/0;    [Summon random Commander]

!!DO(Diff_Funtion_91)/0/20/1:P;         [Get Fight Value of attacking army]
!!SN:W^Att_HP_Army_Value^/?y20;

!!DO(Diff_Funtion_92)/21/41/1:Py20/y5/y22/y21; [Set Battle Commander Stats]
!!SN:W^Att_HP_Army_Value^/0;            [Reset Fight Value]


!?BF;
AI player gets Stronger Commander in battle depending on game difficutly

!!SN:W^H3_Game_Difficulty^/?y1;
!!FU&y1=0:E;                            [Exit if Mod was disabled in options]

!!BA:H0/?y1 H1/?y2;
!!FU&y2<0:E;                            [Exit if no enemy Hero]

!!BA:O?y1/?y2;                          [Get Owner]
!!OW:Iy2/?y2;                           [Get if AI or Human]

!!SN:W^H3_Game_Difficulty^/?y5;

[Health Points in y10] [Damage in y12] [Attack in y11] [Defence y13]
!!VRy10&y5=1:S200; !!VRy12&y5=1:S150;   !!VRy11&y5=1:S10; !!VRy13&y5=1:S8;
!!VRy10&y5=2:S250; !!VRy12&y5=2:S175;   !!VRy11&y5=2:S15; !!VRy13&y5=2:S9;
!!VRy10&y5=3:S300; !!VRy12&y5=3:S200;   !!VRy11&y5=3:S20; !!VRy13&y5=3:S10;
!!VRy10&y5=4:S350; !!VRy12&y5=4:S225;   !!VRy11&y5=4:S25; !!VRy13&y5=4:S14;
!!VRy10&y5=5:S400; !!VRy12&y5=5:S250;   !!VRy11&y5=5:S30; !!VRy13&y5=5:S18;

!!VRy21:Sc;                             [Set Current Day]
!!SN:W^AIPayday^/?y20;                  [Get day of Payday]
!!if&y21<y20;                           [If current gameday is smaller as payday apply only 50% of Bonus to commander]
  !!VRy10::2; !!VRy11::2; !!VRy12::2; !!VRy13::2;
!!en;

!!if&y2=1;
 !!re i/21/31;
  !!BMi:T?y3;                           [Get Creature Type and Position]
    !!if&y3>=183/y3<=191;               [If Commander found]
    !!BMi:Ady13;                        [Set Attack]
    !!BMi:Ddy11;                        [Set Defense]
    !!BMi:H?y5; !!VRy5:*y10:100; !!BMi:Hy5 E0; [Set Health and set casts to zero]
    !!BMi:U1/?y5 U2/?y6; !!VRy5:*y12:100; !!VRy6:*y12:100; !!BMi:U1/y5 U2/y6; [Set Min+Max Damage]
    !!en;
 !!en;
!!en;

!!BA:O?y1/?y2;                          [Get Owner]
!!OW:Iy1/?y2;                           [Get if AI or Human]

!!if&y2=1;
 !!re i/0/10;
  !!BMi:T?y3;                           [Get Creature Type and Position]
    !!if&y3>=174/y3<=182;               [If Commander found]
    !!BMi:Ady13;                        [Set Attack]
    !!BMi:Ddy11;                        [Set Defense]
    !!BMi:H?y5; !!VRy5:*y10:100; !!BMi:Hy5 E0; [Set Health and set casts to zero]
    !!BMi:U1/?y5 U2/?y6; !!VRy5:*y12:100; !!VRy6:*y12:100; !!BMi:U1/y5 U2/y6; [Set Min+Max Damage]
    !!en;
  !!en;
!!en;


********************************************************************************
!?FU(Diff_Funtion_92);

!!BMx16:N?y1;
!!BMx16:T?y2;
!!BMx16:P?y3;

!!if&y1=1/y2>182/y2<192/y3<>8;          [If commander found Skip Poistion 8 in Creature Banks]

!!VRy5:Sc;                              [Set to days]
!!VRy6:Sc+6:7;                          [Set weeks]
!!VRy7:Sx2*200;                         [Hero level mal 200]
!!VRy8:Sc+6:7*100;                      [Week mal 100]
!!VRy9:Sx2*4;                           [Hero level mal 4 for Damage]

**Calculate the Strength of Battle Commander**
!!VRy10:Sx3*2+y6;                       [Attack=Attack from Hero *2 + Gameweeks]
!!VRy11:Sx4*2+y6;                       [Defense=Defense from Hero *2 + Gameweeks]
!!VRy12:Sx2:10 +2R2;                    [Speed=Herolvl/10 +2-4]
!!SN:W^Typhon_Third_Upgrade_Mod_Active^/?y99; [With TUM battle commander is slightly stronger]
!!VRy13&y99=0:Sx1:8 +y7 +y8 +50 :2;     [Health=Fight Value/8 +Herlolvl*200 +Week*100 durch 2]
!!VRy13&y99=1:Sx1:7 +y7 +y8 +50 :2;     [Health=Fight Value/7 +Herlolvl*200 +Week*100 durch 2]
!!VRy14:Sx1:250 +y9 +5R20;              [Min Damage HP_Value +Hero Level*10]
!!VRy15:Sx1:150 +y9 +31R45;             [Max Damage]
!!VRy13|y13<=0/y13>5000000:S5000000;    [prevent overflow - Note that the upper limit for commander HP is far less than INT_MAX! It overflows when bigger than 30000000]
!!VRy12&y13>=500000:+1; !!VRy12&y13>=1000000:+1; !!VRy12&y13>=5000000:+1; [Add additional speed for very high commander HP]
!!SN:W^Is_Battle_Replay^/?y80;
!!SN&y80=0:W^Dif_Mod_Battle_Com_Speed^/y12; 
!!SN&y80=1:W^Dif_Mod_Battle_Com_Speed^/?y12; 
!!BMx16:Hy13 Ay10 Dy11 Sy12 U1/y14 U2/y15 U3/0 E0; [Give Stats and Set casts and shots to zero]

!!VRy40:S30R3;                          [Add 1 Advanced Elemental Protection]
!!BMx16:My40/5/2;

!!VRy40&x2>=25:S30R3;                   [Add one more Advanced Elemental Protection after level 25]
!!BMx16&x2>=25:My40/3/2;

!!VRy40&x2>=35:S30R3;                   [Add one more Expert Elemental Protection after level 35]
!!BMx16&x2>=35:My40/7/3;

!!VRy10:S0R2;
!!BMx16&x2>=25/y10>=1:M28/10/2;         [Add Air Shield   66% Chance]
!!BMx16&x2>=30/y10<=1:M27/10/2;         [Add Shield       66% Chance]
!!BMx16&x2>=45/y10=0:M48/5/2;           [Add Prayer       66% Chance]
!!en;


********************************************************************************
!?FU(Diff_Funtion_91);

!!BMx16:N?y1;
!!BMx16:H?y2;
!!VRy3:Sy1*y2;
!!SN:W^Att_HP_Army_Value^/dy3;

********************************************************************************
[So it only runs for Random Battle and NOT chambers]
!?OB16&1000;                            [16 Creature Bank]
!!SN:W^Surpress_Battle_Commander^/1;
!?OB24&1000;                            [24 Derelict Ship]
!!SN:W^Surpress_Battle_Commander^/1;
!?OB25&1000;                            [25 Dragon Utopia]
!!SN:W^Surpress_Battle_Commander^/1;
!?OB84&1000;                            [84 Crypt]
!!SN:W^Surpress_Battle_Commander^/1;
!?OB85&1000;                            [85 Shipwreck]
!!SN:W^Surpress_Battle_Commander^/1;


!?FU(OnBeforeBattleUniversal)&1000;

!!SN:W^Battle_Commander^/?y1;           [Only Run if Option was selected]
!!FU&y1=0:E;

!!SN:W^Surpress_Battle_Commander^/?y1;
!!SN:W^Surpress_Battle_Commander^/0;    [Reset variable for next fight]
!!FU&y1=1:E;

!!BA:H0/?y1;
!!BA:H1/?y2;
!!BA:O?y3/?y4;
!!FU&y4<>-1:E;                          [So it only runs for Random Battle Heroes and Chambers]

!!HEy1:Ed/?y5/1;                        [Get Level of attacking Hero]

!!FU&y5<10:E;                           [Exit if Hero is not lvl 10]

!!VRy6:S0R99;                           [13% Chance for Hero Level 10-15]
!!VRy6&y5>15:S0R85;                     [14% Chance for Hero Level 16-25]
!!VRy6&y5>25:S0R82;                     [14% Chance for Hero Level 26-35]
!!VRy6&y5>35:S0R78;                     [15% Chance for Hero Level 36-45]
!!VRy6&y5>45:S0R75;                     [16% Chance for Hero Level 46-100]

*!VRy6:S1; TEST

!!FU&y6>=11:E;                          [Fight the Battle Commander or Not]

!!VRi^Battle_Commander_Type^:S(MON_COMMANDER_FIRST_D) R8;    [So it only runs for Random Battle Heroes and Chambers]

; If random hero is active (WoG Scripts option 72), get the commander type of the neutral hero instead (if commander is active)
!!if&i^wog_72_randHeroActive^;
  !!COi^battle_hero_1^:D?y30 E?y31;     [alive and hired]

  !!if&y30=0/y31=1;
    !!COi^battle_hero_1^:T?y32;         [type - 0 to 8]
    !!VRi^Battle_Commander_Type^:Sy32 +(MON_COMMANDER_FIRST_D);
  !!en;
!!en;

!!SN:T^Diff_Mod.Be_carefull^/?z2;
!!IF:Q1/(PIC_TYPE_MONSTER)/i^Battle_Commander_Type^/(MSG_TYPE_MES)/^%Z2^;

********************************************************************************
!?FU(OnAfterBattleUniversal)&1000;      [Battle Commander Rewards]

!!SN:W^Battle_Commander^/?y1;           [Only Run if Option was selected]
!!FU&y1=0:E;

!!SN:W^Battle_Commander_Type^/?y1;      [And the fight was vs a Battle Commander]
!!FU&y1=0:E;

!!BA:O?y3/?y4;                          [Check Owner]
!!HE-10:B0/?z-10;                       [get hero name]
!!HE-10:E?y6/?y7/1;                     [get level of this hero]

!!VRy50:S0R4;

!!if&y3<>-1;                            [Give Reward if Attacking Hero hasn't lost the battle]
  !!if&y50=0|y50=1;                     [Double Chance]
    !!HE-10:N?y55;                      [get hero ID]

    **Resources Reward
    !!VRy8:Sy7;                         [Set Level to y8]
    !!VRy8::5 +1;
    !!VRy10:S0R6;
    !!VRy11&y10<6:S1R3 +y8;
    !!VRy11&y10=6:Sy8*750+1000R1500;
    !!OW:Ry3/y10/dy11;                  [Give Player Resources]

    !!SN:T^Diff_Mod.A glorius victory^/?z2 Iz2/?z2;
    !!OW&y3<>-1:Iy3/?y4;                [get AI (1) or human (0)]
    !!VRy5&y3<>-1/y4=0:S1;              [human if has owner and that owner is human]
    !!IF&y5=1:Q2/y10/y11/1/z2;          [If Bonus Show Picture]
    !!SN&y10=6/y5=1:W^Total_Battle_Com_Gold_%Y55^/dy11; [gained gold battle commander]
  !!en;

  **Primary Skill Reward
  !!if&y50=2;
    !!VRy5:S31R3;

    !!SN:T^Diff_Mod.A glorius victory^/?z2 Iz2/?z2;
    !!IF:Q1/y5/1/1/z2;

    !!HE-10&y5=31:Fd1/d/d/d;            [give appropriate bonus]
    !!HE-10&y5=32:Fd/d1/d/d;            [give appropriate bonus]
    !!HE-10&y5=33:Fd/d/d1/d;            [give appropriate bonus]
    !!HE-10&y5=34:Fd/d/d/d1;            [give appropriate bonus]
  !!en;

  **Experience Reward
  !!if|y50=3/y50=4;                     [Double Chance]
    !!VRy6&y6>=15000000:S15000000;      [Fix for Var overflow]
    !!VRy5:Sy6;
    !!VRy5:*120:100 -y6;
    !!VRy5::100 *15 +3000;

    !!SN:T^Diff_Mod.A glorius victory2^/?z2 Iz2/?z2;
    !!IF:Q1/17/y5/1/z2;

    !!HE-10:Edy5;                       [Give Experience]
  !!en;

  !!UN:R2;                              [Redraw]
!!en;

!!SN:W^Battle_Commander_Type^/0;        [Reset var]
!!SN:W^Att_HP_Army_Value^/0;            [Reset Fight Value]


!?BA0;
!!SN:W^Is_Battle_Replay^/0;             [Set variable in case of a battle replay]
!?BA1;
!!SN:W^Is_Battle_Replay^/0;
!?FU(OnBattleReplay);
!!SN:W^Is_Battle_Replay^/1;


********************************************************************************
!?FU(OnAfterBattleUniversal)&i^battle_human_0^/i^battle_humanOnly^=0; [Battle Reward Option Rewards]

!!SN:W^Battle_Reward_Active^/?y1;       [Only Run if Option was selected]
!!FU&y1=0:E;

!!SN:W^Battle_Reward^/?y15;             [Get Chance]
!!VRy11:S0R100;
!!FU&y11>y15:E;                         [Exit if Roll not Successfull]

!!BA:O?y3/?y4;                          [Check Owner Attack and Defender]
!!HE-10:B0/?z-10;                       [get hero name]
!!HE-10:E?y6/?y7/1;                     [get level of this hero]

!!VRy50:S0R6;                           [Generate range]
!!VRy50&y15>=60:S0R7;                   [Generate range if Battle Reward chance is bigger 60]
!!VRy50&y15>=75:S0R8;                   [Generate range if Battle Reward chance is bigger 75]

!!VRy51:S0T2;                           [Generate Coinflip to reduce the chance to get an spell or artifact]
!!FU&y50=7/y51=1:E;                     [66% less chance to get Artifacts or Spells]
!!FU&y50=8/y51=1:E;

!!if&y3<>-1;                            [Give Reward if Attacking Hero hasn't lost the battle]

**Resources Reward
!!if&y50=0|y50=1|y50=2;                 [0 and 1 and 2 is Ressource Reward]
  !!VRy8:Sy7;                           [Set Level to y8]
  !!VRy8::8 +1;
  !!VRy8&y15>=100:+3;
  !!VRy8&y15>=120:+2;
  !!VRy10:S0R6;
  !!VRy11&y10<6:S0R2 +y8;
  !!VRy11&y10=6:Sy8*500+100R1000;
  !!OW:Ry3/y10/dy11;                    [Give Player Resources]
  !!SN:T^Diff_Mod.Battle Reward1^/?z2 Iz2/?z2;
  !!OW&y3<>-1:Iy3/?y4;                  [get AI (1) or human (0)]
  !!VRy5&y3<>-1/y4=0:S1;                [human if has owner and that owner is human]
  !!IF&y5=1:Q2/y10/y11/1/z2;            [If Bonus Show Picture]
!!en;

**Primary Skill Reward
!!if&y50=3;
  !!VRy5:S31R3;
  !!SN:T^Diff_Mod.Battle Reward2^/?z2 Iz2/?z2;
  !!IF:Q1/y5/1/1/z2;
  !!HE-10&y5=31:Fd1/d/d/d;              [give appropriate bonus]
  !!HE-10&y5=32:Fd/d1/d/d;              [give appropriate bonus]
  !!HE-10&y5=33:Fd/d/d1/d;              [give appropriate bonus]
  !!HE-10&y5=34:Fd/d/d/d1;              [give appropriate bonus]
!!en;

**Experience Reward
!!if|y50=4/y50=5/y50=6;
  !!VRy5:Sy7*3*100;
  !!VRy5&y7>=30:*2;                     [If level bigger 30 Double Xp Bonus]
  !!VRy5&y7>=40:*2;                     [If level bigger 30 Double Xp Bonus again]
  !!VRy5&y7>=50:*4;                     [If level bigger 30 Double Xp Bonus]
  !!VRy5&y15>=100:*125:100;
  !!VRy5&y15>=120:*120:100;
  !!VRy5&y5>=15000000:S15000000;        [Fix for Var overflow]
  !!SN:T^Diff_Mod.Battle Reward3^/?z2 Iz2/?z2;
  !!IF:Q1/17/y5/1/z2;
  !!HE-10:Edy5;                         [Give Experience]
!!en;

**Spell Reward
!!if&y50=7;                             [Teach Spell]
  !!HE-10:A2/0/d/?y15;                  [Check for Spell Book]
  !!FU&y15=0:E;                         [Exit if no Spell Book]
  !!FU(Diff_GenerateRandomSpell):P1/4/-10/?y-99; [Funktion to generate a random level 1-4 spell which skips banned spells]
  !!if&y-99>=0/y-99<=69;                [Valid Spell]
    !!HE-10:S7/?y14;                    [7 Wisdom]
    !!SSy-99:L?y5;                      [Spell Level]
    !!FU&y5=5/y14<3:E;                  [Exit if Wisdom level not high enough]
    !!FU&y5=4/y14<2:E;
    !!FU&y5=3/y14<1:E;    
    !!SN:T^Diff_Mod.Battle Reward4^/?z21 Iz21/?z21;
    !!IF:Q2/9/y-99/1^%Z21^;
    !!HE-10:My-99/1;                    [Give Spell]
  !!en;
!!en;

**Artefact Reward
!!if&y50=8;                             [Give Artifact]
  !!VRy1:S0T2;
  !!UN|y1=0/y1=1:J6/2/?y2;              [get a random Treasure artifact  2/3 chance]
  !!UN&y1=2:J6/4/?y2;                   [get a random Minor artifact  1/3 chance]
  !!SN:T^Diff_Mod.Battle Reward5^/?z21 Iz21/?z21;
  !!IF:Q2/8/y2/1^%Z21^;
  !!HEi^battle_hero_0^:A4/y2;           [Give Artifact - equip it if possible]
!!en;

!!UN:R2;                                [Redraw]
!!en;

********************************************************************************


                    Start of AI Improvements Section



********************************************************************************
Increases one of the Primary Skills of any AI Hero when level up by:

Easy/Normal-      50% chance of 1 Random Point
Normal/Hard-     100% chance of 1 Random Point
Hard/Expert-     100% chance of 1 or 2 Random Points
Extreme-         100% chance of 2 Random Points
Insane-          100% chance of 2 or 3 Random Points

!?HL-1&-1000;

!!HE-1:N?y20;
!!SN:W^H3_Game_Difficulty^/?y1; !!FU&y1=0:E; [Get game difficulty, Exit if Easy]
!!VRy50:Sc;
!!SN:W^AIPayday^/?y2; !!FU&y2>y50:E;    [Exit if AI Payday is not yet reached]

!!VRy5:S0;
!!VRy99:S0R1;                           [Make a 50/50 coinflip]
!!VRy5&y1=1:S0; !!VRy5&y1=1/y99=1:S1;   [Easy]
!!VRy5&y1=2:S1;                         [Normal]
!!VRy5&y1=3:S1; !!VRy5&y1=3/y99=1:S3;   [Hard]
!!VRy5&y1=4:S3;                         [Extreme]
!!VRy5&y1=5:S3; !!VRy5&y1=5/y99=1:S4;   [Insane]

!!HEy20:O?y21; !!FU&y21<0:E; !!FU&y5=0:E;[Exit if no hero owner or Easy selected]

[:loop1]
!!VRy2:S0R3;
!!HEy20&y2=0:Fd1/d0/d0/d0;
!!HEy20&y2=1:Fd0/d1/d0/d0;
!!HEy20&y2=2:Fd0/d0/d1/d0;
!!HEy20&y2=3:Fd0/d0/d0/d1;
!!VRy5:-1;                              [increase counter]
!!SN&y5>1:G[loop1];                     [Loop]
********************************************************************************

********************************************************************************
Give AI Player Ressources daily depending on selected difficulty
!?FU(OnEveryDay);                       [Trigger every day for everyone]

!!SN:W^H3_Game_Difficulty^/?y10; !!FU&y10=0:E; [Get game difficulty Exit if zero]
!!VRy5:Sc;
!!SN:W^AIPayday^/?y1; !!FU&y1>y5:E;     [Exit if AI Payday is not yet reached]

!!VRy1:Sc0;                             [get day]
!!OW:C?y1;                              [Check player]
!!OW:Iy1/?y2;                           [AI/Human        1 : AI        0 : Human]
!!OW:Iy1/y2/?y3;                        [Check if killed 1=killed 0=alive]
!!FU|y2=0/y3=1:E;                       [Exit if Human or player Killed]

!!VRy7&y10=1:S2000;  !!VRy8&y10=1:S1;   [Easy]
!!VRy7&y10=2:S3000;  !!VRy8&y10=2:S2;   [Normal]
!!VRy7&y10=3:S4000;  !!VRy8&y10=3:S3;   [Hard]
!!VRy7&y10=4:S5000;  !!VRy8&y10=4:S5;   [Extreme]
!!VRy7&y10=5:S7000;  !!VRy8&y10=5:S6;   [Insane]

!!DO(Give_AI_Money)/0/6/1:Py1/y7/y8;    [Run if AI and still alive]

!?FU(Give_AI_Money);
*x1=Owner, x2=Gold, x3=Resources
!!OW&x16<6:Rx1/x16/dx3;                 [Resources]
!!OW&x16=6:Rx1/x16/dx2;                 [Gold]


********************************************************************************
Gives AI creatures,spellpoints, movement and experience daily

!?FU(OnEveryDay)&i^timerOnce^=1/i^timerDay^>=1/i^timerIsAi^=0; [Every day, Once and only Human]

!!SN:W^AIPayday^/?y1; !!FU&y1>x1:E;     [Exit if AI Payday is not yet reached]
!!SN&i^timerDay^=y1/i^timerDay^>1:T^Diff_Mod.Payday_Message^/?z-2;
!!IF&i^timerDay^=y1/i^timerDay^>1:L^%Z-2{~}^;

!!SN:W^Progressive_Difficulty^/?y2;
!!SN:W^Difficulty_day^/?y1;

!!FU(Progressive_Difficulty)&i^timerDay^=y1/y2=1:P; [Run prog increase if option is selected and day equals payday]

!!SN:W^H3_Game_Difficulty^/?y1;
!!DO(AI_Increase_Loop)/0/155/1&y1>0:P;  [loop through heroes]


!?FU(AI_Increase_Loop);

!!HEx16:O?y1;                           [Checke Hero Owner]
!!FU&y1=-1:E;                           [Exit if none]
!!OW:Iy1/?y2;                           [AI 1 / Human 0]
!!OW:Iy1/y2/?y3;                        [Check if player killed 1=killed 0=alive]
!!FU|y2=0/y3=1:E;                       [Exit if Human or player Killed]

!!VRy10:Sc;                             [get day]
!!VRy10:%2;                             [Modulo 2]
!!SN:W^H3_Game_Difficulty^/?y5;   !!VRy10&y5=5:S0; [If Insane Difficulty Set creature Reward to daily]

!!FU(Give_AI_Creatures)&y10=0:Px16/y1;  [Run if AI and still alive und gerader Tag]
!!FU(Give_AI_Experience):Px16/y1;       [Run if AI and still alive]
!!FU(Give_AI_Spell_Points):Px16/y1;     [Run if AI and still alive]
!!FU(Give_AI_Movement):Px16/y1;         [Run if AI and still alive]
!!FU(Give_AI_Spell_Book):Px16/y1;       [Run if AI and still alive]


!?FU(Give_AI_Creatures);
x1=hero, x2=owner
!!SN:W^H3_Game_Difficulty^/?y1;
!!FU&y1=0:E;

!!VRy11&y1=1:S2; !!VRy12&y1=1:S2; !!VRy13&y1=1:S1; !!VRy14&y1=1:S1; !!VRy15&y1=1:S0; !!VRy16&y1=1:S0; !!VRy17&y1=1:S0; [Easy]
!!VRy11&y1=2:S3; !!VRy12&y1=2:S3; !!VRy13&y1=2:S2; !!VRy14&y1=2:S2; !!VRy15&y1=2:S1; !!VRy16&y1=2:S0; !!VRy17&y1=2:S0; [Medium]
!!VRy11&y1=3:S5; !!VRy12&y1=3:S4; !!VRy13&y1=3:S3; !!VRy14&y1=3:S3; !!VRy15&y1=3:S2; !!VRy16&y1=3:S1; !!VRy17&y1=3:S0; [Hard]
!!VRy11&y1=4:S7; !!VRy12&y1=4:S6; !!VRy13&y1=4:S5; !!VRy14&y1=4:S4; !!VRy15&y1=4:S3; !!VRy16&y1=4:S1; !!VRy17&y1=4:S1; [Extreme]
!!VRy11&y1=5:S7; !!VRy12&y1=5:S6; !!VRy13&y1=5:S5; !!VRy14&y1=5:S4; !!VRy15&y1=5:S3; !!VRy16&y1=5:S1; !!VRy17&y1=5:S1; [Insane]

!!SN:W^AI_Bonus_Creature_lvl_1^/y11;    [Level 1]
!!SN:W^AI_Bonus_Creature_lvl_2^/y12;    [Level 2]
!!SN:W^AI_Bonus_Creature_lvl_3^/y13;    [Level 3]
!!SN:W^AI_Bonus_Creature_lvl_4^/y14;    [Level 4]
!!SN:W^AI_Bonus_Creature_lvl_5^/y15;    [Level 5]
!!SN:W^AI_Bonus_Creature_lvl_6^/y16;    [Level 6]
!!SN:W^AI_Bonus_Creature_lvl_7^/y17;    [Level 7]

!!re i/0/6;
!!HEx1:C0/i/?y21/?y22;                  [Check creatures to Hero Army]
!!if&y21>=0/y22>0;
!!MA:Ly21/?y30;                         [Get level of Monster]
!!VRy3&y30=0:Sy11;                      [Level 1]
!!VRy3&y30=1:Sy12;                      [Level 2]
!!VRy3&y30=2:Sy13;                      [Level 3]
!!VRy3&y30=3:Sy14;                      [Level 4]
!!VRy3&y30=4:Sy15;                      [Level 5]
!!VRy3&y30=5:Sy16;                      [Level 6]
!!VRy3&y30=6:Sy17;                      [Level 7]
!!HEx1&y21>=0/y22>0/y3>0:C0/i/y21/dy3;  [Add creatures to Hero Army]
!!en;
!!en;


!?FU(Give_AI_Experience);
!!SN:W^H3_Game_Difficulty^/?y1;
!!VRy2&y1=1:S500; !!VRy2&y1=2:S1000; !!VRy2&y1=3:S2500; !!VRy2&y1=4:S5000; !!VRy2&y1=5:S10000;
!!HEx1:Edy2;                            [Gives Experience daily]


!?FU(Give_AI_Spell_Points);
!!SN:W^H3_Game_Difficulty^/?y1;
!!VRy2&y1=1:S5; !!VRy2&y1=2:S10; !!VRy2&y1=3:S15; !!VRy2&y1=4:S20; !!VRy2&y1=5:S25;
!!HEx1:Idy2/1;                          [Gives Mana daily]
!!HEx1:I?y3/1;
!!HEx1&y3>999:I999/1;


!?FU(Give_AI_Movement);
!!SN:W^H3_Game_Difficulty^/?y1;
!!VRy2&y1=1:S200;                       [Normal]
!!VRy2&y1=2:S300;                       [Hard]
!!VRy2&y1=3:S400;                       [Expert]
!!VRy2&y1=4:S500;                       [Extreme]
!!VRy2&y1=5:S700;                       [Insane]
!!HEx1:Wdy2/1;                          [Add little Bonus Movement dependant on Level]


!?FU(Give_AI_Spell_Book);
!!HEx1:A2/0/?y12/?y13;                  [Check for Spell Book]
!!HEx1&y13=0:A4/0;                      [Give Spell Book if none]
!!HEx1:M54/1;                           [Give Slow]
!!HEx1:M37/1;                           [Give Cure]
!!HEx1:M42/1;                           [Give Curse]
!!HEx1:M53/1;                           [Give Haste]
************************************************************************************
** Hell mod. ctrl+click crazy difficulty
Auto upgrade with more bonus+ultimate dragons after day 35

!?FU(OnEveryDay)&i^timerOnce^=1/i^timerDay^>19; [hehe]
!!SN:W^Legacy_of_the_Silence_Active^/?y1; !!FU&y1=0:E; [Check if LotS is active]
!!SN:W^AI_Hell_Mod^/?y1;
!!FU&y1=0:E;
!!DO(Hell_mod)/0/155/1:P;

!?FU(Hell_mod);
!!HEx16:O?y1;                           [Checke Hero Owner]
!!FU&y1=-1:E;                           [Exit if none]
!!OW:Iy1/?y2;                           [AI 1 / Human 0]
!!OW:Iy1/y2/?y3;                        [Check if player killed 1=killed 0=alive]
!!FU|y2=0/y3=1:E;                       [Exit if Human or player Killed]

!!EXx16/0:E9999999999;
!!EXx16/1:E9999999999;
!!EXx16/2:E9999999999;
!!EXx16/3:E9999999999;
!!EXx16/4:E9999999999;
!!EXx16/5:E9999999999;
!!EXx16/6:E9999999999;

!!HEx16:Wd400/1;  

!!VRy5:S0R3;
!!HEx16&y5=0:Fd1/d0/d0/d0;
!!HEx16&y5=1:Fd0/d1/d0/d0;
!!HEx16&y5=2:Fd0/d0/d1/d0;
!!HEx16&y5=3:Fd0/d0/d0/d1;
!!DO(Auto_Upgrade)/0/300/1:Px16;

!!HEx16:E?y3/?y4;
!!VRy3&y3>=15000000:S15000000;          [Fix for Var overflow]
!!VRy5:Sy3;
!!VRy5:*110:100 -y3;
!!HEx16:Edy5;                           [Give Experience]


!?FU(Auto_Upgrade);
!!MA:Ux16/?y1;
!!FU&y1<0:E;
!!HEx1:C1/x16/y1/d;


!?FU(OnEveryDay)&i^timerDay^>34/i^timerWeekDay^=1/i^timerOnce^=1;
!!SN:W^AI_Hell_Mod^/?y1;
!!FU&y1=0:E;
!!DO(Hell_mod2)/0/155/1:P;
!!SN:T^Diff_Mod.Hell_Message^/?z-2;
!!IF&1000/i^timerDay^<40:L^%Z-2{~}^;


!?FU(Hell_mod2);
!!HEx16:O?y1;                           [Checke Hero Owner]
!!FU&y1=-1:E;                           [Exit if none]
!!OW:Iy1/?y2;                           [AI 1 / Human 0]
!!OW:Iy1/y2/?y3;                        [Check if player killed 1=killed 0=alive]
!!FU|y2=0/y3=1:E;                       [Exit if Human or player Killed]

!!VRy1:S0R4;
!!VRy2&y1=0:S253;
!!VRy2&y1=1:S254;
!!VRy2&y1=2:S263;
!!VRy2&y1=3:S275;
!!VRy2&y1=4:S276;
!!HEx16:C2/y2/1/0;


********************************************************************************
!?FU(Progressive_Difficulty);

!!SN:W^H3_Game_Difficulty^/?y1;
!!VRy1:+1;                              [Increase game Difficult by one level]
!!VRy1&y1>=5:S5;                        [If it was already on Insane dont increase further]
!!SN:W^H3_Game_Difficulty^/y1;

!!SN&y1=1:T^Diff_Mod.AI_Level_Easy^/?z-1;
!!SN&y1=2:T^Diff_Mod.AI_Level_Normal^/?z-1;
!!SN&y1=3:T^Diff_Mod.AI_Level_Hard^/?z-1;
!!SN&y1=4:T^Diff_Mod.AI_Level_Extreme^/?z-1;
!!SN&y1=5:T^Diff_Mod.AI_Level_Insane^/?z-1;

!!SN:T^Diff_Mod.game_difficulty_increase^/?z2 Iz2/?z2;
!!IF:M^%Z2^;


********************************************************************************
Increase starting troop of AI player to handle possible bigger stacks at map start
Increase the available troops to buy in castles of AI
!?FU(OnEveryDay)&i^timerOnce^=1/i^timerDay^=1; [At first day of Map]
!!SN:W^AI_Compensation^/?y1; !!FU&y1=0:E;[Exit if option is disabled]
!!re y1/0/155;
  !!HEy1:O?y2;                          [Checke Hero Owner]
  !!OW:Iy2/?y3;                         [Check if AI (1)]
  !!if&y2>=0/y3=1;                      [If AI and has a Owner]
    !!re i/0/6;
    !!HEy1:C0/i/?y21/?y22;              [Check creatures to Hero Army]
    !!if&y21>=0/y22>0;
      !!MA:Ly21/?y30;                   [Get level of Monster]
      !!SN:W^Additionals_troops^/?y9;   [Get new value in y1]
      !!SN:W^Double_Neutral_Stacks_Map_Start^/?y20;
      !!VRy10&y9=0:S25;                 [None]
      !!VRy10&y9=1:S30;                 [Easy]
      !!VRy10&y9=2:S40;                 [Normal]
      !!VRy10&y9=3:S60;                 [Hard]
      !!VRy10&y9=4:S70;                 [Extreme]
      !!VRy10&y9=5:S90;                 [Insane]
      !!VRy10&y20=1:+75;                [Add additional 75 troops of double stack size was enabled]
      !!HEy1&y21>=0/y22>0/y22<100/y30<2:C0/i/y21/dy10; [Add creatures to Hero Army but only increase first and second level]
    !!en;
  !!en;
  !!en;
!!en;

!!VRy30&y9=0:S35; !!VRy31&y9=0:S25; !!VRy32&y9=0:S15; [increase the available growth for level 1 to 3 in town for the AI to hire]
!!VRy30&y9=1:S45; !!VRy31&y9=1:S35; !!VRy32&y9=1:S26;
!!VRy30&y9=2:S60; !!VRy31&y9=2:S40; !!VRy32&y9=2:S30;
!!VRy30&y9=3:S80; !!VRy31&y9=3:S50; !!VRy32&y9=3:S35;
!!VRy30&y9=4:S90; !!VRy31&y9=4:S60; !!VRy32&y9=4:S40;
!!VRy30&y9=5:S120; !!VRy31&y9=5:S100; !!VRy32&y9=5:S50;
!!if&y20=1;                             [If double stack size option is active increase the available growth in town for the AI to hire]
!!VRy30:+50; !!VRy31:+50; !!VRy32:+50;  [+ growth]
!!en;


!!UN:U98/-1/?y2;                        [Get the Number of total Towns on the map in y2]
!!VRv2:S-1;                             [Search Index]
!!re i/1/y2;
  !!UN:U98/-1/-1/2;                     [Get Coordinates of Town]
  !!CAv2/v3/v4:O?y3;                    [Check Town owner]
  !!OW&y3>=0:Iy3/?y4;                   [Check if AI (1)]
  !!if&y3>=0/y4=1;                      [If town has a owner and is from AI 1]
    !!CAv2/v3/v4:B3/37;                 [Check for Level 1 building]
    !!CAv2/v3/v4&1:M1/0/d0/dy30;
    !!CAv2/v3/v4&-1:B3/30;              [dwelling 1]
    !!CAv2/v3/v4&1:M1/0/dy30/d0;

    !!CAv2/v3/v4:B3/38;                 [Check for Level 2 building]
    !!CAv2/v3/v4&1:M1/1/d0/dy31;
    !!CAv2/v3/v4&-1:B3/31;              [dwelling 2]
    !!CAv2/v3/v4&1:M1/1/dy31/d0;

    !!CAv2/v3/v4:B3/39;                 [Check for Level 3 building]
    !!CAv2/v3/v4&1:M1/2/d0/dy32;
    !!CAv2/v3/v4&-1:B3/32;              [dwelling 3]
    !!CAv2/v3/v4&1:M1/2/dy32/d0;
  !!en;
!!en;


********************************************************************************
Cycles through all heroes every day once and unlearns DD from every AI hero and learns Fly instead
!?FU(OnEveryDay)&i^timerOnce^=1/i^timerDay^>=1; [Every day once]
!!SN:W^AI_has_no_DD^/?y1; !!FU&y1=0:E;  [Exit if option is disabled]
!!re y1/0/155;
  !!HEy1:O?y2;                          [Checke Hero Owner]
  !!OW:Iy2/?y3;                         [Check if AI (1)]
  !!if&y2>=0/y3=1;                      [If AI and has a Owner]
    !!HEy1:M8/?y10;                     [Check for DD]
    !!HEy1&y10=1:M8/0 M6/1;             [Unlearn Dimension Door and learn Fly instead]
  !!en;
!!en;

; Disable AI from casting DD
!?FU(OnAfterErmInstructions);
!!SS(SPELL_DIMENSION_DOOR):E0/?i^difm_dDEffect_notLearned^;
!!SS(SPELL_DIMENSION_DOOR):E1/?i^difm_dDEffect_basic^;
!!SS(SPELL_DIMENSION_DOOR):E2/?i^difm_dDEffect_advanced^;
!!SS(SPELL_DIMENSION_DOOR):E3/?i^difm_dDEffect_expert^;

!?FU(OnEveryDay)&i^timerIsAi^/i^AI_has_no_DD^;
!!SS(SPELL_DIMENSION_DOOR):E0/0;
!!SS(SPELL_DIMENSION_DOOR):E1/0;
!!SS(SPELL_DIMENSION_DOOR):E2/0;
!!SS(SPELL_DIMENSION_DOOR):E3/0;

!?FU(OnEveryDay)&i^timerIsHuman^/i^AI_has_no_DD^;
!!SS(SPELL_DIMENSION_DOOR):E0/i^difm_dDEffect_notLearned^;
!!SS(SPELL_DIMENSION_DOOR):E1/i^difm_dDEffect_basic^;
!!SS(SPELL_DIMENSION_DOOR):E2/i^difm_dDEffect_advanced^;
!!SS(SPELL_DIMENSION_DOOR):E3/i^difm_dDEffect_expert^;

********************************************************************************
AI gets 50% of combat loses recovered

!?FU(OnBeforeBattleUniversal)&-1000;

!!SN:W^AI_Recover_Losses^/?y1; !!FU&y1=0:E; [Exit if option is disabled]
!!BA:H0/?y1;                            [Attacker Hero Number]
!!FU&y1<0:E;                            [Exit if no Hero]

!!HEy1:O?y2;                            [get owner of this hero]
!!OW:Iy2/?y3;                           [Check if AI (1)]
!!FU|y2=-1/y3=0:E;                      [Exit if no owner of is from Human]

!!SN:W^AI_Hero_Attacker_Owner^/y2;      [Check Owner Before Fight]

!!re i/0/6;                             [cycle hero troops]
!!HEy1:C0/i/?y2/?y3; !!SN:W^ACM_AI_Slot_Type_%i^/y2; !!SN:W^ACM_AI_Slot_Number_%i^/y3; [save slots]
!!en;


!?FU(OnAfterBattleUniversal)&-1000;

!!SN:W^AI_Recover_Losses^/?y1; !!FU&y1=0:E; [Exit if option is disabled]
!!BA:H0/?y1;                            [Attacker Hero Number]
!!FU&y1<0:E;                            [Exit if no Hero]
!!HEy1:O?y2;                            [get owner of this hero]
!!SN:W^AI_Hero_Attacker_Owner^/?y3;     [Check Owner Before Fight]
!!FU&y2<>y3:E;                          [Prevent to give Bonus if retreat]
!!FU&y2=-1:E;                           [Exit if no owner]

!!re i/0/6;                             [cycle hero troops]
  !!HEy1:C0/i/?y2/?y3; !!SN:W^ACM_AI_Slot_Type_%i^/?y20; !!SN:W^ACM_AI_Slot_Number_%i^/?y30; [compare with old value]
  !!VRy5:Sy30-y3:2+1;                   [Recovers 50% of losses rounded up]
  !!HEy1&y2=y20/y3<y30/y2<>1/y5>0:C0/i/?y2/dy5; [add troops to AI again]
!!en;


****************************************************************************************************
!?FU(Set_Stack_Size_Mod);

!!SN&x1>=1:W^Stack_Size_Enable^/1;      [Actiavte So it can run more than once]
!!SN&x1=0:W^Stack_Size_Enable^/0;       [Deavtivate Stack_Size_Modification]

!!if&x1=1;                              [Easy]
!!SN:W^Stack_Size_Mod_L1^/20;           [Lvl 1]
!!SN:W^Stack_Size_Mod_L2^/18;           [Lvl 2]
!!SN:W^Stack_Size_Mod_L3^/15;           [Lvl 3]
!!SN:W^Stack_Size_Mod_L4^/12;           [Lvl 4]
!!SN:W^Stack_Size_Mod_L5^/8;            [Lvl 5]
!!SN:W^Stack_Size_Mod_L6^/6;            [Lvl 6]
!!SN:W^Stack_Size_Mod_L7^/5;            [Lvl 7]
!!SN:W^Stack_Size_Mod_L8^/3;            [Lvl 8]
!!en;

!!if&x1=2;                              [Normal]
!!SN:W^Stack_Size_Mod_L1^/30;           [Lvl 1]
!!SN:W^Stack_Size_Mod_L2^/25;           [Lvl 2]
!!SN:W^Stack_Size_Mod_L3^/20;           [Lvl 3]
!!SN:W^Stack_Size_Mod_L4^/15;           [Lvl 4]
!!SN:W^Stack_Size_Mod_L5^/10;           [Lvl 5]
!!SN:W^Stack_Size_Mod_L6^/8;            [Lvl 6]
!!SN:W^Stack_Size_Mod_L7^/6;            [Lvl 7]
!!SN:W^Stack_Size_Mod_L8^/4;            [Lvl 8]
!!en;

!!if&x1=3;                              [Hard]
!!SN:W^Stack_Size_Mod_L1^/40;           [Lvl 1]
!!SN:W^Stack_Size_Mod_L2^/35;           [Lvl 2]
!!SN:W^Stack_Size_Mod_L3^/30;           [Lvl 3]
!!SN:W^Stack_Size_Mod_L4^/25;           [Lvl 4]
!!SN:W^Stack_Size_Mod_L5^/20;           [Lvl 5]
!!SN:W^Stack_Size_Mod_L6^/15;           [Lvl 6]
!!SN:W^Stack_Size_Mod_L7^/10;           [Lvl 7]
!!SN:W^Stack_Size_Mod_L8^/8;            [Lvl 8]
!!en;

!!if&x1=4;                              [Extreme]
!!SN:W^Stack_Size_Mod_L1^/70;           [Lvl 1]
!!SN:W^Stack_Size_Mod_L2^/55;           [Lvl 2]
!!SN:W^Stack_Size_Mod_L3^/50;           [Lvl 3]
!!SN:W^Stack_Size_Mod_L4^/45;           [Lvl 4]
!!SN:W^Stack_Size_Mod_L5^/40;           [Lvl 5]
!!SN:W^Stack_Size_Mod_L6^/30;           [Lvl 6]
!!SN:W^Stack_Size_Mod_L7^/20;           [Lvl 7]
!!SN:W^Stack_Size_Mod_L8^/12;           [Lvl 8]
!!en;

!!if&x1=5;                              [Insane]
!!SN:W^Stack_Size_Mod_L1^/120;          [Lvl 1]
!!SN:W^Stack_Size_Mod_L2^/80;           [Lvl 2]
!!SN:W^Stack_Size_Mod_L3^/70;           [Lvl 3]
!!SN:W^Stack_Size_Mod_L4^/60;           [Lvl 4]
!!SN:W^Stack_Size_Mod_L5^/50;           [Lvl 5]
!!SN:W^Stack_Size_Mod_L6^/40;           [Lvl 6]
!!SN:W^Stack_Size_Mod_L7^/30;           [Lvl 7]
!!SN:W^Stack_Size_Mod_L8^/20;           [Lvl 8]
!!en;


!?FU(Set_Guarded_Object_Mod);

!!if&x1=0;                              [Default]
!!SN:W^Guarded_Object_growth_Rate^/110; [10% Growth Rate]
!!SN:W^Guarded_Object_Faktor^/3;        [*3 multiply factor for guards]
!!SN:W^Guarded_Object_Commander_Bonus_Att^/2; [Original Values  more is better]
!!SN:W^Guarded_Object_Commander_Bonus_Dmg^/2; [Original Values  more is better]
!!SN:W^Guarded_Object_Commander_Bonus_HP^/50; [Original Values  more is better]
!!en;

!!if&x1=1;                              [Easy]
!!SN:W^Guarded_Object_growth_Rate^/112; [12% Growth Rate]
!!SN:W^Guarded_Object_Faktor^/3;        [*3 multiply factor for guards]
!!SN:W^Guarded_Object_Commander_Bonus_Att^/3;
!!SN:W^Guarded_Object_Commander_Bonus_Dmg^/6;
!!SN:W^Guarded_Object_Commander_Bonus_HP^/75;
!!en;

!!if&x1=2;                              [Normal]
!!SN:W^Guarded_Object_growth_Rate^/115; [15% Growth Rate]
!!SN:W^Guarded_Object_Faktor^/3;        [*3 multiply factor for guards]
!!SN:W^Guarded_Object_Commander_Bonus_Att^/4; [more is better  Att per Week]
!!SN:W^Guarded_Object_Commander_Bonus_Dmg^/8; [High Dmg per Week]
!!SN:W^Guarded_Object_Commander_Bonus_HP^/100; [Health per Week]
!!en;

!!if&x1=3;                              [Hard]
!!SN:W^Guarded_Object_growth_Rate^/120; [20% Growth Rate]
!!SN:W^Guarded_Object_Faktor^/4;        [*4 multiply factor for guards]
!!SN:W^Guarded_Object_Commander_Bonus_Att^/5; [more is better  Att per Week]
!!SN:W^Guarded_Object_Commander_Bonus_Dmg^/12; [High Dmg per Week]
!!SN:W^Guarded_Object_Commander_Bonus_HP^/150; [Health per Week]
!!en;

!!if&x1=4;                              [Extreme]
!!SN:W^Guarded_Object_growth_Rate^/125; [25% Growth Rate]
!!SN:W^Guarded_Object_Faktor^/4;        [*4 multiply factor for guards]
!!SN:W^Guarded_Object_Commander_Bonus_Att^/10; [more is better  Att per Week]
!!SN:W^Guarded_Object_Commander_Bonus_Dmg^/40; [High Dmg per Week]
!!SN:W^Guarded_Object_Commander_Bonus_HP^/250; [Health per Week]
!!en;

!!if&x1=5;                              [Impossible]
!!SN:W^Guarded_Object_growth_Rate^/130; [30% Growth Rate]
!!SN:W^Guarded_Object_Faktor^/5;        [*5 multiply factor for guards]
!!SN:W^Guarded_Object_Commander_Bonus_Att^/15; [more is better  Att per Week]
!!SN:W^Guarded_Object_Commander_Bonus_Dmg^/75; [High Dmg per Week]
!!SN:W^Guarded_Object_Commander_Bonus_HP^/350; [Health per Week]
!!en;


****************************************************************************************************
**Initialize all to Zero at Map Start**

!#SN:W^Double_Growth_Rate^/0;
!#SN:W^Low_Level_Growth^/0;
!#SN:W^Neutral_Growth_10000^/0;
!#SN:W^Double_Neutral_Stacks^/0;
!#SN:W^Health_Grow_Enable^/0;
!#SN:W^Stack_Size_Enable^/0;

!#SN:W^Guarded_Object_growth_Rate^/110; [10% original values]
!#SN:W^Guarded_Object_Faktor^/3;        [*1,5 Faktor  Original Values  more is better]
!#SN:W^Guarded_Object_Commander_Bonus_Att^/2; [Original Values  more is better]
!#SN:W^Guarded_Object_Commander_Bonus_Dmg^/2; [Original Values]
!#SN:W^Guarded_Object_Commander_Bonus_HP^/50; [Original Values]

!#SN:W^Stack_Exp_Rate^/0;

!#SN:W^Tougher_Karmic_Battles_on^/0;
!#SN:W^Extra_Enchantments_on^/0;
!#SN:W^Random_Neutral_Hero^/0;
!#SN:W^More_Random_Stack_Size^/0;

!#SN:W^Neutral_Stack_Weekly_Upgrade^/0;
!#SN:W^Battle_Commander^/0;
!#SN:W^Neutral_Stack_Uptier1^/0;
!#SN:W^Neutral_Stack_Uptier2^/0;

!#SN:W^Anzahl_Buffs^/0;
!#SN:W^Random_Abilities^/0;
!#SN:W^Anzahl_Abilities^/0;
!#SN:W^Battle_Reward^/0;
!#SN:W^Battle_Reward_Active^/0;
!#SN:W^H3_Game_Difficulty^/0;
!#SN:W^Exit_Pressed^/0;
!#SN:W^Progressive_Difficulty^/0;
!#SN:W^Difficulty_day^/0;

!#SN:W^Stack_Size_Mod_L1^/0;            [Lvl 1]
!#SN:W^Stack_Size_Mod_L2^/0;            [Lvl 2]
!#SN:W^Stack_Size_Mod_L3^/0;            [Lvl 3]
!#SN:W^Stack_Size_Mod_L4^/0;            [Lvl 4]
!#SN:W^Stack_Size_Mod_L5^/0;            [Lvl 5]
!#SN:W^Stack_Size_Mod_L6^/0;            [Lvl 6]
!#SN:W^Stack_Size_Mod_L7^/0;            [Lvl 7]
!#SN:W^Stack_Size_Mod_L8^/0;            [Lvl 8]

!#SN:W^AI_Recover_Losses^/1;            [Check if options have already been activated]
!#SN:W^AI_Compensation^/1;
!#SN:W^AI_Useful_Spells^/0;
!#SN:W^AI_has_no_DD^/0;
!#SN:W^AI_Artifacts_Eq^/1;              [Artifact mod is switched on by default]

!#SN:F^PluginExists^/^amethyst2_4^;     [Check for amethyst Plugin, result in v1]
!#SN&v1=1:W^Typhon_Third_Upgrade_Mod_Active^/1; [Check for Third Upgrade Mod]
!#SN&v1=1:W^TUM_registerRegularMonsters^/1; [Enable new Third Upgrade Mod Creatures option when mod is active]

!?PI;
!!FU(Game_Difficulty_Options):P;        [Run at Map Start]

*********************************The END****************************************


Author PerryR 2019 for ERA II
Idea by Daemon

This script checks the artifacts of AI heroes every day and equips better ones if available in a backpack.
You can conduct the priority order for equipping by reading the code. The lower an artifact is the higher the priority.
If possible it will always equip the best artifact.



********************************************************************************
*Daily Tigger, runs only once per game day for all AI Heroes*
!?FU(OnEveryDay)&i^timerOnce^=1;        [Every day once]

!!SN:W^AI_Artifacts_Eq^/?y1;            [Check for option]
!!FU&y1=0:E;                            [Exit if not active]
!!IF:V761/1;                            [Fix for ACM sets, temporarly disables the Equip/Unequip proces]
!!DO(AI_Hero_Artifacts)/0/155/1:P;      [loop through heroes]
!!IF:V761/0;


!?FU(AI_Hero_Artifacts);
*x16=Hero Numbers

!!HEx16:O?y1;                           [Checke Hero Owner]
!!FU&y1=-1:E;                           [Exit if none]
!!OW:Iy1/?y2;                           [Check if AI (1)]
!!FU&y2=0:E;                            [Exit if human]


********************************************************************************
Right Hand Slot
(11)

7 Centaur Axe
8 Blackshard of the Dead Knight
9 Greater Gnoll's Flail
10 Ogre's Club of Havoc
11 Sword of Hellfire
12 Titan's Gladius
35 Sword of Judgement
38 Red Dragon Flame Tongue
128 Armageddon's Blade
146 Axe of Smashing (Not considered)
148 Sword of Sharpness (Not considered)

!!HEx16:A2/8/?y10/?y11;                 [8 Blackshard of the Dead Knight]
!!if&y10=1/y11=0;                       [If in Backpack but not equipped]
!!DO(AI_Right_Hand)/7/7/1:Px16;
!!DO(AI_Right_Hand)/9/12/1:Px16;
!!DO(AI_Right_Hand)/35/35/1:Px16;       [35 Sword of Judgement]
!!DO(AI_Right_Hand)/38/38/1:Px16;       [38 Red Dragon Flame Tongue]
!!DO(AI_Right_Hand)/128/128/1:Px16;     [128 Armageddon's Blade]
!!DO(AI_Right_Hand)/146/146/1:Px16;     [146 Axe of Smashing]
!!DO(AI_Right_Hand)/148/148/1:Px16;     [148 Sword of Sharpness]
!!HEx16:A-8; !!HEx16:A4/8;              [First remove Blackshard of the Dead Knight from Hero and than equip it]
!!en;

!!HEx16:A2/38/?y10/?y11;                [38 Red Dragon Flame Tongue]
!!if&y10=1/y11=0;                       [If in Backpack but not equipped]
!!DO(AI_Right_Hand)/7/12/1:Px16;
!!DO(AI_Right_Hand)/35/35/1:Px16;       [35 Sword of Judgement]
!!DO(AI_Right_Hand)/128/128/1:Px16;     [128 Armageddon's Blade]
!!DO(AI_Right_Hand)/146/146/1:Px16;     [146 Axe of Smashing]
!!DO(AI_Right_Hand)/148/148/1:Px16;     [148 Sword of Sharpness]
!!HEx16:A-38; !!HEx16:A4/38;
!!en;

!!HEx16:A2/9/?y10/?y11;                 [9 Greater Gnoll's Flail]
!!if&y10=1/y11=0;                       [If in Backpack but not equipped]
!!DO(AI_Right_Hand)/7/8/1:Px16;
!!DO(AI_Right_Hand)/10/12/1:Px16;
!!DO(AI_Right_Hand)/35/35/1:Px16;       [35 Sword of Judgement]
!!DO(AI_Right_Hand)/38/38/1:Px16;       [38 Red Dragon Flame Tongue]
!!DO(AI_Right_Hand)/128/128/1:Px16;     [128 Armageddon's Blade]
!!DO(AI_Right_Hand)/146/146/1:Px16;     [146 Axe of Smashing]
!!DO(AI_Right_Hand)/148/148/1:Px16;     [148 Sword of Sharpness]
!!HEx16:A-9; !!HEx16:A4/9;
!!en;

!!HEx16:A2/10/?y10/?y11;                [10 Ogre's Club of Havoc]
!!if&y10=1/y11=0;                       [If in Backpack but not equipped]
!!DO(AI_Right_Hand)/7/9/1:Px16;
!!DO(AI_Right_Hand)/11/12/1:Px16;
!!DO(AI_Right_Hand)/35/35/1:Px16;       [35 Sword of Judgement]
!!DO(AI_Right_Hand)/38/38/1:Px16;       [38 Red Dragon Flame Tongue]
!!DO(AI_Right_Hand)/128/128/1:Px16;     [128 Armageddon's Blade]
!!DO(AI_Right_Hand)/146/146/1:Px16;     [146 Axe of Smashing]
!!DO(AI_Right_Hand)/148/148/1:Px16;     [148 Sword of Sharpness]
!!HEx16:A-10; !!HEx16:A4/10;
!!en;

!!HEx16:A2/11/?y10/?y11;                [11 Sword of Hellfire]
!!if&y10=1/y11=0;                       [If in Backpack but not equipped]
!!DO(AI_Right_Hand)/7/10/1:Px16;
!!DO(AI_Right_Hand)/12/12/1:Px16;
!!DO(AI_Right_Hand)/35/35/1:Px16;       [35 Sword of Judgement]
!!DO(AI_Right_Hand)/38/38/1:Px16;       [38 Red Dragon Flame Tongue]
!!DO(AI_Right_Hand)/128/128/1:Px16;     [128 Armageddon's Blade]
!!DO(AI_Right_Hand)/146/146/1:Px16;     [146 Axe of Smashing]
!!DO(AI_Right_Hand)/148/148/1:Px16;     [148 Sword of Sharpness]
!!HEx16:A-11; !!HEx16:A4/11;
!!en;

!!HEx16:A2/128/?y10/?y11;               [128 Armageddon's Blade]
!!if&y10=1/y11=0;                       [If in Backpack but not equipped]
!!DO(AI_Right_Hand)/7/12/1:Px16;        [Run function and pass hero number]
!!DO(AI_Right_Hand)/35/35/1:Px16;       [35 Sword of Judgement]
!!DO(AI_Right_Hand)/38/38/1:Px16;       [38 Red Dragon Flame Tongue]
!!DO(AI_Right_Hand)/146/146/1:Px16;     [146 Axe of Smashing]
!!DO(AI_Right_Hand)/148/148/1:Px16;     [148 Sword of Sharpness]
!!HEx16:A-128; !!HEx16:A4/128;
!!en;

!!HEx16:A2/35/?y10/?y11;                [35 Sword of Judgement]
!!if&y10=1/y11=0;                       [If in Backpack but not equipped]
!!DO(AI_Right_Hand)/7/12/1:Px16;        [Run function and pass hero number]
!!DO(AI_Right_Hand)/38/38/1:Px16;       [38 Red Dragon Flame Tongue]
!!DO(AI_Right_Hand)/128/128/1:Px16;     [128 Armageddon's Blade]
!!DO(AI_Right_Hand)/146/146/1:Px16;     [146 Axe of Smashing]
!!DO(AI_Right_Hand)/148/148/1:Px16;     [148 Sword of Sharpness]
!!HEx16:A-35; !!HEx16:A4/35;            [First remove Sword of Judgement from Hero and than equip it]
!!en;

!!HEx16:A2/12/?y10/?y11;                [12 Titan's Gladius]
!!if&y10=1/y11=0;                       [If in Backpack but not equipped]
!!DO(AI_Right_Hand)/7/11/1:Px16;        [Run function and pass hero number]
!!DO(AI_Right_Hand)/35/35/1:Px16;       [35 Sword of Judgement]
!!DO(AI_Right_Hand)/38/38/1:Px16;       [38 Red Dragon Flame Tongue]
!!DO(AI_Right_Hand)/128/128/1:Px16;     [128 Armageddon's Blade]
!!DO(AI_Right_Hand)/146/146/1:Px16;     [146 Axe of Smashing]
!!DO(AI_Right_Hand)/148/148/1:Px16;     [148 Sword of Sharpness]
!!HEx16:A-12; !!HEx16:A4/12;            [First remove Titan's Gladius from Hero and than equip it]
!!en;


********************************************************************************
Left Hand Slot
(10)

13 Shield of the Dwarven Lords
14 Shield of the Yawning Dead
15 Buckler of the Gnoll King
16 Targ of the Rampaging Ogre
17 Shield of the Damned
18 Sentinel's Shield
34 Lion's Shield of Courage
39 Dragon Scale Shield
154 Hardened Shield (Not considered)
157 Crimson Shield of Retribution (Not considered)

!!HEx16:A2/14/?y10/?y11;                [14 Shield of the Yawning Dead]
!!if&y10=1/y11=0;
!!DO(AI_Left_Hand)/13/13/1:Px16;
!!DO(AI_Left_Hand)/15/18/1:Px16;
!!DO(AI_Left_Hand)/34/34/1:Px16;        [34 Lion's Shield of Courage]
!!DO(AI_Left_Hand)/39/39/1:Px16;        [39 Dragon Scale Shield]
!!DO(AI_Left_Hand)/154/154/1:Px16;      [154 Hardened Shield]
!!DO(AI_Left_Hand)/157/157/1:Px16;      [157 Crimson Shield of Retribution]
!!HEx16:A-14; !!HEx16:A4/14;
!!en;

!!HEx16:A2/15/?y10/?y11;                [15 Buckler of the Gnoll King]
!!if&y10=1/y11=0;
!!DO(AI_Left_Hand)/13/14/1:Px16;
!!DO(AI_Left_Hand)/16/18/1:Px16;
!!DO(AI_Left_Hand)/34/34/1:Px16;        [34 Lion's Shield of Courage]
!!DO(AI_Left_Hand)/39/39/1:Px16;        [39 Dragon Scale Shield]
!!DO(AI_Left_Hand)/154/154/1:Px16;      [154 Hardened Shield]
!!DO(AI_Left_Hand)/157/157/1:Px16;      [157 Crimson Shield of Retribution]
!!HEx16:A-15; !!HEx16:A4/15;
!!en;

!!HEx16:A2/16/?y10/?y11;                [16 Targ of the Rampaging Ogre]
!!if&y10=1/y11=0;
!!DO(AI_Left_Hand)/13/15/1:Px16;
!!DO(AI_Left_Hand)/17/18/1:Px16;
!!DO(AI_Left_Hand)/34/34/1:Px16;        [34 Lion's Shield of Courage]
!!DO(AI_Left_Hand)/39/39/1:Px16;        [39 Dragon Scale Shield]
!!DO(AI_Left_Hand)/154/154/1:Px16;      [154 Hardened Shield]
!!DO(AI_Left_Hand)/157/157/1:Px16;      [157 Crimson Shield of Retribution]
!!HEx16:A-16; !!HEx16:A4/16;
!!en;

!!HEx16:A2/17/?y10/?y11;                [17 Shield of the Damned]
!!if&y10=1/y11=0;
!!DO(AI_Left_Hand)/13/16/1:Px16;
!!DO(AI_Left_Hand)/18/18/1:Px16;
!!DO(AI_Left_Hand)/34/34/1:Px16;        [34 Lion's Shield of Courage]
!!DO(AI_Left_Hand)/39/39/1:Px16;        [39 Dragon Scale Shield]
!!DO(AI_Left_Hand)/154/154/1:Px16;      [154 Hardened Shield]
!!DO(AI_Left_Hand)/157/157/1:Px16;      [157 Crimson Shield of Retribution]
!!HEx16:A-17; !!HEx16:A4/17;
!!en;

!!HEx16:A2/39/?y10/?y11;                [39 Dragon Scale Shield]
!!if&y10=1/y11=0;
!!DO(AI_Left_Hand)/13/18/1:Px16;
!!DO(AI_Left_Hand)/34/34/1:Px16;        [34 Lion's Shield of Courage]
!!DO(AI_Left_Hand)/154/154/1:Px16;      [154 Hardened Shield]
!!DO(AI_Left_Hand)/157/157/1:Px16;      [157 Crimson Shield of Retribution]
!!HEx16:A-39; !!HEx16:A4/39;
!!en;

!!HEx16:A2/34/?y10/?y11;                [34 Lion's Shield of Courage]
!!if&y10=1/y11=0;
!!DO(AI_Left_Hand)/13/18/1:Px16;
!!DO(AI_Left_Hand)/39/39/1:Px16;        [39 Dragon Scale Shield]
!!DO(AI_Left_Hand)/154/154/1:Px16;      [154 Hardened Shield]
!!DO(AI_Left_Hand)/157/157/1:Px16;      [157 Crimson Shield of Retribution]
!!HEx16:A-34; !!HEx16:A4/34;
!!en;

!!HEx16:A2/18/?y10/?y11;                [18 Sentinel's Shield]
!!if&y10=1/y11=0;
!!DO(AI_Left_Hand)/13/17/1:Px16;
!!DO(AI_Left_Hand)/34/34/1:Px16;        [34 Lion's Shield of Courage]
!!DO(AI_Left_Hand)/39/39/1:Px16;        [39 Dragon Scale Shield]
!!DO(AI_Left_Hand)/154/154/1:Px16;      [154 Hardened Shield]
!!DO(AI_Left_Hand)/157/157/1:Px16;      [157 Crimson Shield of Retribution]
!!HEx16:A-18; !!HEx16:A4/18;
!!en;


********************************************************************************
Head Slot:
(11)

19 Helm of the Alabaster Unicorn
20 Skull Helmet
21 Helm of Chaos
22 Crown of the Supreme Magi
23 Hellstorm Helmet
24 Thunder Helmet
36 Helm of Heavenly Enlightenment
44 Crown of Dragontooth
123 Sea Captain's Hat
124 Spellbinder's Hat
149 Helm of Immortality (not considered)

!!HEx16:A2/20/?y10/?y11;                [20 Skull Helmet]
!!if&y10=1/y11=0;
!!DO(AI_Head)/19/19/1:Px16;             [Artifact 19-24]
!!DO(AI_Head)/21/24/1:Px16;             [36 Helm of Heavenly Enlightenment]
!!DO(AI_Head)/123/124/1:Px16;           [124 Spellbinder's Hat and 123 Sea Captain's Hat]
!!DO(AI_Head)/149/149/1:Px16;           [149 Helm of Immortality]
!!HEx16:A-20; !!HEx16:A4/20;
!!en;

!!HEx16:A2/21/?y10/?y11;                [21 Helm of Chaos]
!!if&y10=1/y11=0;
!!DO(AI_Head)/20/20/1:Px16;             [Artifact 19-24]
!!DO(AI_Head)/22/24/1:Px16;             [36 Helm of Heavenly Enlightenment]
!!DO(AI_Head)/123/124/1:Px16;           [124 Spellbinder's Hat and 123 Sea Captain's Hat]
!!DO(AI_Head)/149/149/1:Px16;           [149 Helm of Immortality]
!!HEx16:A-21; !!HEx16:A4/21;
!!en;

!!HEx16:A2/22/?y10/?y11;                [22 Crown of the Supreme Magi]
!!if&y10=1/y11=0;
!!DO(AI_Head)/19/21/1:Px16;
!!DO(AI_Head)/23/24/1:Px16;
!!DO(AI_Head)/36/36/1:Px16;             [36 Helm of Heavenly Enlightenment]
!!DO(AI_Head)/123/124/1:Px16;           [124 Spellbinder's Hat and 123 Sea Captain's Hat]
!!DO(AI_Head)/149/149/1:Px16;           [149 Helm of Immortality]
!!HEx16:A-22; !!HEx16:A4/22;
!!en;

!!HEx16:A2/23/?y10/?y11;                [23 Hellstorm Helmet]
!!if&y10=1/y11=0;
!!DO(AI_Head)/19/22/1:Px16;             [Artifact 19-24]
!!DO(AI_Head)/24/24/1:Px16;
!!DO(AI_Head)/36/36/1:Px16;             [36 Helm of Heavenly Enlightenment]
!!DO(AI_Head)/123/124/1:Px16;           [124 Spellbinder's Hat and 123 Sea Captain's Hat]
!!DO(AI_Head)/149/149/1:Px16;           [149 Helm of Immortality]
!!HEx16:A-23; !!HEx16:A4/23;
!!en;

!!HEx16:A2/44/?y10/?y11;                [44 Crown of Dragontooth]
!!if&y10=1/y11=0;
!!DO(AI_Head)/19/24/1:Px16;             [Artifact 19-24]
!!DO(AI_Head)/36/36/1:Px16;             [36 Helm of Heavenly Enlightenment]
!!DO(AI_Head)/123/124/1:Px16;           [124 Spellbinder's Hat and 123 Sea Captain's Hat]
!!DO(AI_Head)/149/149/1:Px16;           [149 Helm of Immortality]
!!HEx16:A-44; !!HEx16:A4/44;
!!en;

!!HEx16:A2/24/?y10/?y11;                [24 Thunder Helmet]
!!HEx16:A2/0/?y12/?y13;                 [Spell Book]
!!if&y10=1/y11=0/y13=1;                 [If in backpack and Hero has Spellbook]
!!DO(AI_Head)/19/23/1:Px16;
!!DO(AI_Head)/36/36/1:Px16;             [36 Helm of Heavenly Enlightenment]
!!DO(AI_Head)/44/44/1:Px16;             [44 Crown of Dragontooth]
!!DO(AI_Head)/123/124/1:Px16;           [124 Spellbinder's Hat and 123 Sea Captain's Hat]
!!DO(AI_Head)/149/149/1:Px16;           [149 Helm of Immortality]
!!HEx16:A-24; !!HEx16:A4/24;
!!en;

!!HEx16:A2/124/?y10/?y11;               [124 Spellbinder's Hat]
!!HEx16:A2/0/?y12/?y13;                 [Spell Book]
!!if&y10=1/y11=0/y13=1;                 [If in backpack and Hero has Spellbook]
!!DO(AI_Head)/19/24/1:Px16;
!!DO(AI_Head)/36/36/1:Px16;             [36 Helm of Heavenly Enlightenment]
!!DO(AI_Head)/44/44/1:Px16;             [44 Crown of Dragontooth]
!!DO(AI_Head)/149/149/1:Px16;           [149 Helm of Immortality]
!!HEx16:A-124; !!HEx16:A4/124;
!!en;

!!HEx16:A2/36/?y10/?y11;                [36 Helm of Heavenly Enlightenment]
!!if&y10=1/y11=0;
!!DO(AI_Head)/19/24/1:Px16;             [Artifact 19-24]
!!DO(AI_Head)/44/44/1:Px16;             [44 Crown of Dragontooth]
!!DO(AI_Head)/123/124/1:Px16;           [124 Spellbinder's Hat and 123 Sea Captain's Hat]
!!DO(AI_Head)/149/149/1:Px16;           [149 Helm of Immortality]
!!HEx16:A-36; !!HEx16:A4/36;
!!en;


********************************************************************************
Torso Slot:
(9)

25 Breastplate of Petrified Wood
26 Rib Cage
27 Scales of the Greater Basilisk
28 Tunic of the Cyclops King
29 Breastplate of Brimstone
31 Armor of Wonder
40 Dragon Scale Armor
30 Titan's Cuirass
147 Mithril Mail (Not considered)
132 Armor of the Damned (Not considered)

!!HEx16:A2/26/?y10/?y11;                [26 Rib Cage]
!!HEx16:A2/0/?y12/?y13;                 [Spell Book]
!!if&y10=1/y11=0/y13=1;                 [If in backpack and Hero has Spellbook]
!!DO(AI_Torso)/25/25/1:Px16;
!!DO(AI_Torso)/27/31/1:Px16;
!!DO(AI_Torso)/40/40/1:Px16;
!!DO(AI_Torso)/147/147/1:Px16;
!!HEx16:A-26; !!HEx16:A4/26;
!!en;

!!HEx16:A2/27/?y10/?y11;                [27 Scales of the Greater Basilisk]
!!HEx16:A2/0/?y12/?y13;                 [Spell Book]
!!if&y10=1/y11=0/y13=1;                 [If in backpack and Hero has Spellbook]
!!DO(AI_Torso)/25/26/1:Px16;
!!DO(AI_Torso)/28/31/1:Px16;
!!DO(AI_Torso)/40/40/1:Px16;
!!DO(AI_Torso)/147/147/1:Px16;
!!HEx16:A-27; !!HEx16:A4/27;
!!en;

!!HEx16:A2/28/?y10/?y11;                [28 Tunic of the Cyclops King]
!!HEx16:A2/0/?y12/?y13;                 [Spell Book]
!!if&y10=1/y11=0/y13=1;                 [If in backpack and Hero has Spellbook]
!!DO(AI_Torso)/25/27/1:Px16;            [Artifact 25-28]
!!DO(AI_Torso)/29/31/1:Px16;            [Artifact 30-31]
!!DO(AI_Torso)/40/40/1:Px16;
!!DO(AI_Torso)/147/147/1:Px16;
!!HEx16:A-28; !!HEx16:A4/28;
!!en;

!!HEx16:A2/31/?y10/?y11;                [31 Armor of Wonder]
!!if&y10=1/y11=0;
!!DO(AI_Torso)/25/30/1:Px16;            [Artifact 25-28]
!!DO(AI_Torso)/40/40/1:Px16;
!!DO(AI_Torso)/147/147/1:Px16;
!!HEx16:A-31; !!HEx16:A4/31;
!!en;

!!HEx16:A2/29/?y10/?y11;                [29 Breastplate of Brimstone]
!!HEx16:A2/0/?y12/?y13;                 [Spell Book]
!!if&y10=1/y11=0/y13=1;                 [If in backpack and Hero has Spellbook]
!!DO(AI_Torso)/25/28/1:Px16;            [Artifact 25-28]
!!DO(AI_Torso)/30/31/1:Px16;            [Artifact 30-31]
!!DO(AI_Torso)/40/40/1:Px16;
!!DO(AI_Torso)/147/147/1:Px16;
!!HEx16:A-29; !!HEx16:A4/29;
!!en;

!!HEx16:A2/40/?y10/?y11;                [40 Dragon Scale Armor]
!!if&y10=1/y11=0;
!!DO(AI_Torso)/25/31/1:Px16;            [Artifact 25-31]
!!DO(AI_Torso)/147/147/1:Px16;
!!HEx16:A-40; !!HEx16:A4/40;
!!en;


!!HEx16:A2/30/?y10/?y11;                [30 Titan's Cuirass]
!!HEx16:A2/0/?y12/?y13;                 [Spell Book]
!!if&y10=1/y11=0/y13=1;                 [If in backpack and Hero has Spellbook]
!!DO(AI_Torso)/25/29/1:Px16;
!!DO(AI_Torso)/31/31/1:Px16;
!!DO(AI_Torso)/40/40/1:Px16;
!!DO(AI_Torso)/147/147/1:Px16;
!!HEx16:A-30; !!HEx16:A4/30;
!!en;


********************************************************************************
Shoulder Slot:
(9)

42 Dragon Wing Tabard
55 Vampire's Cowl
58 Surcoat of Counterpoise
68 Ambassador's Sash
72 Angel Wings
78 Cape of Conjuring
83 Recanter's Cloak
99 Cape of Velocity
109 Everflowing Crystal Cloak

130 Cloak of the Undead King (not considered)

!!HEx16:A2/42/?y10/?y11;                [42 Dragon Wing Tabard]
!!if&y10=1/y11=0;
!!FU(AI_Cloak):Px16/72;                 [72 Angel Wings]
!!FU(AI_Cloak):Px16/78;                 [78 Cape of Conjuring]
!!FU(AI_Cloak):Px16/55;                 [55 Vampire's Cowl]
!!FU(AI_Cloak):Px16/58;                 [58 Surcoat of Counterpoise]
!!FU(AI_Cloak):Px16/109;                [109 Everflowing Crystal Cloak]
!!FU(AI_Cloak):Px16/83;                 [83 Recanter's Cloak]
!!FU(AI_Cloak):Px16/68;                 [68 Ambassador's Sash]
!!FU(AI_Cloak):Px16/99;                 [99 Cape of Velocity]
!!HEx16:A-42; !!HEx16:A4/42;
!!en;

!!HEx16:A2/99/?y10/?y11;                [99 Cape of Velocity]
!!if&y10=1/y11=0;
!!FU(AI_Cloak):Px16/72;                 [72 Angel Wings]
!!FU(AI_Cloak):Px16/42;                 [42 Dragon Wing Tabard]
!!FU(AI_Cloak):Px16/78;                 [78 Cape of Conjuring]
!!FU(AI_Cloak):Px16/55;                 [55 Vampire's Cowl]
!!FU(AI_Cloak):Px16/58;                 [58 Surcoat of Counterpoise]
!!FU(AI_Cloak):Px16/109;                [109 Everflowing Crystal Cloak]
!!FU(AI_Cloak):Px16/83;                 [83 Recanter's Cloak]
!!FU(AI_Cloak):Px16/68;                 [68 Ambassador's Sash]
!!HEx16:A-99; !!HEx16:A4/99;
!!en;

!!HEx16:A2/72/?y10/?y11;                [72 Angel Wings]
!!if&y10=1/y11=0;
!!FU(AI_Cloak):Px16/99;                 [99 Cape of Velocity]
!!FU(AI_Cloak):Px16/42;                 [42 Dragon Wing Tabard]
!!FU(AI_Cloak):Px16/78;                 [78 Cape of Conjuring]
!!FU(AI_Cloak):Px16/55;                 [55 Vampire's Cowl]
!!FU(AI_Cloak):Px16/58;                 [58 Surcoat of Counterpoise]
!!FU(AI_Cloak):Px16/109;                [109 Everflowing Crystal Cloak]
!!FU(AI_Cloak):Px16/83;                 [83 Recanter's Cloak]
!!FU(AI_Cloak):Px16/68;                 [68 Ambassador's Sash]
!!HEx16:A-72; !!HEx16:A4/72;
!!en;


********************************************************************************
Boots Slot:
(7)

32 Sandals of the Saint
41 Dragonbone Greaves
56 Dead Man's Boots
59 Boots of Polarity
90 Boots of Levitation
98 Boots of Speed
151 Boots of Haste


!!HEx16:A2/32/?y10/?y11;                [32 Sandals of the Saint]
!!if&y10=1/y11=0;
!!FU(AI_Boots):Px16/56;                 [56 Dead Man's Boots]
!!FU(AI_Boots):Px16/59;                 [59 Boots of Polarity]
!!FU(AI_Boots):Px16/90;                 [90 Boots of Levitation]
!!FU(AI_Boots):Px16/98;                 [98 Boots of Speed]
!!FU(AI_Boots):Px16/41;                 [41 Dragonbone Greaves]
!!FU(AI_Boots):Px16/151;                [151 Boots of Haste]
!!HEx16:A-32; !!HEx16:A4/32;
!!en;


!!HEx16:A2/98/?y10/?y11;                [98 Boots of Speed]
!!if&y10=1/y11=0;
!!FU(AI_Boots):Px16/56;                 [56 Dead Man's Boots]
!!FU(AI_Boots):Px16/59;                 [59 Boots of Polarity]
!!FU(AI_Boots):Px16/90;                 [90 Boots of Levitation]
!!FU(AI_Boots):Px16/32;                 [32 Sandals of the Saint]
!!FU(AI_Boots):Px16/41;                 [41 Dragonbone Greaves]
!!FU(AI_Boots):Px16/151;                [151 Boots of Haste]
!!HEx16:A-98; !!HEx16:A4/98;
!!en;


********************************************************************************
Neck Slot:
(18)

33 Celestial Necklace of Bliss
43 Necklace of Dragonteeth
54 Amulet of the Undertaker
66 Statesman's Medal
71 Necklace of Ocean Guidance
76 Collar of Conjuring
97 Necklace of Swiftness
100 Pendant of Dispassion
101 Pendant of Second Sight
102 Pendant of Holiness
103 Pendant of Life
104 Pendant of Death
105 Pendant of Free Will
106 Pendant of Negativity
107 Pendant of Total Recall
108 Pendant of Courage
150 Pendant of Sorcery

!!HEx16:A2/43/?y10/?y11;                [43 Necklace of Dragonteeth]
!!HEx16:A2/0/?y12/?y13;                 [Spell Book]
!!if&y10=1/y11=0/y13=1;                 [If in backpack and Hero has Spellbook]
!!FU(AI_Neck):Px16/33;                  [33 Celestial Necklace of Bliss]
!!FU(AI_Neck):Px16/54;                  [54 Amulet of the Undertaker]
!!FU(AI_Neck):Px16/66;                  [66 Statesman's Medal]
!!FU(AI_Neck):Px16/71;                  [71 Necklace of Ocean Guidance]
!!FU(AI_Neck):Px16/76;                  [76 Collar of Conjuring]
!!FU(AI_Neck):Px16/97;                  [97 Necklace of Swiftness]
!!FU(AI_Neck):Px16/100;                 [100 Pendant of Dispassion]
!!FU(AI_Neck):Px16/101;                 [101 Pendant of Second Sight]
!!FU(AI_Neck):Px16/102;                 [102 Pendant of Holiness]
!!FU(AI_Neck):Px16/103;                 [103 Pendant of Life]
!!FU(AI_Neck):Px16/104;                 [104 Pendant of Death]
!!FU(AI_Neck):Px16/105;                 [105 Pendant of Free Will]
!!FU(AI_Neck):Px16/106;                 [106 Pendant of Negativity]
!!FU(AI_Neck):Px16/107;                 [107 Pendant of Total Recall]
!!FU(AI_Neck):Px16/108;                 [108 Pendant of Courage]
!!FU(AI_Neck):Px16/150;                 [150 Pendant of Sorcery]
!!HEx16:A-43; !!HEx16:A4/43;
!!en;

!!HEx16:A2/97/?y10/?y11;                [97 Necklace of Swiftness]
!!if&y10=1/y11=0;
!!FU(AI_Neck):Px16/33;                  [33 Celestial Necklace of Bliss]
!!FU(AI_Neck):Px16/54;                  [54 Amulet of the Undertaker]
!!FU(AI_Neck):Px16/43;                  [43 Necklace of Dragonteeth]
!!FU(AI_Neck):Px16/66;                  [66 Statesman's Medal]
!!FU(AI_Neck):Px16/71;                  [71 Necklace of Ocean Guidance]
!!FU(AI_Neck):Px16/76;                  [76 Collar of Conjuring]
!!FU(AI_Neck):Px16/100;                 [100 Pendant of Dispassion]
!!FU(AI_Neck):Px16/101;                 [101 Pendant of Second Sight]
!!FU(AI_Neck):Px16/102;                 [102 Pendant of Holiness]
!!FU(AI_Neck):Px16/103;                 [103 Pendant of Life]
!!FU(AI_Neck):Px16/104;                 [104 Pendant of Death]
!!FU(AI_Neck):Px16/105;                 [105 Pendant of Free Will]
!!FU(AI_Neck):Px16/106;                 [106 Pendant of Negativity]
!!FU(AI_Neck):Px16/107;                 [107 Pendant of Total Recall]
!!FU(AI_Neck):Px16/108;                 [108 Pendant of Courage]
!!FU(AI_Neck):Px16/150;                 [150 Pendant of Sorcery]
!!HEx16:A-97; !!HEx16:A4/97;
!!en;

!!HEx16:A2/33/?y10/?y11;                [33 Celestial Necklace of Bliss]
!!if&y10=1/y11=0;
!!FU(AI_Neck):Px16/54;                  [54 Amulet of the Undertaker]
!!FU(AI_Neck):Px16/43;                  [43 Necklace of Dragonteeth]
!!FU(AI_Neck):Px16/66;                  [66 Statesman's Medal]
!!FU(AI_Neck):Px16/71;                  [71 Necklace of Ocean Guidance]
!!FU(AI_Neck):Px16/76;                  [76 Collar of Conjuring]
!!FU(AI_Neck):Px16/97;                  [97 Necklace of Swiftness]
!!FU(AI_Neck):Px16/100;                 [100 Pendant of Dispassion]
!!FU(AI_Neck):Px16/101;                 [101 Pendant of Second Sight]
!!FU(AI_Neck):Px16/102;                 [102 Pendant of Holiness]
!!FU(AI_Neck):Px16/103;                 [103 Pendant of Life]
!!FU(AI_Neck):Px16/104;                 [104 Pendant of Death]
!!FU(AI_Neck):Px16/105;                 [105 Pendant of Free Will]
!!FU(AI_Neck):Px16/106;                 [106 Pendant of Negativity]
!!FU(AI_Neck):Px16/107;                 [107 Pendant of Total Recall]
!!FU(AI_Neck):Px16/108;                 [108 Pendant of Courage]
!!FU(AI_Neck):Px16/150;                 [150 Pendant of Sorcery]
!!HEx16:A-33; !!HEx16:A4/33;
!!en;

!!HEx16:A2/108/?y10/?y11;               [108 Pendant of Courage]
!!if&y10=1/y11=0;
!!FU(AI_Neck):Px16/33;                  [33 Celestial Necklace of Bliss]
!!FU(AI_Neck):Px16/54;                  [54 Amulet of the Undertaker]
!!FU(AI_Neck):Px16/43;                  [43 Necklace of Dragonteeth]
!!FU(AI_Neck):Px16/66;                  [66 Statesman's Medal]
!!FU(AI_Neck):Px16/71;                  [71 Necklace of Ocean Guidance]
!!FU(AI_Neck):Px16/76;                  [76 Collar of Conjuring]
!!FU(AI_Neck):Px16/97;                  [97 Necklace of Swiftness]
!!FU(AI_Neck):Px16/100;                 [100 Pendant of Dispassion]
!!FU(AI_Neck):Px16/101;                 [101 Pendant of Second Sight]
!!FU(AI_Neck):Px16/102;                 [102 Pendant of Holiness]
!!FU(AI_Neck):Px16/103;                 [103 Pendant of Life]
!!FU(AI_Neck):Px16/104;                 [104 Pendant of Death]
!!FU(AI_Neck):Px16/105;                 [105 Pendant of Free Will]
!!FU(AI_Neck):Px16/106;                 [106 Pendant of Negativity]
!!FU(AI_Neck):Px16/107;                 [107 Pendant of Total Recall]
!!FU(AI_Neck):Px16/150;                 [150 Pendant of Sorcery]
!!HEx16:A-108; !!HEx16:A4/108;
!!en;


********************************************************************************
Ring Slots:
(6 right ring  7 left ring)
*Useless Rings will just be put in Backpack

!!HEx16:A2/67/?y10/?y11;                [67 Diplomat's Ring]
!!HEx16&y10=1/y11=1:A-67 A67;           [;]
!!HEx16:A2/110/?y10/?y11;               [110 Ring of Infinite Gems]
!!HEx16&y10=1/y11=1:A-110 A110;         [;]
!!HEx16:A2/113/?y10/?y11;               [113 Eversmoking Ring of Sulfur]
!!HEx16&y10=1/y11=1:A-113 A113;         [;]


********************************************************************************
Misc Slots:
Slot 1-5
*Useless Misc-Artifacts will just be put in Backpack to make room for better artifacts

!!HEx16:A2/63/?y10/?y11;                [63  Bird of Perception]
!!HEx16&y10>=1/y11>=1:A-63 A63;
!!HEx16:A2/64/?y10/?y11;                [64  Stoic Watchman]
!!HEx16&y10>=1/y11>=1:A-64 A64;
!!HEx16:A2/65/?y10/?y11;                [65  Emblem of Cognizance]
!!HEx16&y10>=1/y11>=1:A-65 A65;
!!HEx16:A2/52/?y10/?y11;                [52  Speculum]
!!HEx16&y10>=1/y11>=1:A-52 A52;
!!HEx16:A2/53/?y10/?y11;                [53  Spyglass]
!!HEx16&y10>=1/y11>=1:A-53 A53;
!!HEx16:A2/84/?y10/?y11;                [84 Spirit of Oppression]
!!HEx16&y10>=1/y11>=1:A-84 A84;
!!HEx16:A2/85/?y10/?y11;                [85  Hourglass of the Evil Hour]
!!HEx16&y10>=1/y11>=1:A-85 A85;
!!HEx16:A2/111/?y10/?y11;               [111 Everpouring Vial of Mercury]
!!HEx16&y10>=1/y11>=1:A-111 A111;
!!HEx16:A2/112/?y10/?y11;               [112 Inexhaustible Cart of Ore]
!!HEx16&y10>=1/y11>=1:A-112 A112;
!!HEx16:A2/114/?y10/?y11;               [114 Inexhaustible Cart of Lumber]
!!HEx16&y10>=1/y11>=1:A-114 A114;
!!HEx16:A2/115/?y10/?y11;               [115 Endless Sack of Gold]
!!HEx16&y10>=1/y11>=1:A-115 A115;
!!HEx16:A2/116/?y10/?y11;               [116 Endless Bag of Gold]
!!HEx16&y10>=1/y11>=1:A-116 A116;
!!HEx16:A2/117/?y10/?y11;               [117 Endless Purse of Gold]
!!HEx16&y10>=1/y11>=1:A-117 A117;

Misc Slots:
Slot 1-5
*Misc-Artifacts that are equipped double will be reduced to 1 to make more place for better artifacts
46  Clover of Fortune
47  Cards of Prophecy
48  Ladybird of Luck
49  Badge of Courage
50  Crest of Valor
51  Glyph of Gallantry
60  Bow of Elven Cherrywood
61  Bowstring of the Unicorn's Mane
62  Angel Feather Arrows
73  Charm of Mana
74  Talisman of Mana
75  Mystic Orb of Mana
79  Orb of the Firmament
80  Orb of Silt
81  Orb of Tempestuous Fire
82  Orb of Driving Rain
86  Tome of Fire Magic
87  Tome of Air Magic
88  Tome of Water Magic
89  Tome of Earth Magic
91  Golden Bow
92  Sphere of Permanence
93  Orb of Vulnerability
126 Orb of Inhibition
127 Vial of Dragon Blood

!!HEx16:A2/46/?y10/?y11;                [46  Clover of Fortune]
!!HEx16&y10>=1/y11>1:A-46 A4/46;
!!HEx16:A2/47/?y10/?y11;                [47  Cards of Prophecy]
!!HEx16&y10>=1/y11>1:A-47 A4/47;
!!HEx16:A2/48/?y10/?y11;                [48  Ladybird of Luck]
!!HEx16&y10>=1/y11>1:A-48 A4/48;
!!HEx16:A2/49/?y10/?y11;                [49  Badge of Courage]
!!HEx16&y10>=1/y11>1:A-49 A4/49;
!!HEx16:A2/50/?y10/?y11;                [50  Crest of Valor]
!!HEx16&y10>=1/y11>1:A-50 A4/50;
!!HEx16:A2/51/?y10/?y11;                [51  Glyph of Gallantry]
!!HEx16&y10>=1/y11>1:A-51 A4/51;
!!HEx16:A2/60/?y10/?y11;                [60  Bow of Elven Cherrywood]
!!HEx16&y10>=1/y11>1:A-60 A4/60;
!!HEx16:A2/61/?y10/?y11;                [61  Bowstring of the Unicorn's Mane]
!!HEx16&y10>=1/y11>1:A-61 A4/61;
!!HEx16:A2/62/?y10/?y11;                [62  Angel Feather Arrows]
!!HEx16&y10>=1/y11>1:A-62 A4/62;
!!HEx16:A2/73/?y10/?y11;                [73  Charm of Mana]
!!HEx16&y10>=1/y11>1:A-73 A4/73;
!!HEx16:A2/74/?y10/?y11;                [74  Talisman of Mana]
!!HEx16&y10>=1/y11>1:A-74 A4/74;
!!HEx16:A2/75/?y10/?y11;                [75  Mystic Orb of Mana]
!!HEx16&y10>=1/y11>1:A-75 A4/75;
!!HEx16:A2/79/?y10/?y11;                [79  Orb of the Firmament]
!!HEx16&y10>=1/y11>1:A-79 A4/79;
!!HEx16:A2/80/?y10/?y11;                [80  Orb of Silt]
!!HEx16&y10>=1/y11>1:A-80 A4/80;
!!HEx16:A2/81/?y10/?y11;                [81  Orb of Tempestuous Fire]
!!HEx16&y10>=1/y11>1:A-81 A4/81;
!!HEx16:A2/82/?y10/?y11;                [82  Orb of Driving Rain]
!!HEx16&y10>=1/y11>1:A-82 A4/82;
!!HEx16:A2/86/?y10/?y11;                [86  Tome of Fire Magic]
!!HEx16&y10>=1/y11>1:A-86 A4/86;
!!HEx16:A2/87/?y10/?y11;                [87  Tome of Air Magic]
!!HEx16&y10>=1/y11>1:A-87 A4/87;
!!HEx16:A2/88/?y10/?y11;                [88  Tome of Water Magic]
!!HEx16&y10>=1/y11>1:A-88 A4/88;
!!HEx16:A2/89/?y10/?y11;                [89  Tome of Earth Magic]
!!HEx16&y10>=1/y11>1:A-89 A4/89;
!!HEx16:A2/91/?y10/?y11;                [91  Golden Bow]
!!HEx16&y10>=1/y11>1:A-91 A4/91;
!!HEx16:A2/92/?y10/?y11;                [92  Sphere of Permanence ]
!!HEx16&y10>=1/y11>1:A-92 A4/92;
!!HEx16:A2/93/?y10/?y11;                [93  Orb of Vulnerability]
!!HEx16&y10>=1/y11>1:A-93 A4/93;
!!HEx16:A2/126/?y10/?y11;               [126 Orb of Inhibition]
!!HEx16&y10>=1/y11>1:A-126 A4/126;
!!HEx16:A2/127/?y10/?y11;               [127 Vial of Dragon Blood]
!!HEx16&y10>=1/y11>1:A-127 A4/127;


********************************************************************************
*Functions Section*
x1=Hero Number, x2 or x16=Artifacts Numbers,

!?FU(AI_Right_Hand);
!!HEx1:A2/x16/?y10/?y11;                [Check for artifacts]
!!VRx16:*-1;                            [Make negative, because -x16 doesnt work]
!!HEx1&y10>=1/y11=1:Ax16;               [Remove all artifacts of that type if equipped]
!!VRx16:*-1;                            [Make positive again]
!!HEx1&y10>=1/y11=1:Ax16;               [Place all artifacts of that type back in the backpack]

!?FU(AI_Left_Hand);
!!HEx1:A2/x16/?y10/?y11;
!!VRx16:*-1;
!!HEx1&y10>=1/y11=1:Ax16;
!!VRx16:*-1;
!!HEx1&y10>=1/y11=1:Ax16;

!?FU(AI_Head);
!!HEx1:A2/x16/?y10/?y11;
!!VRx16:*-1;
!!HEx1&y10>=1/y11=1:Ax16;
!!VRx16:*-1;
!!HEx1&y10>=1/y11=1:Ax16;

!?FU(AI_Torso);
!!HEx1:A2/x16/?y10/?y11;
!!VRx16:*-1;
!!HEx1&y10>=1/y11=1:Ax16;
!!VRx16:*-1;
!!HEx1&y10>=1/y11=1:Ax16;

!?FU(AI_Cloak);
!!HEx1:A2/x2/?y10/?y11;
!!VRx2:*-1;
!!HEx1&y10>=1/y11=1:Ax2;
!!VRx2:*-1;
!!HEx1&y10>=1/y11=1:Ax2;

!?FU(AI_Boots);
!!HEx1:A2/x2/?y10/?y11;
!!VRx2:*-1;
!!HEx1&y10>=1/y11=1:Ax2;
!!VRx2:*-1;
!!HEx1&y10>=1/y11=1:Ax2;

!?FU(AI_Neck);
!!HEx1:A2/x2/?y10/?y11;
!!VRx2:*-1;
!!HEx1&y10>=1/y11=1:Ax2;
!!VRx2:*-1;
!!HEx1&y10>=1/y11=1:Ax2;


****************************************************************************************************
*AI Heroes can never have more than 100/225 of all primary skills
!?FU(OnEveryDay)&i^timerOnce^=1/i^timerDay^>1;
!!UN:C4342141/1/?(value:y);             [Check if display primary skills over 99 is enabled]
!!SN:F^PluginExists^/^prima^;           [Check if Prima.dll is enabled]

; Set up the upper and lower limit for fixing AI's Primary Skills
; The upper limit is slightly lower than the max PS in order to work with Titan's Thunder (possible to get negative PS in a normal play through)
; If display primary skills over 99.bin is enabeld, it overrides prima and set max primary skills at 126
!!VR(upperLimit:y):S120;
!!VR(upperLimit)&(value)<>127/v1:S245;
!!VR(lowerLimit:y):S(upperLimit) -20;

!!re i/(HERO_FIRST)/(HERO_LAST_WOG);
  !!HEi:O?(owner:y);                    [get owner of this hero]

  !!if&(owner)>(NO_OWNER);
    !!OW:I(owner)/?(isAi:y);            [AI/Human]

    !!if&(isAi);                        [if it is owner an is AI, script will not run for human]
      !!HEi:F?(atk:y)/?(def:y)/?(pwr:y)/?(knl:y); [Check Primary skill of any hero]
      !!HEi&(atk)>(lowerLimit)/(atk)<=(upperLimit):F(lowerLimit)/d/d/d; [Attack]
      !!HEi&(def)>(lowerLimit)/(def)<=(upperLimit):Fd/(lowerLimit)/d/d; [Defence]
      !!HEi&(pwr)>(lowerLimit)/(pwr)<=(upperLimit):Fd/d/(lowerLimit)/d; [Power]
      !!HEi&(knl)>(lowerLimit)/(knl)<=(upperLimit):Fd/d/d/(lowerLimit); [Knowledge]
    !!en;
  !!en;
!!en;


********************************************************************************

*** Generate Random Spell Number by Archer30 ***

!?FU(Diff_GenerateRandomSpell);
!#VA(minLevel:x) (maxLevel:x) (hero:x) (spell:x);

!!VR(spell):S(NO_SPELL);
!!FU(NewIntArray):P?(spellList:y);

!!re i/(SPELL_FIRST)/(SPELL_LAST_WOG);
  !!HE(hero):M=i/1;

  !!if&-1;
    !!SSi:L?(level:y);

    !!if&(level)>=(minLevel)/(level)<=(maxLevel);
      !!UN:J0/i/?(isDisabled:y);
      !!FU(Array_Push)&(isDisabled)<>(TRUE):P(spellList)/i;
    !!en;
  !!en;
!!en;

!!SN:M(spellList)/?(size:y);

!!if&(size)>0;
  !!VR(random:y):R0/1/(size) -1;
  !!SN:M(spellList)/(random)/?(spell);
!!en;

--------------------------------------------------------------------------------



                      Stack Experience Rebalance Mod




--------------------------------------------------------------------------------

** Author        : modified by Perry 2020
** Name          : Experience without abilities

+   Add 43
=   Set 61
%   Percent 37 


A   Attack  65
B   Block   66
C   Reduce Casting Cost 67
D   Defense 68
E   Death Stare 69
F   Fear    70
G   Santa Gremlin Guards    71
H   Health  72
J   Cast Advanced version of Spell Before Attack    74
K   Cast Advanced version of Spell After Attack 75
L   Deflect [Bm/1/76/n/Xo/X1/... (n+1)% chance to block Xlevel% damage] 76
M   Maximum Damage  77
O   Number of Shots (Ammo)  79
P   Number of Spells (Castings) 80
R   Retaliations    82
S   Speed   83
U   Multiple Summon 85
W   Magic Resistance    87
a   Cast Spell After Melee Attack (not shoot)   97
b   Reduce Target Defense   98
c   Cast Non-Direct Damage Spell After Attack   99
d   Defending Bonus 100
e   Double Damage Death Blow    101
f   Flagged Abilities   102
g   Golem Style Damage Resistance   103
h   Hatred Damage to creature   104
i   No Range Penalty    105
j   Cast Basic version of Spell Before Attack   106
k   Cast Basic version of Spell After Attack    107
l   Summon Clone    108
m   Minimum Damage  109
o   No Obstacle Penalty 111
p   Cast Spell Before Attack    112
r   Regeneration [Bm/1/114/n/X0/X1 ... n% chance of Xlevel Hit Points]  114
s   Enchant with Spell  115
u   Single Summon   117
w   Spell Immunity  119


****************************************************************************************************
*At first day run trough all options
- First Set new Stack Experience Stats for WoG and TUM creatures
- Second deletes all experience lines
- Third sets new experience abilities

!?FU(OnGameEnter);

!!SN:W^Stack_Exp_Rebalance_On^/?y99; !!FU&y99=0:E; [Check if option was activated and Exit if not]

!!SN:W^Exp_WoG_Stats^/?y97;             [Check option for WoG rebalanced stats]
!!SN:W^Exp_WoG_Abilities^/?y96;         [Check option for WoG rebalanced abilities]
!!FU(Stack_Experience_Rebalance_Fkt):P0/196/y97/y96;

!!SN:W^Typhon_Third_Upgrade_Mod_Active^/?y90;
!!if&y90=1; 
    !!SN:W^Exp_TUM_Stats^/?y97;         [Check option for TUM rebalanced stats]
    !!SN:W^Exp_TUM_Abilities^/?y96;     [Check option for TUM rebalanced abilities]
    !!FU(GetMaxMonsterId):P?y1;         [Get maximum creature ID]
    !!FU(Stack_Experience_Rebalance_Fkt):P197/y1/y97/y96;

    !!SN:W^Typhon_Third_Upgrade_Mod_Active^/?y98; 
    !!FU(Set_Monster_Special_Text)&y98=1/y96=1:P; [add changed specialty text if option is enabled]
!!en;

!!SN:W^Typhon_Third_Upgrade_Mod_Active^/?y99; !!FU&y99=0:E; [Check for Third Upgrade Mod]


****************************************************************************************************
*Castle*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA197:B6/1/76/29/0/3/6/9/12/15/18/21/24/27/30; [Royal Helbardiers have 30% chance to Deflect 30% of damage]

    !!EA198:B6/1/98/61/0/2/4/6/8/10/12/14/16/20/25; [Marksmen Reduce 25% defense]
    !!EA198:B7/1/111/43/0/0/0/0/0/0/0/0/0/0/1; [Marksmen no Obstacle Penalty]

    !!EA199:B6/1/76/49/0/3/6/9/12/15/18/21/24/27/30; [Griffins 30% chance to Deflect 50% of damage]

    !!EA291:B6/1/115/48/0/0/0/1/1/1/2/2/2/2/3; [Inquisitor Has Expert Prayer cast on them]

    !!EA320:B6/1/119/112/0/0/0/0/0/1/1/1/1/1/1; [Zelots Iron Will]
    !!EA320:B7/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Zelots No Distance Penalty]

    !!EA201:B6/1/115/27/0/0/0/1/1/1/2/2/2/2/3; [Champions have Expert Shield Cast on them]
    !!EA201:B7/1/102/102/0/0/0/0/0/0/0/0/0/0/1; [Champions are Fearless]

    !!EA202:B6/1/80/43/0/0/0/0/0/0/0/0/0/0/1; [Angels Add One Cast at level 10 for S.Angels]

    !!EA269:B6/1/115/48/0/0/0/1/1/1/2/2/2/2/3; [Templar Has Expert Prayer cast on them]

    !!EA278:B6/1/115/48/0/0/0/1/1/1/2/2/2/2/3; [Paladin Has Expert Prayer cast on them]
!!en;

*****************************************************
*Rampart*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA293:B6/1/102/99/0/0/0/0/0/0/0/0/0/0/1; [Cantaure Generals get Champion Charge ability]

    !!EA203:B6/1/115/46/0/0/0/1/1/1/2/2/2/2/3; [Dwarves have Expert Stone Skin on them]
    !!EA203:B7/1/87/43/0/2/4/6/8/10/12/14/16/18/20; [Dwarves have +20% extra Magic Resistance at level 10]

    !!EA256:B6/1/115/44/0/0/0/1/1/1/2/2/2/2/3; [Elves get Expert Precision]
    !!EA256:B7/1/98/61/0/2/4/6/8/10/12/14/16/18/20; [Elves reduce 20% defense]

    !!EA204:B6/1/115/49/0/0/0/1/1/1/2/2/2/2/3; [Pegasi have Mirth cast on them 49 Mirth]
    !!EA204:B7/1/119/51/0/0/0/1/1/1/2/2/2/2/3; [Pegasi are immune to hostle level 1-3 spells]

    !!EA205:B6/1/117/22/0/4/8/12/16/20/24/28/32/36/40; [Dendriods Summon Dendroids ]
    !!EA205:B7/1/98/61/0/2/4/6/8/10/12/14/16/18/20; [Dendriods reduce defense]
    !!EA205:B8/1/119/69/0/0/0/0/0/0/0/1/1/1/1; [Dendriods Give Immunity to Earth Spells]

    !!EA206:B6/1/112/37/0/3/6/9/12/15/18/21/24/27/30; [Unicorns Cast Cure]
    !!EA206:B7/1/97/62/0/2/4/6/8/10/12/14/16/18/20; [Unicorns get 20% +20% at ACE chance to Blind]

    !!EA207:B6/1/76/99/0/5/10/15/20/25/30/35/40/45/50; [Pure Diamond Dragon Deflects 50% of Damage at level 10]

    !!EA270:B6/1/115/46/0/0/0/1/1/1/2/2/2/2/3; [Dryad have Expert Stone Skin on them]
    !!EA270:B7/1/119/69/0/0/0/0/0/0/0/1/1/1/1; [Dryad Give Immunity to Earth Spells]

    !!EA279:B6/1/115/46/0/0/0/1/1/1/2/2/2/2/3; [Oak have Expert Stone Skin on them]
    !!EA279:B7/1/119/69/0/0/0/0/0/0/0/1/1/1/1; [Oak Dryad Give Immunity to Earth Spells]
!!en;

*****************************************************
*Tower*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA255:B7/1/72/37/0/15/25/35/45/50/55/60/65/70/75; [GrandMaster Gremlins get extra max Health +25%]
    !!EA255:B6/1/115/51/0/0/0/1/1/1/2/2/2/3/3; [GrandMaster Gremlins Have expert Fortune cast on them]
    
    !!EA208:B6/1/115/46/0/0/0/1/1/1/2/2/2/3/5; [Marble Gargoyles have Mass (5) Expert Stone Skin on them]

    !!EA209:B6/1/99/47/0/15/25/35/45/50/55/60/65/70/75; [Golems cast Destruction Ray on attack]
    !!EA209:B7/1/82/43/0/0/0/0/0/0/0/0/0/0/1; [Golems have one aditional Retaliations]

    !!EA257:B6/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Mages get no Range Penalty]

    !!EA210:B6/1/72/37/0/15/25/35/45/50/55/60/65/70/75; [Genies get extra max Health +25%]
    !!EA210:B7/1/115/41/0/0/0/0/0/1/1/1/2/2/3; [Genies get maximum damage with Bless cast]

    !!EA211:B6/1/101/43/0/3/6/9/12/15/18/21/24/27/30; [Naga chance to Death Blow 30%]

    !!EA212:B6/1/112/57/0/3/6/9/12/15/18/21/24/27/30; [Zeuss Magican May Cast Titans Thunder(57) Before Attack]

    !!EA271:B6/1/82/43/0/0/0/0/0/0/0/0/0/0/1; [Drake Golem have one aditional Retaliations]
    !!EA271:B7/1/87/43/0/5/10/15/20/25/30/35/40/45/50; [Drake Golem have +50% extra Magic Resistance at level 10]

    !!EA280:B6/1/82/43/0/0/0/0/0/0/0/0/0/0/1; [Dragon Golem have one aditional Retaliations]]
    !!EA280:B7/1/87/43/0/5/10/15/20/25/30/35/40/45/50; [Dragon Golem have +50% extra Magic Resistance at level 10]
!!en;

*****************************************************
*Inferno*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA213:B6/1/115/51/0/0/0/1/1/1/2/2/2/3/5; [Imps Hellish Plaque have Mass (5) Fortune at ACE]

    !!EA214:B6/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Magogs No Distance Penalty]
    !!EA214:B7/1/112/22/0/5/10/15/20/25/30/35/40/45/50; [Magogs Cast Inferno after attack 50% chance]

    !!EA215:B6/1/75/73/0/15/25/35/45/50/55/60/65/70/75; [Cerberus have increased chance to cast Desease after attack]

    !!EA216:B6/1/119/54/1/1/1/1/1/1/1/1/1/1/1; [Demons get nothing well imune to level 1 spells]

    !!EA217:B6/1/117/48/0/4/8/12/16/20/24/28/32/36/40; [Pit lords summon Demons]
    
    !!EA218:B6/1/102/82/0/0/0/0/0/0/0/0/0/0/1; [Efreets No Enemy Retaliation]
    
    !!EA219:B6/1/97/70/0/2/4/6/8/10/12/14/16/18/20; [Antichrist Increased chance to Petrification 20%+20%]

    !!EA272:B6/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Succubus gets No Distance Penalty]

    !!EA281:B6/1/115/31/0/1/1/1/1/1/2/2/2/2/3; [Lilim gets Protection from Fire]
    !!EA281:B7/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Lilim gets No Distance Penalty]
!!en;

*****************************************************
*Necropolis*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA220:B6/1/115/28/0/0/0/1/1/1/1/2/2/2/3; [Skeletons have Expert Air Shield cast on them]

    !!EA329:B6/1/99/42/0/15/25/35/45/50/55/60/65/70/75; [Ghoul Cast Curse]
    *!EA141:B7/1/103/37/0/3/6/9/12/15/18/21/24/27/30;   [Mummies get 30% Golem style Magic Resistance]
    *!EA141:B8/1/72/37/0/15/25/35/45/50/55/60/65/70/75; [Mummies get extra max Health +25%]

    !!EA261:B6/1/106/45/0/5/10/15/20/25/30/35/40/45/50; [Spectre has chance to cast before attack 45 Weakness]
    !!EA261:B7/1/106/52/0/5/10/15/20/25/30/35/40/45/50; [Spectre has chance to cast before attack 52 Misfortune]

    !!EA221:B6/1/75/50/0/5/10/15/20/25/30/35/40/45/50; [Vampires may cast Sorrow with attacks]

    !!EA222:B6/1/112/24/0/5/10/15/20/25/30/35/40/45/50; [Liches cast Death Ripple before attack]
    !!EA222:B7/1/80/43/0/0/1/1/1/1/2/2/2/2/3; [Liches gets additional casts]

    !!EA223:B6/1/101/43/0/3/6/9/12/15/18/21/24/27/30; [Death Knight chance to Death Blow 20%+30%]

    !!EA224:B6/1/115/28/0/0/0/1/1/1/1/1/1/1/2; [Red Bone Dragons have Advanced(2) Air Shield (28)]

    !!EA273:B6/1/114/100/0/15/25/35/45/50/55/60/65/70/75; [Werewolf has Regeneration]

    !!EA194:B6/1/114/100/0/15/25/35/45/50/55/60/65/70/75; [Dire Werewolf has Regeneration]
    !!EA194:B7/1/102/68/0/0/0/0/0/0/0/0/0/0/1; [Dire Werewolf has Double Strike]
!!en;

*****************************************************
*Dungeon*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA225:B6/1/75/54/0/5/10/15/20/25/30/35/40/45/50; [Troglodytes May cast Slow after attack 50% chance]

    !!EA226:B6/1/102/68/0/0/0/0/0/0/0/0/0/0/1; [Evil Eyes get Double Strike at Ace level]

    !!EA227:B6/1/99/42/0/5/10/15/20/25/30/35/40/45/50; [Harpies get 20+50% chance to cast Curse with attacks]
    !!EA227:B7/1/115/51/0/0/0/0/0/1/1/1/2/2/3; [Harpies have Expert Luck cast on them]

    !!EA228:B6/1/119/109/0/0/0/0/0/0/0/0/0/0/1; [Medusas are immune to hostile mind spells]

    !!EA229:B6/1/101/43/0/3/6/9/12/15/18/21/24/27/30; [Minotaures Get additional chance to Death Blow attack]

    !!EA230:B6/1/97/74/0/2/4/6/8/10/12/14/16/18/20; [Manticores get 20%+20% chance to paralyze]

    *!EA231:B6/1/119/101/0/0/0/0/0/0/0/0/0/0/1; [Black Draongs have can accept friendly casts and can Dispel with attacks]

    !!EA274:B6/1/119/109/0/0/0/0/0/0/0/0/0/0/1; [Illithids are immune to hostile mind spells at ACE level]

    !!EA282:B6/1/119/109/0/0/0/0/0/0/0/0/0/0/1; [Alhoons are immune to hostile mind spells at ACE level]
!!en;

*****************************************************
*Stronghold*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA232:B6/1/102/82/0/0/0/0/0/0/0/0/0/0/1; [Hobgoblins have No Enemy Retaliation]

    !!EA233:B6/1/102/99/0/0/0/0/0/0/0/0/0/0/1; [Wolf Raider get Champion Charge ability]

    !!EA234:B6/1/119/49/1/1/1/1/1/1/1/1/1/1/1; [Orcs get nothing well imune to level 1 spells (except for beneficial)]

    !!EA235:B6/1/76/49/0/3/6/9/12/15/18/21/24/27/30; [Ogers 30% chance to Deflect 50% of damage]

    !!EA236:B6/1/74/17/0/5/10/15/20/25/30/35/40/45/50; [Thunderbirds chance to cast before attack advanced]
    !!EA236:B7/1/75/17/0/5/10/15/20/25/30/35/40/45/50; [Thunderbirds chance to cast after attack advanced]
    *!EA236:B8/1/112/17/0/3/6/9/12/15/18/21/24/27/30; Thunderbirds chance to cast before attack at expert level

    !!EA237:B6/1/102/68/0/0/0/0/0/0/0/0/0/0/1; [Double Strike for Cyclops]

    !!EA238:B6/1/119/69/1/1/1/1/1/1/1/1/1/1/1; [Behemots are immune to all Earth Spells]
    !!EA238:B7/1/119/109/0/0/0/0/0/0/0/0/0/0/1; [Behemots are immune to hostile mind spells at ACE level]

    !!EA275:B6/1/103/37/0/5/10/15/20/25/30/35/40/45/50; [Coatls Give +50% Magic Damage Reduction Golem Style]

    !!EA283:B6/1/82/43/0/0/0/0/0/0/0/0/0/0/1; [QCoatls adds +1 Retaliation at ACE]
    !!EA283:B7/1/103/37/0/5/10/15/20/25/30/35/40/45/50; [QCoatls Give +50% Magic Damage Reduction Golem Style]
!!en;

*****************************************************
*Fortress*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA321:B6/1/115/49/0/0/0/1/1/1/1/2/2/2/3; [Gnoll Shamans have Expert Mirth cast on them]

    !!EA240:B6/1/99/71/0/5/10/15/20/25/30/35/40/45/50; [Elite Lizards have increased chance 30%+50% to cast Poison after attack]
    !!EA240:B7/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Elite Lizards have no Distance penalty]

    !!EA241:B6/1/102/65/0/0/0/0/0/0/0/0/0/0/1; [Dragonflies get Strike all Enemies around at ACE But should loose strikes and return]

    !!EA242:B6/1/97/70/0/2/4/6/8/10/12/14/16/18/20; [Lava Basilisks Increased chance to Petrification 20%+20%]

    !!EA244:B6/1/119/80/0/0/0/0/0/0/0/0/0/0/1; [Gorgons are immune to dispel]

    !!EA243:B6/1/102/82/0/0/0/0/0/0/0/0/0/0/1; [Wyverns No Enemy Retaliation]

    !!EA245:B6/1/102/73/0/0/0/0/0/0/0/0/0/0/1; [Hydra Immune to Fire 73]

    !!EA276:B6/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Troll Hags have no Distance penalty]

    !!EA284:B6/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Troll Witch have no Distance penalty]
!!en;

*****************************************************
*Conflux*
!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for rebalanced abilities]
!!if&y1=1;
    !!EA246:B6/1/87/43/0/3/6/9/12/15/18/21/24/27/30; [Sprites have +30% extra Magic Resistance at level 10]
    !!EA246:B7/1/72/37/0/10/20/30/40/50/60/70/80/90/100; [Sprites get extra max Health +50%]

    !!EA247:B6/1/105/43/0/0/0/0/0/0/0/0/0/0/1; [Hurricane Elementals have no Distance penalty]
    !!EA247:B7/1/115/30/0/0/0/1/1/1/2/2/2/3/5; [Lightning Elementals cast Mass Protection from Air]
    !!EA247:B8/1/119/76/1/1/1/1/1/1/1/1/1/1/1; [Lightning Elementals are immune to all Air Spells]

    !!EA248:B6/1/112/16/0/3/6/9/12/15/18/21/24/27/30; [Life/Ice Elementals chance to cast Ice Bolt before attack]
    !!EA248:B7/1/119/67/1/1/1/1/1/1/1/1/1/1/1; [Life/Ice Elementals are immune to all Water/Ice Spells]

    !!EA249:B6/1/72/37/0/15/25/35/45/50/55/60/65/70/75; [Fire Elementals get extra max Health +25%]
    !!EA249:B7/1/97/21/0/10/20/30/40/50/60/70/80/90/100; [Fire Elementals cast Fireball with attack]

    !!EA250:B6/1/117/113/0/3/6/9/12/15/18/21/24/27/30; [Earth Elements summon more Earth Elements]
    !!EA250:B7/1/119/69/1/1/1/1/1/1/1/1/1/1/1; [Earth Elementals are immune to all Earth Spells]

    !!EA251:B6/1/82/43/0/0/0/0/0/0/0/0/0/0/1; [Magic Elementals adds +1 Retaliation at ACE]

    !!EA252:B6/1/103/37/0/5/10/15/20/25/30/35/40/45/50; [Phoenixes Give +50% Magic Damage Reduction Golem Style]

    !!EA277:B6/1/102/68/0/0/0/0/0/0/0/0/0/0/1; [Triton gets Double Strike]

    !!EA285:B6/1/82/43/0/0/0/0/0/0/0/0/0/0/1; [Abyssal Triton adds +1 Retaliation at ACE]
    !!EA285:B7/1/102/68/0/0/0/0/0/0/0/0/0/0/1; [Abyssal Triton gets Double Strike]
!!en;
     

****************************************************************************************************
!?FU(Stack_Experience_Rebalance_Fkt);

!!re i/x1/x2:;                          [Starts from 0 to 196 to include only original monsters]
    !!if&x3=1;                          [run rebalanced stats active]
        !!EAi:B0/1/72/37/0/5/10/15/20/25/30/35/40/45/50; [Health]
        !!EAi:B1/1/65/43/0/1/2/3/4/5/6/7/8/9/10; [Attack]
        !!EAi:B2/1/68/43/0/1/2/3/4/5/6/7/8/9/10; [Defense]
        !!EAi:B3/1/109/37/0/3/6/9/12/15/18/21/24/27/30; [Min Damage]
        !!EAi:B4/1/77/37/0/3/6/9/12/15/18/21/24/27/30; [Max Damage]
        !!EAi:B5/1/83/37/0/2/4/6/8/10/12/14/16/18/20; [Speed]
    !!en;

    !!if&x4=1;                          [run if rebalanced abilities active]
        !!EAi&i<>231:B6/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [This will delete all Exp lines 6-19 after speed]
        !!EAi&i<>231:B7/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B8/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B9/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B10/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B11/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B12/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B13/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B14/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B15/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B16/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B17/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B18/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
        !!EAi:B19/0/d/d/d/d/d/d/d/d/d/d/d/d/d; [...]
    !!en;    
!!en:;


!?MR2;                                  [Magic Res Trigger]
*Give immunity for own troops from Stack Experience triggered spells*
!!FU:E;
!!BG:A?y1 N?y4;                         [Aktion in y1]
!!FU&y1=1:E;                            [Exit if Hero cast]
!!BMy4:T?y5 N?y6 I?y7;                  [Get Creature Type and Number of Creatures and side]
!!MR:S?y2 F?y3;                         [Spell in y2]
*!IF:M^Aktion is%Y1 Creature is%Y4 Type is%Y5 and Number is %Y6  Spell is %Y2 and damage %Y3 and side is%Y7^;
!!FU|y2=<15/y2>=27:E;                   [Exit if no mass spell]
*!IF:M^hello %Y2 and %Y1^;
*!FU|y5=145/y5=146/y5=147/y5=148/y5=149:E;
!!FU|y5=149:E;
!!if|y1=0/y1=6/y1=7:;  
    !!MR:N?y10;                         [Get casting stack]
    !!BMy10:I?y11;                      [Get stacks side]
    *!IF:M^Damage taking stack is%Y10 and Side is %Y11^;
    !!MR&y11=y7:F100;                   [Disable Magic damage for same side]
!!en:;


!?MF1; 
* Guardians of Zeus*
*have a chance to cast Titans Thunder with ranged attacks*

!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for TUM rebalanced abilities]
!!FU&y1=0:E;                            [Exit if option was not checked]
!!VRy99:S0T99;
!!FU&y99>25:E;                          [25% chance to cast]
 
!!UN:C42149568/4/?y10;                  [Get Physical Damage type]
!!FU&y10<>4455011:E;                    [Only Trigger when shooting]
!!MF:W?y80 F?y1 N?y4; !!FU|y80>0/y1=0:E;[Exit if Moat damage or no damage]
!!BG:A?y1 N?y2 D?y3;                    [action type, Attacking stack number, Destination Poistion and Hero]
!!if&y1=7/y2<>y4/y3>=0/y3<=186:; 
    !!BMy2:T?y5;                        [Creature Type]
    !!FU&y5<>212:E;                     [if Zeus]
    !!BMy2:C57/y3/3/3/1;                [Cast 57 Titan's Lightning Bolt at Stack Position]
!!en:;


****************************************************************************************************
!#SN:W^StackBalance_SpellAttack1_Creature_100^/114; [114 Fire Elements]
!#SN:W^StackBalance_SpellAttack1_Spell_100^/21; [21 Fireball]

*Trigger Spell at attack position before damage animation*
!?MF1;
!!FU:E;

!!UN:C42149568/4/?y10;                  [Get Physical Damage type]
!!FU&y10<>4462398:E;                    [Only Trigger when doing a melee attack]

!!MF:W?y80 F?y1 N?y4; !!FU|y80>0/y1=0:E;[Exit if Moat damage or no damage]
!!SN:W^StackBalance_Damage_Receiving_Stack^/y4; 


!!BG:A?y1 N?y2 D?y3;                    [action type, Attacking stack number, Destination Poistion and Hero]
!!FU|y1<>6/y3=-1:E;                     [Exit if no melee attack]
!!if&y1=6/y2<>y4/y3>=0/y3<=186:;
    !!BMy2:T?y5;                        [Creature Type]
    *!FU&y5<>242:E;                     [if Lava Basilisks]
    !!BMy2:C21/y3/3/3/1;                [Cast Fireball at Stack Position]
!!en:;
****************************************************************************************************


****************************************************************************************************
!#SN:W^StackBalance_SpellAttack2_Creature_100^/114; [114 Fire Elements]
!#SN:W^StackBalance_SpellAttack2_Spell_100^/21; [21 Fireball]
!#SN:W^StackBalance_SpellAttack2_Chance_100^/100; [100% chance to trigger attack]
!#SN:W^StackBalance_SpellAttack2_Scaling_100^/15; [Damage per Unit]

*Trigger Spell at attack position after damage animation for melee attacks*
!?MF1;

!!SN:W^Exp_TUM_Abilities^/?y1;          [Check option for TUM rebalanced abilities]
!!FU&y1=0:E;                            [Exit if option was not checked]
!!UN:C42149568/4/?y10; !!FU&y10<>4462398:E; [Get Physical Damage type Only Trigger when doing a melee attack]
!!MF:W?y80 F?y1 N?y4; !!FU|y80>0/y1=0:E;[Exit if Moat damage or no damage]
!!SN:W^StackBalance_Damage_Receiving_Stack^/y4; [Save damage receiving stack]


!?FU(Event_AfterMeeleDamage_Stack_Rebalance)&i^Exp_TUM_Abilities^;
!!SN:W^StackBalance_Damage_Receiving_Stack^/?y4;
!!SN:W^StackBalance_SpellAttack2_Creature_100^/?y20; [114 Fire Elements]
!!SN:W^StackBalance_SpellAttack2_Spell_100^/?y21; [21 Fireball]
!!SN:W^StackBalance_SpellAttack2_Chance_100^/?y22; [100% chance to trigger attack]
!!SN:W^StackBalance_SpellAttack2_Scaling_100^/?y23; [Damage per Unit]

!!VRy99:S0T99; !!FU&y99>y22:E;          [Exit if roll not successfull]

!!UN:C42149568/4/?y10; !!FU&y10<>4462398:E; [Get Physical Damage type Only Trigger when doing a melee attack]

!!BG:A?y1 N?y2 D?y3 E?y6;               [action type, Attacking stack number, Destination Poistion and Hero]
!!FU|y1<>6/y6=-1:E;                     [Exit if no melee attack or no monster at position]
!!BMy2:T?y5 N?y7;                       [Creature Type and number]
!!if&y1=6/y3>=0/y3<=186/y5=y20/y4<>y2:;    
    !!SSy21:E3/?y50;                    [get extra spell damage]
    !!VRy8:Sy7*y23;                     [number of untis times modifier]
    !!SSy21:E3/y8;                      [set new damage for fireball to also show damage when hitting several targets]
    !!BMy2:Cy21/y3/3/3/1;               [Cast Expert Spell at Stack Position]
    !!SSy21:E3/y50;                     [Revert damage to value from before]
!!en:;


!?MR1;                                  [*Magical Combat Improvements*]
!!FU:E;
*Make the damage scaling*
!!SN:W^StackBalance_SpellAttack2_Creature_100^/?y20; [114 Fire Elements]
!!SN:W^StackBalance_SpellAttack2_Spell_100^/?y21; [21 Fireball]

!!BG:A?y1 N?y4;                         [Get Action, Spell Number and Creature Number]
!!MR:D?y2 S?y3 N?y6;
!!BMy4:T?y5 N?y7;                       [Get Creature Type and Number of Creatures]

!!if&y3=y21/y5=y20/y6>0/y7>0/y2>0:;     [If Santa Gremlins casting Ice Bolt]
    !!SS21:E3/?y50;
    !!SN:W^StackBalance_SpellAttack2_Scaling_100^/?y10;    
    !!VRy8:Sy7*y10 -y50;
    *!IF:L^Effect Power is %Y50 and damage should be increased by %Y8^;
    !!SS21:E3/y8; 
    !!MR:Fy8;                           [Set new Damage]
    !!SS21:E3/y50;                      [Revert damage]
!!en:;

!?FU(OnStartOrLoad);                 
!!SN:L^EraPlugins\erm_hooker.era^/?y1;  
!!FU&y1=0:E;	
!!SN:Ay1/^SetHook^/?y2;                
!!SN:Ey2/1/4462998/(Event_AfterMeeleDamage_Stack_Rebalance);

****************************************************************************************************

*Illithid and Alhoon cast Hypnotize with attacks by Archer30
; The max target health to be Hypotized is the same as Fangarm's ability from HotA (20 + 25*(Illithird count))
; If the requirements of casting Hypnotize are met, it will be cast with 100% chance.
; The following script won't be executed in TUM Reborn as it has been included

!?FU(tum_OnAfterMelee)&i^Exp_TUM_Abilities^/i^tum_reborn^<>(TRUE); [hook from TUM]
!#VA(atkStack:x) (defStack:x);

!!BM(defStack):N?(defNum:y);

!!if&(defNum)>0;
  !!BM(atkStack):T?(atkMon:y);
  ; Check if the attacker can cast Hynothize
  !!FU(tum_CheckIfMonCanHypnotize):P(atkMon)/?(canCastHypnotize:y);

  !!if&(canCastHypnotize);
    ; Check if the target monster is hypnotized
												
    !!BM(defStack):G(SPELL_HYPNOTIZE)/?(duration:y)/?(level:y);

    !!if&(duration)<=0;
      !!FU(tum_GetActualStackSide):P(atkStack)/?(atkSide:y);
										  
      ; Check the defender's immunity to Hypnothize
      !!FU(tum_CheckIfStackCanBeHypnotized):P(defStack)/(atkSide)/?(acceptSpell:y);

      !!if&(acceptSpell);
        ; Check if the total HP of the defender is lower than 20 + 25*(attacker count)
        ; Attacker's power
        !!BM(atkStack):N?(atkNum:y);
        !!VR(maxHypnotizeHp:y):S25 *(atkNum) +20;
        ; Defender's total Hp
        !!BM(defStack):H?(hp:y) L?(lostHp:y);
        !!VR(totlaHp:y):S(hp) *(defNum) -(lostHp);

        ; Cast if condition meet
        !!if&(maxHypnotizeHp)>=(totlaHp);
          !!BM(defStack):P?(pos:y);
          !!BM(atkStack):C(SPELL_HYPNOTIZE)/(pos)/(SKILL_EXPERT)/3/(TRUE);

          ; Remove Attack Twice and retailiations temporarily for the victim and restore later
          !!BM(defStack):F?(flags:y) Fd~(MON_FLAG_ATTACKS_TWICE) R?(retals:y) R0;
          !!VR(hasAttackTwice:y):S(flags) &(MON_FLAG_ATTACKS_TWICE) B;
          !!FU(PackUnion):P(defStack)/8/(retals)/16/(hasAttackTwice)/7/1/1/?i^tum_hypnotize_stackData^;
        !!en;
      !!en;
    !!en;
  !!en;
!!en;

!?FU(OnBattleActionEnd)&i^tum_hypnotize_stackData^<>0/i^Exp_TUM_Abilities^/i^tum_reborn^<>(TRUE);
!!FU(UnpackUnion):Pi^tum_hypnotize_stackData^/?(defStack:y)/8/?(retals:y)/8/?(hasAttackTwice:y)/7/?(value:y)/1;
!!BM(defStack):R(retals);
!!BM(defStack)&(hasAttackTwice):Fd|(MON_FLAG_ATTACKS_TWICE);
!!VRi^tum_hypnotize_stackData^:S0;

!?FU(tum_CheckIfMonCanHypnotize)&i^Exp_TUM_Abilities^/i^tum_reborn^<>(TRUE);
!#VA(mon:x) (result:x);

!!VR(result):S(FALSE);
!!VR(result)|(mon)=274/(mon)=282:S(TRUE);

!?FU(tum_CheckIfStackCanBeHypnotized)&i^Exp_TUM_Abilities^/i^tum_reborn^<>(TRUE);
!#VA(stackId:x) (castingSide:x) (result:x);

!!VR(spellId:y):S(SPELL_HYPNOTIZE);

; Get the offset of the power address
!!UN:C(COMBAT_MANAGER)/(UNC_INT)/?(combatManager:y);
!!VR(offset:y):S(castingSide) *(UNC_INT) +21460;

; Set the power to max
!!UN:C(combatManager)/(offset)/(UNC_INT)/?(power:y);
!!VR(newPower:y):S2000000;
!!UN:C(combatManager)/(offset)/(UNC_INT)/(newPower);

; Check if the stack can receive Hypnotize with the new power
!!FU(tum_Battle_CanStackReceiveSpell):P(stackId)/(spellId)/(castingSide)/?(result);

; Restore the power
!!UN:C(combatManager)/(offset)/(UNC_INT)/(power);

!?FU(tum_GetActualStackSide)&i^tum_reborn^<>(TRUE);
!#VA(stack:x) (side:x);

!!BM(stack):I?(side) G(SPELL_HYPNOTIZE)/?(hypnotizeTurns:y)/d;
!!VR(side)&(hypnotizeTurns)>0:X(TRUE);

****************************************************************************************************


** function to add specialty text      
!?FU(Set_Monster_Special_Text);

!!SN:H^monname^/220/2/z222100;          [Skeletons Knights]
!!SN:H^monname^/232/2/z222101;          [Hobgoblins Overlord]
*!SN:H^monname^/192/2/z222102;          [Sylvian Centaure]

!!SN:H^monname^/247/2/z222109;          [Hurricane Elementals]
!!SN:H^monname^/248/2/z222103;          [Life Elementals]
!!SN:H^monname^/249/2/z222105;          [Plasma Elementals]
!!SN:H^monname^/250/2/z222110;          [Mineral Elementals]

!!SN:H^monname^/261/2/z222104;          [Spectre]
!!SN:H^monname^/202/2/z222106;          [Seraph]


!!SN:H^monname^/219/2/z222107;          [Antichrist]

!!SN:H^monname^/242/2/z222108;          [Lava Basilisk]
!!SN:H^monname^/243/2/z222113;          [Wyvern]

!!SN:H^monname^/212/2/z222111;          [Guardians of Zeus]

!!SN:H^monname^/238/2/z222112;          [Spectral Behemoths]

!!SN:H^monname^/234/2/z222114;          [Orc Leaders]
!!SN:H^monname^/236/2/z222115;          [Lightning Bird]

!!SN:H^monname^/274/2/z222116;          [Illithids]
!!SN:H^monname^/282/2/z222117;          [Alhoons]


****************************************************************************************************







****************************************************************************************************
!?FU(Configure_Stack_Exp_Rebalance);    [open the Stack Exp Rebalance settings]

  !!DL169:N^Sta_Exp.txt^;               [Name of Dialogue text file Parse Dialogue]

  !!SN:T^Diff_Mod.Stack_Option_1^/?z20 T^Diff_Mod.Stack_Option_2^/?z21 T^Diff_Mod.Stack_Option_3^/?z22 T^Diff_Mod.Stack_Option_4^/?z23; [Load Text]
  !!DL169:A20/3/z20/1 A21/3/z21/1 A22/3/z22/1 A23/3/z23/1; [Set text to text fields]

  !!SN:T^Diff_Mod.Stack_Option_5^/?z24 T^Diff_Mod.Stack_Option_6^/?z25; [Load correct text for options 1-16]
  !!DL169:A24/3/z24/1 A25/3/z25/1;      [Set text to text fields]

  !!FU(Stack_Exp_checkboxes):P1;

  !!SN:T^Diff_Mod.cancel_button_hint^/?z43; [left text]
  !!DL169:H30721/43;                    [set cancel button hint text]
  !!SN:T^Diff_Mod.confirm_button_hint_0^/?z44; [left text]
  !!DL169:H30722/44;                    [set confirm button hint text]
  !!DL169:S1;                           [Show complete Dialogue number 169]


!?DL&v998=169/v1000=13;                 [checkboxes switch between check and cancel]
; Play sound only when not clicking on a button - by Archer30
!!if&i^mouse_item^<>30722/i^mouse_item^<>30721;
  !!VRz1:S^Button.wav^;
  !!SN:Pz1;
!!en;

!!SN:W^Legacy_of_the_Silence_Active^/?y1;[Check if mod is active]
!!if&y1=1;                              [If LotS mod is active TUM rebalance options are disabled because the share the same monster IDs]
  !!SN:W^Exp_TUM_Stats^/0;
  !!SN:W^Exp_TUM_Abilities^/0;
  !!SN:W^Exp_TUM_Neutrals^/0;
!!en;

!!SN:W^Exp_WoG_Stats^/?y1;
!!SN:W^Exp_WoG_Abilities^/?y2;
!!SN:W^Exp_WoG_Neutrals^/?y3;
!!SN:W^Exp_TUM_Stats^/?y4;
!!SN:W^Exp_TUM_Abilities^/?y5;
!!SN:W^Exp_TUM_Neutrals^/?y6;
!!SN:W^Legacy_of_the_Silence_Active^/?y10; [Check if LotS is active]

!!SN&v999=10/y1=0:W^Exp_WoG_Stats^/1;   [swith for 1st]
!!SN&v999=10/y1=1:W^Exp_WoG_Stats^/0;

*!SN&v999=11/y2=0:W^Exp_WoG_Abilities^/1; Temp disabled until work continued
*!SN&v999=11/y2=1:W^Exp_WoG_Abilities^/0;

*!SN&v999=12/y3=0:W^Exp_WoG_Neutrals^/1; Temp disabled until work continued
*!SN&v999=12/y3=1:W^Exp_WoG_Neutrals^/0;

!!SN&v999=13/y4=0/y10=0:W^Exp_TUM_Stats^/1;
!!SN&v999=13/y4=1/y10=0:W^Exp_TUM_Stats^/0;

!!SN&v999=14/y5=0/y10=0:W^Exp_TUM_Abilities^/1;
!!SN&v999=14/y5=1/y10=0:W^Exp_TUM_Abilities^/0; 

*!SN&v999=15/y6=0:W^Exp_TUM_Neutrals^/1; Temp disabled until work continued
*!SN&v999=15/y6=1:W^Exp_TUM_Neutrals^/0;

!!FU(Stack_Exp_checkboxes):P;           [call func for switch on the user's choice]


!?FU(Stack_Exp_checkboxes);             [Set checkboxes function]

!!SN:W^Exp_WoG_Stats^/?y1;
!!SN:W^Exp_WoG_Abilities^/?y2;
!!SN:W^Exp_WoG_Neutrals^/?y3;
!!SN:W^Exp_TUM_Stats^/?y4;
!!SN:W^Exp_TUM_Abilities^/?y5;
!!SN:W^Exp_TUM_Neutrals^/?y6;

*!SN:W^Typhon_Third_Upgrade_Mod_Active^/?y13; [Check for Third Upgrade Mod]

!!DL169:A10/4/y1/1 A11/4/y2/1 A12/4/y3/1;
!!DL169:A13/4/y4/1 A14/4/y5/1 A15/4/y6/1;


!?DL&v998=169/v999>46/v999<49/v1000=13; [switch by little arrows for options 1-4]


Exp_Health_Set

!!if&v999=47;                           [If clicked on the left arrow ]
   !!SN:W^Exp_Health_Set^/?y1;          [Get value in y1]
   !!SN&y1>0:W^Exp_Health_Set^/d-1;     [Reduce value by -1 if bigger zero]
   !!SN:W^Exp_Health_Set^/?y1;          [Get new value in y1]
   !!VRy2&y1=1:S20; !!VRy2&y1=2:S10; !!VRy2&y1=3:S5; !!VRy2&y1=4:S4; !!VRy2&y1=5:S2; !!VRy2&y1=6:S1;
   !!VRz72:S^%Y2^; !!DL169:A92/3/z72/1;
!!en;
!!if&v999=48;
  !!SN:W^Exp_Health_Set^/?y1;
  !!SN&y1<6:W^Exp_Health_Set^/d1;
  !!SN:W^Exp_Health_Set^/?y1;
  !!VRy2&y1=1:S20; !!VRy2&y1=2:S10; !!VRy2&y1=3:S5; !!VRy2&y1=4:S4; !!VRy2&y1=5:S2; !!VRy2&y1=6:S1;
  !!VRz72:S^%Y2^; !!DL169:A92/3/z72/1;
!!en;

*!if&v999=76;
  *!SN:W^mix_maxRelativeMonLevel^/?y1;
  *!SN&y1>0:W^mix_maxRelativeMonLevel^/d-1;
  *!SN:W^mix_maxRelativeMonLevel^/?y1;
  *!VRz73:S^+%Y1^; *!DL47:A73/3/z73/1;
*!en;
*!if&v999=77;
  *!SN:W^mix_maxRelativeMonLevel^/?y1;
  *!SN&y1<6:W^mix_maxRelativeMonLevel^/d1;
  *!SN:W^mix_maxRelativeMonLevel^/?y1;
  *!VRz73:S^+%Y1^; *!DL47:A73/3/z73/1;
*!en;





!?DL&v998=169/v1000=14;                 [Show right click information for fixed options]

!!SN&v999=20:T^Diff_Mod.Stack_Option_1_Info^/?s^Text^; [set text for 1st]
!!IF&v999=20:M0/4/^%S(Text)^;           [show it 1 - 5]

!!SN&v999=21:T^Diff_Mod.Stack_Option_2_Info^/?s^Text^; [2nd]
!!IF&v999=21:M0/4/^%S(Text)^;

!!SN&v999=22:T^Diff_Mod.Stack_Option_3_Info^/?s^Text^; [...]
!!IF&v999=22:M0/4/^%S(Text)^;

!!SN&v999=23:T^Diff_Mod.Stack_Option_4_Info^/?s^Text^; [...]
!!IF&v999=23:M0/4/^%S(Text)^;

!!SN&v999=24:T^Diff_Mod.Stack_Option_5_Info^/?s^Text^; [...]
!!IF&v999=24:M0/4/^%S(Text)^;

!!SN&v999=25:T^Diff_Mod.Stack_Option_6_Info^/?s^Text^; [...]
!!IF&v999=25:M0/4/^%S(Text)^;


!?DL&v998=169/v999=30721/v1000=13;      [When clicking on the close Button in Stack Exp Rebalance Exit and reset all options]
!!DL:C1;
!!FU(mix_LoadGlobalConfig):P;           [Load Default settings from json again]


!?DL&v998=169/v999=30722/v1000=13;      [Close Dialogue with Confirm Button Save all Settings]
!!DL:C1;


// disable the unecessary right-click msg on system option if diff mod is enabled by Archer30
!?FU(OnAdventureMapRightMouseClick);
!!CM:I?(location:y);                    [clicked location]

!!if&(location)=10;
  !!UN:J8/1/^Difficulty Mod.pac^;       [check if diff mod is enabled]
  !!CM&1:R0;                            [disable right-click standard action on system option if true]
!!en;


// Manage the growth of Perry's CB template by Archer30
!?FU(OnEveryDay)&i^timerDay^=1/i^timerOnce^;
!!UN:P235/?(bankGrowth:y);

!!re i/0/99;                            [99 - the max number to loop, currently TUM has 62 banks, this should be enough for a while]
  !!if&i<10;
    !!VR(indexStr:z):S^00%i^;
  !!el&i>=10/i<100;
    !!VR(indexStr):S^0%i^;
  !!en;

  // At least 8% growth if revisiting is possible
  ; If Difficulty mod is enabled, set the growth to the value in Diff mod
  !!if&(bankGrowth);
    !!VR(growth:y):S8;

    ; variable from Difficulty mod
    !!if&i^Guarded_Object_growth_Rate^>100;
      !!VR(growth):Si^Guarded_Object_growth_Rate^ -100 *5 :6;
    !!en;

    !!VRi^CB_%(indexStr)_Custom_Growth^:S(growth);
  // Disable revisiting if CB growth wog option is disabled
  ; 7 - to prevent affecting dwelling banks from TUM. They will be reset no matter what
  !!el;
    !!VRi^CB_%(indexStr)_Revisit^&i^CB_%(indexStr)_Revisit^>7:S0;
  !!en;
!!en;

****************************************************************************************************



                                       TEST SECTION




****************************************************************************************************

*#SN:W^Legacy_of_the_Silence_Active^/1;  [Set Mod Active] Test

!?FU(OnCombatRound)&v997=0;
AI neutral players or heroes gets Stronger Commander in battle
!!SN:W^Dif_Mod_Neutral_Commander^/?y1;
!!FU&y1=0:E;                            [Exit if Mod was disabled in options]

!!SN:W^Battle_Commander_Type^/?y1;      [If Battle Commander is presented dont run this option]
!!FU&y1>0:E;

!!BA:O?y1/?y2;                          [Get Owner]
!!OW:Iy1/?y2;                           [Get if AI or Human]
!!if&y2=0;
 !!re i/0/20;                           [search for own commander]
  !!BMi:T?y3 P?y4;                      [Get Creature Type and Position]
    !!if&y3>=174/y3<=182;               [If Commander found]
      !!BMi:A?y10;                      [Get Attack]
      !!BMi:D?y11;                      [Get Defense]
      !!BMi:H?y13;                      [Get Health]
      !!BMi:U1/?y14 U2/?y15;            [Set Min+Max Damage]
      !!BMi:S?y16;                      [Get Speed]
    !!en;
  !!en;
!!en;
!!FU|y13<30/y16<1:E;                    [Exit if no commander found]

!!BA:O?y1/?y2;                          [Get Owner]
!!if&y2=-1;                             [if neutral AI]
 !!re i/21/41;                          [loop defender stacks]
  !!BMi:T?y3 P?y4;                      [Get Creature Type and Position]
    !!if&y3>=183/y3<=191/y4=98;         [If Commander at position 98 found]
      !!VRy20:S20R100; !!VRy10:*y20:100; !!BMi:Ay10; [Set Attack]
      !!VRy20:S20R100; !!VRy11:*y20:100; !!BMi:Dy11; [Set Defense]
      !!VRy20:S20R90; !!VRy13:*y20:100; !!BMi:Hy13; [Set Health]
      !!VRy20:S20R110; !!VRy14:*y20:100; !!VRy15:*y20:100; !!BMi:U1/y14 U2/y15; [Set Min+Max Damage]
      !!VRy20:S20R60; !!VRy16:*y20:100+1; !!VRy16&y16<4:S4; !!BMi:Sy16; [Set Speed 4 is minimum speed]
    !!en;
 !!en;
!!en;
